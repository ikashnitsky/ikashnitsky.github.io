<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Ilya Kashnitsky</title>
<link>https://ikashnitsky.github.io/atom.html</link>
<atom:link href="https://ikashnitsky.github.io/atom.xml" rel="self" type="application/rss+xml"/>
<description>Dr. Ilya Kashnitsky is an Assistant Professor of demography at the Interdisciplinary Centre on Population Dynamics, University of Southern Denmark, Odense, DK.</description>
<generator>quarto-1.2.269</generator>
<lastBuildDate>Thu, 04 Mar 2021 23:00:00 GMT</lastBuildDate>
<item>
  <title>What is life expectancy? And, even more important, what it isn’t</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2021/life-expectancy-101/index.html</link>
  <description><![CDATA[ 



<script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>It really is a remarkable achievement and maybe a lot of luck that the world mundanely operates with such a complex indicator as life expectancy. Unlike many statistics and quantities of general use that are being monitored and reported regularly, life expectancy is not observed directly. It’s an output of a <strong>mathematical model</strong> called <strong>life table</strong>. And as any model it comes with a certain load of assumptions and limitations, which are easily forgotten and omitted in the everyday interpretations and misinterpretations of the indicator.</p>
<p>So, why do we need any mathematical modelling in the first place? Consider a seemingly simple task: you want to know how long people live. What can be easier? Let’s just see how many years lived those who died recently. Why not? Such a metric would be massively driven by population age structure. For the most of the recent history human populations were rapidly growing, which means that each next generation was bigger than the previous one. Relative differences in the size of generations affect the age composition of those dying.</p>
<p>Okay. Then why don’t we simply take a group of people born in the same year and see how long on average they live? We could (demographers call such groups cohorts). But it takes remarkably long to wait until the last person in the cohort dies. And we want to know what’s happening <strong>now</strong>.</p>
<p>How can we learn what’s happening now? Well, for that we need a mathematical model. We cannot observe the unfulfilled lifespans directly but we can construct/imagine an artificial population to help us understand the current mortality. The idea is simple: let’s take those dying now and divide them by the size of their age groups. This yields age-specific death rates – the key input for the life table needed to calculate life expectancy. Now, let’s take an imaginary cohort and see how long would they live on average if they experience these observed age-specific death rates. The imaginary population is know as a <strong>synthetic cohort</strong>. And here comes the main assumption of the life table: The model assumes that the observed age-specific death rates stay unchanged throughout the hypothetical lives of the hypothetical people in the synthetic cohort.</p>
<p>This big assumption of unchanging age profile of death rates almost never holds in real life. Mortality in human populations keeps improving beyond the most optimistic expectations. For decades the best demographers were systematically underestimating the progress in mortality reduction (Oeppen and Vaupel, 2002)</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/oeppen-vaupel.jpg" class="img-fluid"></p>
<p><em>The horizontal lines are the limits of human population-level life expectancy as anticipated by renowned scholars; points are the actual data in the world leading countries. Source: (Oeppen and Vaupel, 2002)</em></p>
<p>Life expectancy is a snapshot of the current mortality and is not a projection/forecast of the actual experience of the newborn cohorts. The current nature of period life expectancy is nicely <a href="https://twitter.com/therealrchung/status/1365091610766155778">illustrated by Dr.&nbsp;Robert Chung</a>: “I have a car that can display”driving range” given its estimate of fuel level and how I’m driving. When climbing a steep hill, the range can decrease a lot; when descending, the range can increase. That’s what period e(x) is like.”</p>
<p>But if life expectancy talk about now and not the future, why is it called “expectancy” in the first place? This rather unfortunate and confusing <a href="https://twitter.com/therealrchung/status/1365313760416526340">naming comes from statistics</a>, where “expected value” is a standard term for the mean of a distribution. The connotation crossing is rather unfortunate and as it strongly nudges the common future oriented misinterpretation of life expectancy.</p>
<p>The most popular error in public perception of period life expectancy forgets about the heavy assumption of the synthetic cohort (constant age-specific death rates throughout their hypothetic lives anchored in current year) and talks about the future of kids being born now. In normal years this large interpretation error is somewhat masked by the gradual and often close to linear improvements in mortality. A rule of thumb is to simply add ~6 years to period life expectancy to obtain a reasonable cohort estimate (Goldstein and Wachter, 2006). Mortality shocks like 2020 are a different story though. Here the “forward looking” (mis)interpretation of period life expectancy projects the <strong>shock levels of mortality</strong> into the future. Of course this doesn’t happen. Shocks are called shocks because they are temporal.</p>
<p>Another important detail that often misses public attention is that life expectancy is not a single value – it can be estimated for every age. Most often and by default life expectancy is reported “at birth”. But we can estimate remaining life expectancy for various ages. And here comes another popular misunderstanding of life expectancy. Too often we come across the references to human age and longevity in the past that sound something like: “She was 40, a very elderly lady by the standards of that time as people lived on average about 30 years back the”. True, there were times when life expectancy <strong>at birth</strong> was about 30 years even in the most developed now countries. This doesn’t mean though that those who outlived this threshold age were getting old at young (by our current standards) ages. Let me illustrate.</p>
<p>Let’s take Italian male population in 1872, the first available year in <a href="https://www.mortality.org/">Human Mortality Database</a>. Have a look at the survival of this synthetic cohort – the proportion of the initial cohort that is still alive by certain age. Half of the synthetic cohort died by age 15!</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/ita-lx.png" class="img-fluid"></p>
<p>And here is how remaining period life expectancy looked by age. Infant and child mortality was sooo high that those escaping early deaths had higher remaining life expectancy.</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/ita-ex.png" class="img-fluid"></p>
<p>At age 34 remaining life expectancy was the same as at birth. Only, it applied to the 41% survivors. And I guess the perception of age was not radically different among those survivors. It was all about selection and luck getting there. The high early life mortality is responsible for another popular demographic myth, which postulates that everybody used to have many kids in the past. No, people used to have many births, and only a fraction of those kids survived to adult life.</p>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Goldstein JR, Wachter KW. 2006. Relationships between Period and Cohort Life Expectancy: Gaps and Lags. <em>Population Studies</em> <strong>60</strong>: 257–269 <a href="https://doi.org/10.1080/00324720600895876">DOI</a>: 10.1080/00324720600895876<br>
</li>
<li>Oeppen J, Vaupel JW. 2002. Broken limits to life expectancy. <em>Science</em> <strong>296</strong>: 1029–1031 <a href="https://doi.org/10.1126/science.1069675">DOI</a>: 10.1126/science.1069675</li>
</ul>
<hr>
<center>
<button class="btn btn-lg btn-secondary" type="button">
This post is based on my previous <a href="https://twitter.com/ikashnitsky/status/1367856010476613632">Twitter thread</a>.
</button>
</center>


<!-- -->

</section>

 ]]></description>
  <category>r</category>
  <category>tw</category>
  <category>demography-101</category>
  <category>life expectancy</category>
  <guid>https://ikashnitsky.github.io/2021/life-expectancy-101/index.html</guid>
  <pubDate>Thu, 04 Mar 2021 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2021/life-expectancy-101/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Evolution of ice hockey players’ height: IIHF world championships 2001-2016</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/ice-hockey-players-height/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>The 2017 Ice Hockey World Championship has started. Thus I want to share a small research on the height of ice hockey players that I did almost a year ago and <a href="https://habrahabr.ru/post/301340/">published in Russian</a>.</p>
<p>When the TV camera shows the players returning to the changing rooms, it is difficult not to notice just how huge the players are compared to the surrounding people – fans, journalists, coaches, or the ice arena workers. For example, here are the rising stars of the Finnish hockey – Patrik Laine and Aleksander Barkov – with the two fans in between.</p>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-00-laine-barkov.jpg" class="img-fluid"><em><a href="https://www.instagram.com/p/BFjNdn7zORh">Source</a></em></p>
<p>So the questions arise. Are ice hockey players really taller than average people? How is the height of ice hockey players evolving over time? Are there any lasting differences between countries?</p>
<section id="data" class="level1"><h1>Data</h1>
<p>IIHF, the organization that is in charge for the ice hockey world championships, publishes detailed information on the squads, including the data on player’s height and weight. The raw data files are <a href="http://www.iihf.com/iihf-home/history/past-tournaments/">here</a>. I gathered the data of all players that participated in the 16 world championships between 2001 and 2016. The formatting of the data files changes from year to year complicating the data processing. So I did the data cleaning manually which took a bit more than 3 hours. The unifies dataset is <a href="https://dx.doi.org/10.6084/m9.figshare.3394735.v2">here</a>. Let’s load the data and prepare the R session.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># data manipulation and viz</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># easy manipulations with dates</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># themes for ggplot2</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/leifeld/texreg/">texreg</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># easy export of regression tables</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://xtable.r-forge.r-project.org/">xtable</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># export a data frame into an html table</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># change the font in figures</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download the IIHF data set; if there are some problems, you can download manually</span></span>
<span><span class="co" style="color: #5E5E5E;"># using the stable URL (https://dx.doi.org/10.6084/m9.figshare.3394735.v2)</span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ndownloader.figshare.com/files/5303173"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># color palette</span></span>
<span><span class="va" style="color: #111111;">brbg11</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">RColorBrewer</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>, <span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="do-the-players-become-taller-a-crude-comparison" class="level1"><h1>Do the players become taller? (a crude comparison)</h1>
<p>Let’s first have a look at the pulled average height of all the players that participated.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># mean height by championship</span></span>
<span><span class="va" style="color: #111111;">df_per</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>height <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period_mean</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_per</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year of competition"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period_jitter</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.75</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year of competition"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">cowplot</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">gg_period_mean</span>, <span class="va" style="color: #111111;">gg_period_jitter</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-01-period-height.png" class="img-fluid"></p>
<p><strong>Figure 1. The dynamics of the average height of the ice hockey players at the world championships, 2001–2016</strong></p>
<p>The positive trend is evident. In the 15 years the average height of a player increased by almost 2 cm (left panel). Is that a lot? To have an idea, we will compare this growth to the dynamics in the population, later in the post.</p>
</section><section id="cohort-approach" class="level1"><h1>Cohort approach</h1>
<p>A more correct way to study the dynamics of players’ height is to do the comparison between birth cohorts. Here we face an interesting data preparation issue – some of the players participated in more that one championships. The question is: do we need to clean the duplicate records? If the goal is to see the average height of a player at the certain championship (as in Figure 1), it is reasonable to keep all the records. Alternatively, if the aim is to analyze the dynamics of players’ height itself, I argue, it would be wrong to assign bigger weight to those players that participated in more that one championship. Thus, for the further cohort analysis, I cleaned the dataset from the duplicates.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dfu_h</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">av.height</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">sum</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">dfu_w</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_w</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">av.weight</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">av.height</span>, <span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 <span class="va" style="color: #111111;">dfu_w</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">av.weight</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 by <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"name"</span>, <span class="st" style="color: #20794D;">"country"</span>, <span class="st" style="color: #20794D;">"position"</span>, <span class="st" style="color: #20794D;">"birth"</span>, <span class="st" style="color: #20794D;">"cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>bmi <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.weight</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">av.height</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">^</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The total number of observations decreased from 6292 to 3333. For those who participated in more that one championship, I averaged the data on height and weight as they can change during the life-course. How many times, on average, are ice hockey players honored to represent their countries in the world championships? A bit less than 2.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># frequencies of participation in world championships</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_times_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_part</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Freq</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Var1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"identity"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"times participated (out of 16 possible)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-02-times-part.png" class="img-fluid"></p>
<p><strong>Figure 2. Histogram of the players by the number of times they participated in world championships over the period 2001-2016.</strong></p>
<p>But there are unique players that participated in a considerable number of championships. Let’s have a look at those who participated at least 10 times out of 16 possible. There were just 14 such players.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># the leaders of participation in world championships</span></span>
<span><span class="va" style="color: #111111;">leaders</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">times_participated</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">leaders</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># save the table to html</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">leaders</span><span class="op" style="color: #5E5E5E;">)</span>, type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"html"</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"table_leaders.html"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table 1. The most frequently participated players</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
name
</th>
<th class="tg-lyle">
country
</th>
<th class="tg-lyle">
position
</th>
<th class="tg-lyle">
birth date
</th>
<th class="tg-lyle">
cohort
</th>
<th class="tg-lyle">
av.height
</th>
<th class="tg-lyle">
times _participated
</th>
<th class="tg-lyle">
av.weight
</th>
<th class="tg-lyle">
bmi
</th>
</tr>
<tr>
<td class="tg-ls8f">
ovechkin alexander
</td>
<td class="tg-jrsh">
RUS
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1985-09-17
</td>
<td class="tg-jrsh">
1985
</td>
<td class="tg-jrsh">
188.45
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
98.36
</td>
<td class="tg-jrsh">
27.70
</td>
</tr>
<tr>
<td class="tg-ls8f">
nielsen daniel
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1980-10-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
182.27
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
79.73
</td>
<td class="tg-jrsh">
24.00
</td>
</tr>
<tr>
<td class="tg-ls8f">
staal kim
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1978-03-10
</td>
<td class="tg-jrsh">
1978
</td>
<td class="tg-jrsh">
182.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
87.80
</td>
<td class="tg-jrsh">
26.51
</td>
</tr>
<tr>
<td class="tg-ls8f">
green morten
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1981-03-19
</td>
<td class="tg-jrsh">
1981
</td>
<td class="tg-jrsh">
183.00
</td>
<td class="tg-jrsh">
12
</td>
<td class="tg-jrsh">
85.83
</td>
<td class="tg-jrsh">
25.63
</td>
</tr>
<tr>
<td class="tg-ls8f">
masalskis edgars
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
G
</td>
<td class="tg-jrsh">
1980-03-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
176.00
</td>
<td class="tg-jrsh">
12
</td>
<td class="tg-jrsh">
79.17
</td>
<td class="tg-jrsh">
25.56
</td>
</tr>
<tr>
<td class="tg-ls8f">
ambuhl andres
</td>
<td class="tg-jrsh">
SUI
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1983-09-14
</td>
<td class="tg-jrsh">
1983
</td>
<td class="tg-jrsh">
176.80
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
83.70
</td>
<td class="tg-jrsh">
26.78
</td>
</tr>
<tr>
<td class="tg-ls8f">
granak dominik
</td>
<td class="tg-jrsh">
SVK
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1983-06-11
</td>
<td class="tg-jrsh">
1983
</td>
<td class="tg-jrsh">
182.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
79.50
</td>
<td class="tg-jrsh">
24.00
</td>
</tr>
<tr>
<td class="tg-ls8f">
madsen morten
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1987-01-16
</td>
<td class="tg-jrsh">
1987
</td>
<td class="tg-jrsh">
189.82
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
86.00
</td>
<td class="tg-jrsh">
23.87
</td>
</tr>
<tr>
<td class="tg-ls8f">
redlihs mikelis
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1984-07-01
</td>
<td class="tg-jrsh">
1984
</td>
<td class="tg-jrsh">
180.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
80.40
</td>
<td class="tg-jrsh">
24.81
</td>
</tr>
<tr>
<td class="tg-ls8f">
cipulis martins
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-11-29
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
180.70
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
82.10
</td>
<td class="tg-jrsh">
25.14
</td>
</tr>
<tr>
<td class="tg-ls8f">
holos jonas
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1987-08-27
</td>
<td class="tg-jrsh">
1987
</td>
<td class="tg-jrsh">
180.18
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
91.36
</td>
<td class="tg-jrsh">
28.14
</td>
</tr>
<tr>
<td class="tg-ls8f">
bastiansen anders
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-10-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
190.00
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
93.64
</td>
<td class="tg-jrsh">
25.94
</td>
</tr>
<tr>
<td class="tg-ls8f">
ask morten
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-05-14
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
185.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
88.30
</td>
<td class="tg-jrsh">
25.80
</td>
</tr>
<tr>
<td class="tg-ls8f">
forsberg kristian
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1986-05-05
</td>
<td class="tg-jrsh">
1986
</td>
<td class="tg-jrsh">
184.50
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
87.50
</td>
<td class="tg-jrsh">
25.70
</td>
</tr>
</tbody></table>
<p>Alexander Ovechkin – 11 times! But it has to be noted that not every player had a possibility to participate in all the 16 championships between 2001 and 2016. That depends on a numder of factors:<br>
- the birth cohort of the player; - whether his national team regularly qualified for the championship (Figure 3); - whether the player was good enough for the national team; - whether he was free from the NHL play-offs that often keep the best players off the world championships.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># countries times participated</span></span>
<span><span class="va" style="color: #111111;">df_cnt_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">no</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">no</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, levels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>               year <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">d_cnt_n</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_cnt_part</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_cnt_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_cnt_part</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">d_cnt_n</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">17.5</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">d_cnt_n</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18.5</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">" "</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span><span class="op" style="color: #5E5E5E;">(</span>colours <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">25</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              axis.text.x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>angle <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">90</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-03-countries-part.png" class="img-fluid"></p>
<p><strong>Figure 3. Stats of the national teams participation in the world championships</strong></p>
</section><section id="do-the-ice-hochey-players-become-taller-regression-analysis" class="level1"><h1>Do the ice hochey players become taller? (regression analysis)</h1>
<p>The regression analysis allows to address the research question – the association between player’s height and birth cohort – accounting for the cross-national differences and player’s position. I use OLS regressions, that are quite sensitive to outliers. I removed the birth cohorts for which there are less than 10 players – 1963, 1997, and 1998.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># remove small cohorts</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span> <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fl" style="color: #AD0000;">1997</span>, <span class="va" style="color: #111111;">cohort</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">1963</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>So, the results. I add the variables one by one.</p>
<p><strong>Dependent variable</strong>: player’s height.<br><strong>Explaining variables</strong>: 1) birth cohort; 2) position (compared to defenders); 3) country (compared to Russia).</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># relevel counrty variable to compare with Russia</span></span>
<span><span class="va" style="color: #111111;">dfuc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span>, ref <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"RUS"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># regression models</span></span>
<span><span class="va" style="color: #111111;">m1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># export the models to html</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/texreg/man/htmlreg.html">htmlreg</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">m1</span>, <span class="va" style="color: #111111;">m2</span>, <span class="va" style="color: #111111;">m3</span><span class="op" style="color: #5E5E5E;">)</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"models_height.html"</span>, single.row <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table2. The models</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-t6te{font-style:italic;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-mmdc{font-style:italic;font-family:Georgia, serif !important;}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
</th>
<th class="tg-lyle">
Model 1
</th>
<th class="tg-lyle">
Model 2
</th>
<th class="tg-lyle">
Model 3
</th>
</tr>
<tr>
<td class="tg-ls8f">
(Intercept)
</td>
<td class="tg-jrsh">
-10.17 (27.67)
</td>
<td class="tg-jrsh">
-18.64 (27.01)
</td>
<td class="tg-jrsh">
32.59 (27.00)
</td>
</tr>
<tr>
<td class="tg-ls8f">
cohort
</td>
<td class="tg-jrsh">
0.10 (0.01)***
</td>
<td class="tg-jrsh">
0.10 (0.01)***
</td>
<td class="tg-jrsh">
0.08 (0.01)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
positionF
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-2.59 (0.20)***
</td>
<td class="tg-jrsh">
-2.59 (0.20)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
positionG
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.96 (0.31)***
</td>
<td class="tg-jrsh">
-1.93 (0.30)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryAUT
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.94 (0.55)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryBLR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.95 (0.53)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCAN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.13 (0.46)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCZE
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.56 (0.49)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryDEN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.10 (0.56)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFIN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.20 (0.50)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFRA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-2.19 (0.69)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryGER
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.61 (0.51)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryHUN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.61 (0.86)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryITA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-3.58 (0.61)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryJPN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-5.24 (0.71)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryKAZ
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.16 (0.57)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryLAT
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.38 (0.55)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryNOR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.61 (0.62)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryPOL
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.06 (1.12)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySLO
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.55 (0.58)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySUI
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.80 (0.53)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySVK
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.44 (0.50)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySWE
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.18 (0.48)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUKR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.82 (0.59)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUSA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.54 (0.45)
</td>
</tr>
<tr>
<td class="tg-mmdc">
R2
</td>
<td class="tg-t6te">
0.01
</td>
<td class="tg-t6te">
0.06
</td>
<td class="tg-t6te">
0.13
</td>
</tr>
<tr>
<td class="tg-mmdc">
Adj. R2
</td>
<td class="tg-t6te">
0.01
</td>
<td class="tg-t6te">
0.06
</td>
<td class="tg-t6te">
0.12
</td>
</tr>
<tr>
<td class="tg-mmdc">
Num. obs.
</td>
<td class="tg-t6te">
3319
</td>
<td class="tg-t6te">
3319
</td>
<td class="tg-t6te">
3319
</td>
</tr>
<tr>
<td class="tg-mmdc">
RMSE
</td>
<td class="tg-t6te">
5.40
</td>
<td class="tg-t6te">
5.27
</td>
<td class="tg-t6te">
5.10
</td>
</tr>
</tbody></table>
<p><strong>Model 1</strong>. One year change in the birth cohort year is associated with an increase of 0.1 cm in height. The coefficient is statistically significant, yet the variable explains only 1% of the variance. That’s not a big problem since the aim of the modeling is to document the differences, rather than predict based on the model. Nevertheless, the low coefficient of determination means that there are other variables that explain the differences in players’ height better than just the birth cohort.</p>
<p><strong>Model 2.</strong> Defenders are the tallest ice hockey players: goalkeepers are 2 cm shorter, forwards are 2.6 cm shorter. All the coefficients are significant; R squared rose to 6%. It is worth noting that the coefficient for the birth cohort did not change when we added the new variable.</p>
<p><strong>Model 3</strong>. It is interesting to control for countries for two reasons. First, some of the differences are significant themselves. For example, Swedes, Slovaks, and Canadians are higher than Russians. In contrast, Japanese are 5.2 cm shorter, Italians – 3.6 cm, French – 2.2 cm (figure 4). Second, once the country controls are introduced, the coefficient for birth cohort decreased slightly meaning that some of the differences in height are explained by persisting cross-country differences. R squared rose to 13%.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># players' height by country</span></span>
<span><span class="va" style="color: #111111;">gg_av.h_country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc</span> , <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span>, geom <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"line"</span>, fun.y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mean</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span>, geom <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"line"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">170</span>, <span class="fl" style="color: #AD0000;">195</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"birth cohort"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-04-height-by-country.png" class="img-fluid"></p>
<p><strong>Figure 4. The height of ice hockey players by nations</strong></p>
<p>The last model indicates that from one birth cohort cohort to the other the height of ice hockey players increases 0.08 cm. That means an increase of 0.8 cm in a decade or a growth of 2.56 cm in the 32 years between 1964 and 1996. It is worth mentioning that once we run the analysis in cohorts and controlling for positions and nations, the speed of the player’s height increase becomes much humbler than in the crude pulled analysis (Figure 1): 0.8 cm per decade compared to 1.2 cm per decade.</p>
<p>Before we go further and compare the growth in player’s height to that of the population, let’s do the modeling separately for defenders, goalkeepers, and forwards. The exploratory plot (Figure 5) suggests that the correlation is stronger for goalkeepers and weaker for defenders.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dfuc_pos</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfuc</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc_pos</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Defenders"</span>, <span class="st" style="color: #20794D;">"Forwards"</span>, <span class="st" style="color: #20794D;">"Goalkeeprs"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_pos</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc_pos</span> , <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>, <span class="fl" style="color: #AD0000;">9</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">position</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"birth cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-05-corr-by-pos.png" class="img-fluid"></p>
<p><strong>Figure 5. Correlation between height and birth cohort by position</strong></p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># separate models for positions</span></span>
<span><span class="va" style="color: #111111;">m3d</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"D"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3f</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"F"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3g</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"G"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/texreg/man/htmlreg.html">htmlreg</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">m3d</span>, <span class="va" style="color: #111111;">m3f</span>, <span class="va" style="color: #111111;">m3g</span><span class="op" style="color: #5E5E5E;">)</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"models_height_pos.html"</span>, single.row <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, </span>
<span>        custom.model.names <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Model 3 D"</span>, <span class="st" style="color: #20794D;">"Model 3 F"</span>, <span class="st" style="color: #20794D;">"Model 3 G"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table 3. Model 3 – separately for defenders, forwards, and goalkeepers</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-t6te{font-style:italic;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-mmdc{font-style:italic;font-family:Georgia, serif !important;}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
</th>
<th class="tg-lyle">
Model 3 D
</th>
<th class="tg-lyle">
Model 3 F
</th>
<th class="tg-lyle">
Model 3 G
</th>
</tr>
<tr>
<td class="tg-ls8f">
(Intercept)
</td>
<td class="tg-jrsh">
108.45 (46.46)*
</td>
<td class="tg-jrsh">
49.32 (36.73)
</td>
<td class="tg-jrsh">
-295.76 (74.61)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
cohort
</td>
<td class="tg-jrsh">
0.04 (0.02)
</td>
<td class="tg-jrsh">
0.07 (0.02)***
</td>
<td class="tg-jrsh">
0.24 (0.04)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryAUT
</td>
<td class="tg-jrsh">
0.14 (0.96)
</td>
<td class="tg-jrsh">
-2.01 (0.75)**
</td>
<td class="tg-jrsh">
0.47 (1.47)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryBLR
</td>
<td class="tg-jrsh">
0.30 (0.87)
</td>
<td class="tg-jrsh">
-1.53 (0.73)*
</td>
<td class="tg-jrsh">
-2.73 (1.55)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCAN
</td>
<td class="tg-jrsh">
1.55 (0.78)*
</td>
<td class="tg-jrsh">
0.39 (0.62)
</td>
<td class="tg-jrsh">
3.45 (1.26)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCZE
</td>
<td class="tg-jrsh">
0.87 (0.84)
</td>
<td class="tg-jrsh">
0.30 (0.67)
</td>
<td class="tg-jrsh">
0.63 (1.36)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryDEN
</td>
<td class="tg-jrsh">
-0.60 (0.95)
</td>
<td class="tg-jrsh">
0.10 (0.75)
</td>
<td class="tg-jrsh">
-0.19 (1.62)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFIN
</td>
<td class="tg-jrsh">
-0.55 (0.89)
</td>
<td class="tg-jrsh">
-0.04 (0.67)
</td>
<td class="tg-jrsh">
2.40 (1.32)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFRA
</td>
<td class="tg-jrsh">
-3.34 (1.15)**
</td>
<td class="tg-jrsh">
-2.06 (0.93)*
</td>
<td class="tg-jrsh">
1.39 (2.07)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryGER
</td>
<td class="tg-jrsh">
0.48 (0.85)
</td>
<td class="tg-jrsh">
-1.40 (0.72)
</td>
<td class="tg-jrsh">
-0.65 (1.33)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryHUN
</td>
<td class="tg-jrsh">
-1.32 (1.47)
</td>
<td class="tg-jrsh">
-0.70 (1.16)
</td>
<td class="tg-jrsh">
0.65 (2.39)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryITA
</td>
<td class="tg-jrsh">
-2.08 (1.08)
</td>
<td class="tg-jrsh">
-4.78 (0.82)***
</td>
<td class="tg-jrsh">
-2.02 (1.62)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryJPN
</td>
<td class="tg-jrsh">
-4.13 (1.26)**
</td>
<td class="tg-jrsh">
-6.52 (0.94)***
</td>
<td class="tg-jrsh">
-2.27 (1.98)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryKAZ
</td>
<td class="tg-jrsh">
-1.23 (0.95)
</td>
<td class="tg-jrsh">
-1.82 (0.79)*
</td>
<td class="tg-jrsh">
1.79 (1.58)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryLAT
</td>
<td class="tg-jrsh">
-0.73 (0.95)
</td>
<td class="tg-jrsh">
-1.39 (0.75)
</td>
<td class="tg-jrsh">
-3.42 (1.49)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryNOR
</td>
<td class="tg-jrsh">
-3.25 (1.07)**
</td>
<td class="tg-jrsh">
-1.06 (0.85)
</td>
<td class="tg-jrsh">
-0.10 (1.66)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryPOL
</td>
<td class="tg-jrsh">
0.82 (1.89)
</td>
<td class="tg-jrsh">
-0.58 (1.55)
</td>
<td class="tg-jrsh">
0.37 (2.97)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySLO
</td>
<td class="tg-jrsh">
-1.57 (0.99)
</td>
<td class="tg-jrsh">
-1.54 (0.79)
</td>
<td class="tg-jrsh">
-2.25 (1.66)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySUI
</td>
<td class="tg-jrsh">
-1.98 (0.91)*
</td>
<td class="tg-jrsh">
-2.36 (0.71)***
</td>
<td class="tg-jrsh">
1.12 (1.47)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySVK
</td>
<td class="tg-jrsh">
2.94 (0.87)***
</td>
<td class="tg-jrsh">
0.81 (0.67)
</td>
<td class="tg-jrsh">
-0.70 (1.50)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySWE
</td>
<td class="tg-jrsh">
0.75 (0.81)
</td>
<td class="tg-jrsh">
1.24 (0.65)
</td>
<td class="tg-jrsh">
1.37 (1.33)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUKR
</td>
<td class="tg-jrsh">
-1.37 (1.01)
</td>
<td class="tg-jrsh">
-1.77 (0.80)*
</td>
<td class="tg-jrsh">
-3.71 (1.66)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUSA
</td>
<td class="tg-jrsh">
0.76 (0.78)
</td>
<td class="tg-jrsh">
-0.08 (0.62)
</td>
<td class="tg-jrsh">
2.58 (1.26)*
</td>
</tr>
<tr>
<td class="tg-mmdc">
R2
</td>
<td class="tg-t6te">
0.09
</td>
<td class="tg-t6te">
0.10
</td>
<td class="tg-t6te">
0.24
</td>
</tr>
<tr>
<td class="tg-mmdc">
Adj. R2
</td>
<td class="tg-t6te">
0.07
</td>
<td class="tg-t6te">
0.09
</td>
<td class="tg-t6te">
0.20
</td>
</tr>
<tr>
<td class="tg-mmdc">
Num. obs.
</td>
<td class="tg-t6te">
1094
</td>
<td class="tg-t6te">
1824
</td>
<td class="tg-t6te">
401
</td>
</tr>
<tr>
<td class="tg-mmdc">
RMSE
</td>
<td class="tg-t6te">
5.08
</td>
<td class="tg-t6te">
5.08
</td>
<td class="tg-t6te">
4.87
</td>
</tr>
</tbody></table>
<p>The separate modeling shows that the average height of ice hockey players, that were born in 1964-1996 and participated in the world championships in 2001–2016, increased with the speed of 0.4 cm per decade for defenders, 0.7 cm – for forwards, and (!) 2.4 cm – for goalies. In three decades the average height of the goalkeepers increased by 7 cm!</p>
<p>Finally, let’s compare these dynamics with those in the population.</p>
</section><section id="compare-to-population" class="level1"><h1>Compare to population</h1>
<p>Our previous results expose significant height differences between players of various nations. Thus, it is reasonable to compare ice hockey players’ height to the corresponding male population of their countries.</p>
<p>For the data on the height of males in population in the corresponding nations I used the <a href="https://dx.doi.org/10.1016/j.ehb.2010.03.001">relevant scientific paper</a>. I grabbed the data from the paper PDF using a nice little tool – <a href="http://tabula.technology/">tabula</a> – and also <a href="https://dx.doi.org/10.6084/m9.figshare.3394795.v1">deposited on figshare</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># download the data from Hatton, T. J., &amp; Bray, B. E. (2010).</span></span>
<span><span class="co" style="color: #5E5E5E;"># Long run trends in the heights of European men, 19th–20th centuries.</span></span>
<span><span class="co" style="color: #5E5E5E;"># Economics &amp; Human Biology, 8(3), 405–413.</span></span>
<span><span class="co" style="color: #5E5E5E;"># http://doi.org/10.1016/j.ehb.2010.03.001</span></span>
<span><span class="co" style="color: #5E5E5E;"># stable URL, copied data (https://dx.doi.org/10.6084/m9.figshare.3394795.v1)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ndownloader.figshare.com/files/5303878"</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"country"</span>, <span class="st" style="color: #20794D;">"h_pop"</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">16</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>period <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"t1"</span>, <span class="st" style="color: #20794D;">"t2"</span><span class="op" style="color: #5E5E5E;">)</span>, sep <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"/"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>cohort <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">t1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">t2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">/</span><span class="fl" style="color: #AD0000;">2</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># calculate hockey players' cohort height averages for each country</span></span>
<span><span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>h_hp <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Unfortunately, our dataset on ice hockey players intersects with the data on population only for 8 countries: Austria, Denmark, Finland, France, Germany, Italy, Norway, and Sweden.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># countries in both data sets</span></span>
<span><span class="va" style="color: #111111;">both_cnt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hoc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span><span class="va" style="color: #111111;">both_cnt</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">gg_hoc_vs_pop</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"white"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_hp</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, pch <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_hp</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"height, cm"</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"birth cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-06-players-vs-population.png" class="img-fluid"></p>
<p><strong>Figure 6. The comparison of height dynamics in ice hockey players (brown) and the corresponding male populations (green)</strong></p>
<p>In all the analyzed countries, ice hockey players are 2-5 cm higher that the nation’s average. This is not very surprising since we expect some selection in sport. What is more interesting, in the developed countries the rapid increase in the height of males mostly leveled off in the birth cohorts of 1960s. Unlike the population trend, the height of ice hockey players continued to increase with roughly the same pace in all the analyzed countries except for Denmark.</p>
<p>For the cohorts of Europeans that were born in first half of 20-th century, the height of males increased by 1.18–1.74 cm per decade (Figure 7, middle panel). Starting from the birth cohorts of 1960s, the pace decreased to 0.15–0.80 per decade.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># growth in population</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb_w</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"y"</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">diffs</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">25</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb_gr</span><span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb_w</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, </span>
<span>                  gr_1961_1980 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">22</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">24</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span>, </span>
<span>                  gr_1901_1960 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span>, </span>
<span>                  gr_1856_1900 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"period"</span>, <span class="st" style="color: #20794D;">"average_growth"</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, levels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>               period <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"1856-1900"</span>, <span class="st" style="color: #20794D;">"1901-1960"</span>, <span class="st" style="color: #20794D;">"1961-1980"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_hb_growth</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_gr</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">average_growth</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>, <span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">2.15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"average growth in men's height over 10 years, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-07-av-growth-pop.png" class="img-fluid"></p>
<p><strong>Figure 7. Average changes in male population</strong></p>
<p>The height increase for ice hockey players seems quite impressive if we compare it to the stagnating dynamics in the corresponding male populations. And the acceleration of goalkeepers’ height is outright amazing.</p>
<p>The diverging trends in the height of ice hockey players and normal population is likely to be driven by the strengthening selection in sport.</p>
</section><section id="selection-in-ice-hockey" class="level1"><h1>Selection in ice hockey</h1>
<p>Looking through the literature on the selection in sport, I saw <a href="https://dx.doi.org/10.1080/02640410600908001">the finding</a> that showed a notable disproportion of professional sportsmen by the month of birth. There are much more sportsmen that were born in the first half of the year. They have a lasting advantage since the kids teams are usually formed by birth cohorts. Thus, those born earlier in the year always have a bit more time lived compared to their later born team mates, which means that they are physically more mature. It is easy to test the finding on our ice hockey players dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># check if there are more players born in earlier months</span></span>
<span><span class="va" style="color: #111111;">df_month</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>month <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>month <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_month</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_month</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"count"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">12</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">month.abb</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"month of birth"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-08-month-selectivity.png" class="img-fluid"></p>
<p><strong>Figure 8. The distribution of ice hockey players by month of birth</strong></p>
<p>True, the distribution is notably skewed – there are much more players born in earlier months. When I further split the dataset by the decades of birth, it becomes clear that the effect becomes more evident with time (Figure 9). Indirectly, that means that the selection in ice hockey becomes tougher.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># facet by decades</span></span>
<span><span class="va" style="color: #111111;">df_month_dec</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_month</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>dec <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                       <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"born in"</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"1960s"</span>, <span class="st" style="color: #20794D;">"1970s"</span>, <span class="st" style="color: #20794D;">"1980s"</span>, <span class="st" style="color: #20794D;">"1990s"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_month_dec</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_month_dec</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"count"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">12</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">month.abb</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"month of birth"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">dec</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, scales <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"free"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-09-month-selectivity-decades.png" class="img-fluid"></p>
<p><strong>Figure 9. The distribution of ice hockey players by month of birth – separately by decades of birth</strong></p>
</section><section id="reproducibility" class="level1"><h1>Reproducibility</h1>
<p>The full R script can be downloaded <a href="https://dx.doi.org/10.6084/m9.figshare.3395983.v2">here</a>.</p>
<hr>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>hockey</category>
  <category>sport</category>
  <category>height</category>
  <guid>https://ikashnitsky.github.io/2017/ice-hockey-players-height/index.html</guid>
  <pubDate>Fri, 26 May 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/ice-hockey-players-height/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Hacking maps with ggplot2</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/map-hacking/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>This is a very short post on mapping with <code>ggplot2</code>.</p>
<p>Quite often, mapping some data, we do not need to follow scrupulously the formal requirements to geographical maps – the idea is just to show the spatial dimension of the data. For instance, the network of rivers is not the most important information when we <a href="https://twitter.com/data_debunk/status/856251551970717698">map the elections outcome</a>. Thus, the simplified mapping allows quite some freedom in transforming the geodata. The classical example of such geodata transformation is the <a href="https://rpubs.com/technocrat/thematic-alaska-hawaii">replacement and scaling of Alaska and Hawaii</a> to be mapped alongside the mainland of the US. As one may see in this example, usually such geodata transformations utilize quite complex GIS tools in order to reposition an object in the coordinate system.</p>
<p>The interesting feature of mapping with <code>ggplot2</code> is that, before the actual plotting, geodata has to be fotrified (<code><a href="https://ggplot2.tidyverse.org/reference/fortify.html">ggplot2::fortify</a></code>) – transformed to a simple dataframe object. Since fortified geodata is basically a dataframe, some simple transformations could be made really easily.</p>
<p>In my last <a href="https://osf.io/suwxf/">paper</a>, I needed to show a two-dimensional grouping of the European NUTS-2 regions in 4 quadrants according to GDP per capita and the share of working-age population (see Figure 8 in the <a href="https://ikashnitsky.github.io/doc/pubs/1702-nidi-wp-ik.pdf">preprint</a>). In line with the study setting, I did the grouping separately for Western, Southern, and Eastern Europe. I decided that the most straightforward way to show that on map would be to visually separate the 3 subregions of Europe. The task is easily doable through triggering the fortified geodata object – see the code below.</p>
<p>First, the code to prepare the R session and load the (already prepared) data.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 1.1.1</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 0.17</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 3.4.0</span></span>
<span><span class="va" style="color: #111111;">font</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://github.com/hrbrmstr/hrbrthemes">hrbrthemes</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 0.1.0</span></span>
<span><span class="co" style="color: #5E5E5E;"># The code is tested on a PC-win7-x64</span></span>
<span><span class="co" style="color: #5E5E5E;"># R version 3.3.3</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load the prepared geodata and stat data</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1704-map-hacking/map-hacking.Rdata"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># fortify the spatial objects</span></span>
<span><span class="va" style="color: #111111;">bord</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sborders</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fort</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sn2</span>, region <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'id'</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Next, I hack the geodata (<code>long</code> and <code>lat</code> variables) moving groups of NUTS-2 regions (Western, Southern, and Eastern Europe) apart. The appropriate values to move the groups of regions were found empirically.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># hack geodata to separate macro-regions</span></span>
<span><span class="va" style="color: #111111;">fort_hack</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">fort</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span>, <span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'id'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>long <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">'E'</span>, <span class="va" style="color: #111111;">long</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">5e5</span>, <span class="va" style="color: #111111;">long</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>               long <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">'S'</span>, <span class="va" style="color: #111111;">long</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">2e5</span>, <span class="va" style="color: #111111;">long</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>               lat <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">'S'</span>, <span class="va" style="color: #111111;">lat</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">5e5</span>, <span class="va" style="color: #111111;">lat</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>               long <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">'W'</span>, <span class="va" style="color: #111111;">long</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">2e5</span>, <span class="va" style="color: #111111;">long</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Finally, we are ready to create the schematic map.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># create color pallete</span></span>
<span><span class="va" style="color: #111111;">brbg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">RColorBrewer</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>,<span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">brbg4</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">4</span>,<span class="fl" style="color: #AD0000;">9</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create the two-dim legend</span></span>
<span><span class="va" style="color: #111111;">ggleg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'rect'</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.45</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.6</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span>, </span>
<span>                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg4</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'rect'</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.45</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.6</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.4</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.55</span>, </span>
<span>                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg4</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'rect'</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.75</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.9</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span>, </span>
<span>                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg4</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'rect'</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.75</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.9</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.4</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.55</span>, </span>
<span>                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg4</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">]</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'rect'</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.05</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.95</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.05</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.95</span>, </span>
<span>                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey20"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'text'</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.35</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.175</span>, <span class="fl" style="color: #AD0000;">.475</span><span class="op" style="color: #5E5E5E;">)</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>,</span>
<span>                 size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">6</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'POOR'</span>, <span class="st" style="color: #20794D;">'RICH'</span><span class="op" style="color: #5E5E5E;">)</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">font</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'text'</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.525</span>, <span class="fl" style="color: #AD0000;">.825</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.65</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>,</span>
<span>                 size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">6</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'LOW'</span>, <span class="st" style="color: #20794D;">'HIGH'</span><span class="op" style="color: #5E5E5E;">)</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">font</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'text'</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.9</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>,</span>
<span>                 size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"LEGEND"</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">font</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create the blank map</span></span>
<span><span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">900000</span>,<span class="fl" style="color: #AD0000;">5400000</span><span class="op" style="color: #5E5E5E;">)</span>, xlim<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2500000</span>, <span class="fl" style="color: #AD0000;">7000000</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.border<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'black'</span>,size<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">.5</span>,fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'none'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># the main map</span></span>
<span><span class="va" style="color: #111111;">map_temp</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_map.html">geom_map</a></span><span class="op" style="color: #5E5E5E;">(</span>map <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">fort_hack</span>, data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>map_id<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">id</span>, fill<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg4</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">4</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># now combine the map and the legend</span></span>
<span><span class="va" style="color: #111111;">map</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">map_temp</span><span class="op" style="color: #5E5E5E;">)</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">ggleg</span><span class="op" style="color: #5E5E5E;">)</span>, xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.72</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.99</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.72</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.99</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Labour force and income in EU-27 NUTS-2 regions"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Within each of the three macro-regions of Europe - Westren, Southern, and Eastern -\nNUTS-2 regions are classified in 4 groups according to the level of GDP per capita\nand the share of working age population in 2008"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Data: Eurostat\nAuthor: Ilya Kashnitsky (ikashnitsky.github.io)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/hrbrthemes/man/theme_ipsum_rc.html">theme_ipsum_rc</a></span><span class="op" style="color: #5E5E5E;">(</span>plot_title_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">30</span>, subtitle_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, caption_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>And here is the result.</p>
<hr>
<p><img src="https://ikashnitsky.github.io/2017/map-hacking/hacked-map.png" class="img-fluid"></p>
<hr>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <category>rspatial</category>
  <guid>https://ikashnitsky.github.io/2017/map-hacking/index.html</guid>
  <pubDate>Sun, 23 Apr 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/map-hacking/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Who is old? Visualizing the concept of prospective ageing with animated population pyramids</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/who-is-old/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p><img src="https://ikashnitsky.github.io/2017/who-is-old/swe-animated.gif" class="img-fluid"></p>
<p>This post is about illustrating the concept of prospective ageing, a relatively fresh approach in demography to refine our understanding of population ageing. This visualization was created in collaboration with my colleague <a href="http://nidi.nl/en/staff/overview/boissonneault">Michael Boissonneault</a>: (mostly) his idea and (mostly) my implementation. The animated visualization builds upon Michael’s viz prepared for the submission to the highly anticipated event at the end June 2017 – <a href="http://www.rostock-retreat.org">Rostock Retreat Visualization</a>. My visualization of the <a href="http://www.rostock-retreat.org/files/application2017/SWE.csv">provided Swedish dataset</a> can be found in <a href="../../2017/gender-gap-in-swedish-mortality/">the previous post</a>.</p>
<section id="prospective-ageing" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="prospective-ageing">Prospective ageing</h2>
<p>Over the past decades the alarmist views of the upcoming population ageing disaster became widely spread. True, with the growing number of countries approaching the ending of the Demographic Transition, the average/median age of their population increases rapidly, which is something unprecedented in the documented human history. But does that imply an unbearable burden of elderly population in the nearest future? Not necessarily.</p>
<div class="page-columns page-full"><p>The demographic prospects depend a lot on how we define ageing. Quite recently <a href="http://www.iiasa.ac.at/web/home/research/researchPrograms/WorldPopulation/Staff/Warren_Sanderson.html">Waren Sanderson</a> and <a href="http://www.iiasa.ac.at/web/home/research/researchPrograms/WorldPopulation/Staff/Serguei-Scherbov.en.html">Sergei Scherbov</a> proposed <sup>1</sup> <sup>2</sup> a new way to look at population ageing, they called it Prospective Ageing. The underlying idea is really simple – age is not static: a person aged 65 (the conventional border deliminating elderly population) today is in many aspects not the same as a person ages 65 half a century ago. Health and lifespan improved a lot in the last decades, meaning that today people generally have much more remaining years of life at the moment of being recognized as elderly by the conventional standards. Thus, Sanderson and Scherbov proposed to define elderly population based on the estimation of the expected remaining length of life rather than years lived. Such a refined view of population ageing disqualifies the alarmist claims of the approaching demographic collapse. The would be paradoxical title of one the latest papers of Sanderson and Scherbov <sup>3</sup> summarizes the phenomenon nicely: <em>Faster Increases in Human Life Expectancy Could Lead to Slower Population Aging</em>.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Sanderson, W. C., &amp; Scherbov, S. (2005). Average remaining lifetimes can increase as human populations age. Nature, 435(7043), 811–813. Retrieved from http://www.nature.com/nature/journal/v435/n7043/abs/nature03593.html</p></li><li id="fn2"><p><sup>2</sup>&nbsp;Sanderson, W. C., &amp; Scherbov, S. (2010). Remeasuring Aging. Science, 329(5997), 1287–1288. https://doi.org/10.1126/science.1193647</p></li><li id="fn3"><p><sup>3</sup>&nbsp;Sanderson, W. C., &amp; Scherbov, S. (2015). Faster Increases in Human Life Expectancy Could Lead to Slower Population Aging. PLoS ONE, 10(4), e0121922. http://doi.org/10.1371/journal.pone.0121922</p></li></div></div>
<div class="page-columns page-full"><p>Of course, the choice of the new ageing threshold is a rather arbitrary question <sup>4</sup>. It became usual to define this threshold at the remaining life expectancy of 15 years.</p><div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;See the <a href="http://www.nidi.nl/shared/content/output/papers/nidi-wp-2017-01.pdf">working paper</a> of my colleagues devoted to this question</p></li></div></div>
</section><section id="population-pyramids-for-sweden" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="population-pyramids-for-sweden">Population pyramids for Sweden</h2>
<p>Population pyramid is a simple and nice way to represent population composition and to compare changes in the age structure of a given population over time. We show the difference between conventional and prospective approach to the definition of the elderly population using Swedish data for the last half a century. Sweden is a natural choice for demographers aiming to play with rich and reliable data.</p>
<div class="page-columns page-full"><p>The data used for this visualization comes from <a href="http://www.mortality.org">Human Mortality Database</a>. It can be easily accessed from an R session using <a href="https://cran.r-project.org/web/packages/HMDHFDplus/index.html"><code>HMDHFDplus</code></a> package by <a href="https://sites.google.com/site/timriffepersonal/about-me">Tim Riffe</a> (for examples see my previous posts - <a href="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/">one</a> and <a href="https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/">two</a>). For this exercise, I will use the dataset for Sweden that was provided for an application task for <a href="http://www.rostock-retreat.org">Rostock Retreat Visualization</a> <sup>5</sup>.</p><div class="no-row-height column-margin column-container"><li id="fn5"><p><sup>5</sup>&nbsp;By using this data, I agree to the <a href="http://www.mortality.org/Public/UserAgreement.php">user agreement</a></p></li></div></div>
</section><section id="data-preparation" class="level2"><h2 class="anchored" data-anchor-id="data-preparation">Data preparation</h2>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Ubuntu Mono"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download data</span></span>
<span><span class="va" style="color: #111111;">df_swe</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"http://www.rostock-retreat.org/files/application2017/SWE.csv"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># copy at https://ikashnitsky.github.io/doc/misc/application-rostock-retreat/SWE.csv</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># define the selection of years to visualize</span></span>
<span><span class="va" style="color: #111111;">years</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1965</span>, <span class="fl" style="color: #AD0000;">2010</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_swe</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span>, <span class="va" style="color: #111111;">Sex</span>, <span class="va" style="color: #111111;">Age</span>, <span class="va" style="color: #111111;">Exposure</span>, <span class="va" style="color: #111111;">ex</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>old_c <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span> <span class="op" style="color: #5E5E5E;">&gt;=</span> <span class="fl" style="color: #AD0000;">65</span>, </span>
<span>               old_p <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">ex</span> <span class="op" style="color: #5E5E5E;">&lt;=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"type"</span>, <span class="st" style="color: #20794D;">"old"</span>, <span class="fu" style="color: #4758AB;"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"old"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span>, <span class="va" style="color: #111111;">Sex</span>, <span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>share <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Exposure</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Exposure</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>share <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'f'</span>, <span class="va" style="color: #111111;">share</span>, <span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">share</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">old</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">sex</span>, <span class="va" style="color: #111111;">type</span>, <span class="va" style="color: #111111;">old</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>cum_old <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">share</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> </span></code></pre></div>
</div>
</section><section id="visualization" class="level2"><h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<p>Let’s first have a look at the pyramids in 1965, 1990, and 2014 (the latest available year).</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">gg_three</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1965</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">age</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">share</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sex</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">old</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'identity'</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op" style="color: #5E5E5E;">(</span>xintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">64.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'gold'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.01</span>, <span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.01</span>, <span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.02</span>, <span class="fl" style="color: #AD0000;">.02</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>strip.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'none'</span>,</span>
<span>              plot.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              plot.caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span>             x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Age'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op" style="color: #5E5E5E;">(</span>type <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'old_c'</span>, <span class="st" style="color: #20794D;">'old_p'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                    label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'CONVENTIONAL'</span>, <span class="st" style="color: #20794D;">'PROSPECTIVE'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">label</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">50</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, </span>
<span>                  family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1965</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'f'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">30</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>, </span>
<span>                  family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1965</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'f'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Elderly\nfemales\n'</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cum_old</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">100</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'%'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.0125</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">105</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span>, </span>
<span>                  family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1965</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'m'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Elderly\nmales\n'</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">cum_old</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">100</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'%'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  y <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.0125</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">105</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span>, </span>
<span>                  family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;">#ggsave("figures/three-years.png", gg_three, width = 6, height = 8)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/who-is-old/three-years.png" class="img-fluid"></p>
</section><section id="animated-pyramid" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="animated-pyramid">Animated pyramid</h2>
<div class="page-columns page-full"><p>To get an animated pyramid I simply saved all the separate plots and then use the very convenient free online tool to make an animated image - <a href="http://gifcreator.me">GIFCreator</a> <sup>6</sup>.</p><div class="no-row-height column-margin column-container"><li id="fn6"><p><sup>6</sup>&nbsp;I did try to play with the package <code>gganimate</code>, though it produced a strange output.</p></li></div></div>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">note</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">'The population pyramid can be used to compare change in the age structure of a given population over time. In many cases, doing so gives the impression of rapid aging. This is due to the fact that age is represented as a static variable; however, as Sanderson and Scherbov showed repeatedly, age is not static: a person age 65 in 1965 is in many aspects not the same as a person age 65 in 2015. In the right panel, old age is considered to start when the period remaining life expectancy reaches 15 years, thereby providing another look at the change in the age structure of a population. The gold line deliminates the conventional border of old age at 65. Elderly populations are filled with non-transparent colors. Authors: Michael Boissonneault, Ilya Kashnitsky (NIDI)'</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># I will store the plots in a list</span></span>
<span><span class="va" style="color: #111111;">plots</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="kw" style="color: #003B4F;">for</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>        </span>
<span>        <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">age</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">share</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sex</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">old</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                         stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'identity'</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op" style="color: #5E5E5E;">(</span>xintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">64.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'gold'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.01</span>, <span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.01</span>, <span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                   limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.02</span>, <span class="fl" style="color: #AD0000;">.02</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">type</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>strip.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'none'</span>,</span>
<span>                      plot.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      plot.caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>                </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Sweden"</span>, <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">note</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">106</span><span class="op" style="color: #5E5E5E;">)</span>, collapse <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'\n'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span>                     x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Age'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op" style="color: #5E5E5E;">(</span>type <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'old_c'</span>, <span class="st" style="color: #20794D;">'old_p'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                            label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'CONVENTIONAL'</span>, <span class="st" style="color: #20794D;">'PROSPECTIVE'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                          <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">label</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                          y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">115</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, </span>
<span>                          family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'f'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                          <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Elderly\nfemales\n'</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cum_old</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">100</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'%'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                          y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.0125</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">105</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span>, </span>
<span>                          family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_old</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'m'</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                          <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Elderly\nmales\n'</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">cum_old</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">100</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'%'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                          y <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">.0125</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">105</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span>, </span>
<span>                          family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'Ubuntu Mono'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        <span class="va" style="color: #111111;">plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">gg</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># # a loop to save the plots</span></span>
<span><span class="co" style="color: #5E5E5E;"># for (i in 1:length(years)){</span></span>
<span><span class="co" style="color: #5E5E5E;">#         ggsave(paste0('figures/swe-', years[i], '.png'), plots[[i]], </span></span>
<span><span class="co" style="color: #5E5E5E;">#                       width = 8, height = 5.6)</span></span>
<span><span class="co" style="color: #5E5E5E;"># }</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/who-is-old/swe-animated.gif" class="img-fluid"></p>
<hr>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>animaion</category>
  <category>pyramid</category>
  <category>sweden</category>
  <category>prospective ageing</category>
  <guid>https://ikashnitsky.github.io/2017/who-is-old/index.html</guid>
  <pubDate>Thu, 30 Mar 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/who-is-old/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>R, GIS, and fuzzyjoin to reconstruct demographic data for NUTS regions of Denmark</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>NUTS stands for the <a href="http://ec.europa.eu/eurostat/web/nuts/overview"><em>Nomenclature of Territorial Units For Statistics</em></a>. The history of NUTS dates back to the beginning of 1970s, when European countries developed unified standards for systems of administrative geography. It was not until the beginning of this century when such a system finally became widely used. There are three main hierarchical levels of NUTS, and the most commonly used for regional analysis is NUTS-2.</p>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-01-nuts.png" class="img-fluid"><em>Figure 1. Illustration of the principle of NUTS hierarchical system</em></p>
<p>One of the objectives of NUTS was to provide more or less comparable administrative divisions for all countries of Europe. Nevertheless, in 2013, population figures for single NUTS-2 regions ranged from 28.5 thousands in <em>Aland island</em> (Finland) to almost 12 million in <em>Ile-de-France</em> (Paris and surroundings, France).</p>
<section id="the-broken-time-series" class="level2"><h2 class="anchored" data-anchor-id="the-broken-time-series">The broken time series</h2>
<p>Quite arbitrary in its essence, territorial division tends to evolve. Changes in administrative boundaries can cause problems for regional analysis as they break the time series and therefore make it harder to analyze trends. Despite this inconvenience, the boundaries of regions actually change quite often based on the needs and interests of local or national governmenta. Eurostat <a href="http://ec.europa.eu/eurostat/web/nuts/history">tracks all modifications</a> providing detailed explanations of all the changes that happen between versions of NUTS (figure 2).</p>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-02-nuts-changes.png" class="img-fluid"><em>Figure 2. Changes in NUTS between versions 2006 and 2010</em></p>
<p>Despite this, Eurostat does not recalculate historic demographic data to match the most recent NUTS version. This means that, for the most recent version of NUTS, there is missing data for all years before the latest administrative change. So researchers have to reconstruct historical data manually to obtain a long time series. Of course, crude assumptions often have to be accepted in order to approximate the population figures for the current regions that did not exist in the past.</p>
<p>To make thing even more complex, Eurostat provides the data only for the latest version of NUTS (at least, I did not work out how to download previous versions). In <a href="http://nidi.nl/en/research/al/270rdc">my PhD project</a> I carry out regional analysis for the NUTS-2 regions of European Union. To have the longest possible time series, when I did the data preparation in 2015, I chose the 2010 version of NUTS, on which the regional demographic projection <a href="http://ec.europa.eu/eurostat/web/population-demography-migration-projections/population-projections-data">EUROPOP2013</a> is based. For reproducibility, I uploaded the precise versions of the Eurostat data at NUTS-2 level on <a href="https://doi.org/10.6084/m9.figshare.3084394">population age structures</a> and <a href="https://doi.org/10.6084/m9.figshare.3084418">deaths</a>, as downloaded in 2015, to <a href="https://figshare.com/">figshare</a>.</p>
</section><section id="denmark" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="denmark">Denmark</h2>
<p>Some countries had to perform major changes in their systems of territorial division to fit the NUTS standards. <a href="http://www.tandfonline.com/doi/abs/10.1080/03003930903560562">The most significant reform happened in Denmark in 2007</a>, where the former 271 municipalities were transformed into the new 98 municipalities. At the same time, NUTS was introduced, so that 98 municipalities were allocated to 11 NUTS-3 regions, which aggregate to 5 NUTS-2 regions. Typically, for a small country, there is only one NUTS-1 region in Denmark, which is the whole country.</p>
<p>As far as I know, there was no official attempt of Eurostat to reconstruct the time series for Denmark before 2007. The typical map of Eurostat for the pre-2007 period shows Denmark as “no data available” country (figure 3).</p>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-03-nuts-2-life-exp.png" class="img-fluid"><em>Figure 3. Life expectancy at birth in European NUTS-2 regions, 2006; a screenshot from the Eurostat’s <a href="http://ec.europa.eu/eurostat/cache/RCI">interactive data exploratory tool</a></em></p>
<div class="page-columns page-full"><p>Such a data loss is somewhat surprising for a country such as Denmark. It might be quite difficult to match the old and new municipal systems; but it should be relatively easy to re-aggregate the old municipalities into the new (higher level) NUTS regions. That is precisely what I did during my data preparation<sup>1</sup> and what I now want to share in this post.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;I have spent quite some time searching if someone else did the job before me and failed to find.</p></li></div></div>
<p>The task is basically to identify which of the old 271 municipalities are located within the modern 11 NUTS-3 regions and to aggregate the municipal data. Then, NUTS-3 data is easily aggregated for the NUTS-2 level. Such a task could have meant working late into the night, but luckily we live in the GIS era. I used GIS to match the old municipalities with the NUTS-3 regions. Here I want to show (with code) how the task can be performed using the amazing and opensource <a href="https://cran.r-project.org">R</a>. Below I show the process of matching old municipalities to the NUTS regions and the process that I used to aggregate population data.</p>
</section><section id="data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The data on the population age structures for the old 271 municipalities of Denmark was downloaded from the <a href="www.statbank.dk/BEF1A">official website of Statistics Denmark</a>. The system only allows you to grab up to 10K cells for unregistered users and up to 100K for registered users. So the process of downloading the data involves some tedious manual manipulations. For the purpose of my phd project, I downloaded the data for the period 2001-2006; but, if needed, the data is available since 1979. The data, downloaded in 2015 and ‘tidied up’ can be found <a href="https://ikashnitsky.github.io/share/1703-nuts2-denmark/BEF1A.csv.gz">here</a>.</p>
<div class="page-columns page-full"><p>I have spent a lot of time trying to find geodata with the boundaries of the old municipalities. Now, coming back to the topic more than 1.5 year later, I failed to identify the original source of the shapefile, though I am pretty sure that it came from <a href="http://www.geodatabiblioteket.dk/index.php">here</a> <sup>2</sup>. The copy of the shapefile that I used can be found <a href="https://ikashnitsky.github.io/share/1703-nuts2-denmark/kommune2006utf8.tgz">here</a>.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;There is a note on the website saying that, due to a planned change in the structure of the website, there might be some problems with data accuisition. I failed to download the geodata on 2017-02-23.</p></li></div></div>
<p>Finally, we need a shapefile of NUTS-3 regions. It can be easily downloaded from <a href="http://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/nuts">Eurostat geodata repository</a>. The shapefile that I used is “NUTS_2010_20M_SH.zip”. The selection of the 11 Danish regions can be found <a href="https://ikashnitsky.github.io/share/1703-nuts2-denmark/denmark-nuts3-espg3044.tgz">here</a>.</p>
<p>The projection used for both shapefiles is <a href="https://epsg.io/3044">ESPG-3044</a>, the one often used to map Denmark.</p>
<p>Now, the code to prepare the R session and load the data.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># set locale and encoding parameters to read Danish</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="st" style="color: #20794D;">'sysname'</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Linux"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/locales.html">Sys.setlocale</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"LC_CTYPE"</span>, <span class="st" style="color: #20794D;">"da_DK.utf8"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="va" style="color: #111111;">danish_ecnoding</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"WINDOWS-1252"</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span><span class="kw" style="color: #003B4F;">else</span> <span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Sys.info.html">Sys.info</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="st" style="color: #20794D;">'sysname'</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Windows"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/locales.html">Sys.setlocale</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"LC_CTYPE"</span>, <span class="st" style="color: #20794D;">"danish"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="va" style="color: #111111;">danish_ecnoding</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Danish_Denmark.1252"</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load required packages (install first if needed)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 1.0.0</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 3.3.0</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 1.2-4</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://r-forge.r-project.org/projects/rgeos/">rgeos</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 0.3-21</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">RColorBrewer</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 1.1-2</span></span>
<span><span class="va" style="color: #111111;">mypal</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>, <span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/dgrtwo/fuzzyjoin">fuzzyjoin</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 0.1.2</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version: 0.3.4</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load Denmark pop structures for the old municipalities</span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1703-nuts2-denmark/BEF1A.csv.gz"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a directory for geodata</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"geodata"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"geodata"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"Directory already exists"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download, unzip and read Danish NUTS-3 geodata (31KB)</span></span>
<span><span class="va" style="color: #111111;">url_nuts</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1703-nuts2-denmark/denmark-nuts3-espg3044.tgz"</span></span>
<span><span class="va" style="color: #111111;">path_nuts</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"geodata/denmark-nuts3-espg3044.tgz"</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_nuts</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">url_nuts</span>, <span class="va" style="color: #111111;">path_nuts</span>, mode<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"wb"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'file alredy exists'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># If there are problems downloading the data automatically, please download it manually from</span></span>
<span><span class="co" style="color: #5E5E5E;"># https://ikashnitsky.github.io/share/1703-nuts2-denmark/denmark-nuts3-espg3044.tgz</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op" style="color: #5E5E5E;">(</span>tarfile <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">path_nuts</span>, exdir <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"geodata"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">sp_nuts3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op" style="color: #5E5E5E;">(</span>dsn <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"geodata/."</span>, layer <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"denmark-nuts3-espg3044"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">gd_nuts3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sp_nuts3</span>, region <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"NUTS_ID"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># to the ggplot format</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download, unzip and read Danish old municipal geodata (6.0MB)</span></span>
<span><span class="va" style="color: #111111;">url_mun</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1703-nuts2-denmark/kommune2006win1252.tgz"</span></span>
<span><span class="va" style="color: #111111;">path_mun</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"geodata/kommune2006win1252.tgz"</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_mun</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">url_mun</span>, <span class="va" style="color: #111111;">path_mun</span>, mode<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"wb"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">'file alredy exists'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># If there are problems downloading the data automatically, please download it manually from</span></span>
<span><span class="co" style="color: #5E5E5E;"># https://ikashnitsky.github.io/share/1703-nuts2-denmark/kommune2006utf8.tgz</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/untar.html">untar</a></span><span class="op" style="color: #5E5E5E;">(</span>tarfile <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">path_mun</span>, exdir <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"geodata"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">sp_mun</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op" style="color: #5E5E5E;">(</span>dsn <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"geodata/."</span>, layer <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"kommune2006win1252"</span>, encoding <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">danish_ecnoding</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="va" style="color: #111111;">gd_mun</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sp_mun</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># coordinates of the municipalities</span></span>
<span><span class="va" style="color: #111111;">mun_coord</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sp_mun</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sp_mun</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">[</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>long <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">V1</span>, lat <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">V2</span>, <span class="va" style="color: #111111;">enhedid</span>, <span class="va" style="color: #111111;">objectid</span>, name <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">navn</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="spatial-matching" class="level2"><h2 class="anchored" data-anchor-id="spatial-matching">Spatial matching</h2>
<p>Let’s first have a look at the map.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_nuts3</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mun_coord</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-04-ref-map.png" class="img-fluid"><em>Figure 4. Reference map of the old municipalities and NUTS-3 regions of Denmark</em></p>
<p>We can easily see that the boundaries of the municipalities (light blue) are much more precise than that of the NUTS-3 regions (orange/brown). This is not a problem as long as all the centroids of the municipalities fall within the boundaries of the NUTS-3 regions, which seems to be true for all municipalities except for the easternmost one. A quick check reveals that this is <a href="https://en.wikipedia.org/wiki/Ertholmene">Christiansø</a>, a tiny fortified island, whose <a href="http://www.christiansoe.dk/historien">history</a> goes back to the Middle Ages. It has a special status and <a href="http://www.dst.dk/da/Statistik/dokumentation/Nomenklaturer/NUTS">is not included</a> into the NUTS system. For further manipulations, Christiansø can safely merge it with the close-by Bornholm.</p>
<p>To identify which municipalities fall into which NUTS regions, I use the spatial overlap function (<code>over</code>) from <code>sp</code> package. Here I should thank <a href="https://www.nhh.no/en/employees/faculty/roger-bivand/">Roger Bivand</a>, a person who made it possible to do any spatial analysis in R.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># municipality coordinates to Spatial</span></span>
<span><span class="va" style="color: #111111;">mun_centr</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPoints</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sp_mun</span><span class="op" style="color: #5E5E5E;">)</span>, proj4string <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sp_nuts3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># spatial intersection with sp::over</span></span>
<span><span class="va" style="color: #111111;">inter</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mun_coord</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/sp/man/over.html">over</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mun_centr</span>, <span class="va" style="color: #111111;">sp_nuts3</span><span class="op" style="color: #5E5E5E;">[</span>,<span class="st" style="color: #20794D;">"NUTS_ID"</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, <span class="va" style="color: #111111;">objectid</span>,</span>
<span>                  nuts3 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">NUTS_ID</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  nuts2 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nuts3</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Let’s again check visually if the spatial matching worked okay.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_mun</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_nuts3</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">inter</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">inter</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">inter</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span><span class="op" style="color: #5E5E5E;">)</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"red"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>, pch <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-05-map-match.png" class="img-fluid"><em>Figure 5. Checking the spatial intersection between the old municipalities and NUTS-3 regions of Denmark</em></p>
<p>Not bad. But there is an “NA” category that represents all the cases where the spatial match failed. How many such cases do we have?</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># how many failed cases do we have</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">inter</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## [1] 3</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># where the intersection failed</span></span>
<span><span class="va" style="color: #111111;">inter</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">inter</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="op" style="color: #5E5E5E;">]</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">##         long     lat objectid nuts3 nuts2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 23  892474.0 6147918    46399  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;">## 65  504188.4 6269329   105319  &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;">## 195 533446.8 6312770    47071  &lt;NA&gt;  &lt;NA&gt;</span></span></code></pre></div>
</div>
<p>As there are only 3 cases, I decided to fix them manually.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># fix the three cases manually</span></span>
<span><span class="va" style="color: #111111;">fixed</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">inter</span></span>
<span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"46399"</span>, <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"DK014"</span>, <span class="st" style="color: #20794D;">"DK01"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"105319"</span>, <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"DK041"</span>, <span class="st" style="color: #20794D;">"DK04"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fixed</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"47071"</span>, <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"DK050"</span>, <span class="st" style="color: #20794D;">"DK05"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The final visual check.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_mun</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_nuts3</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">fixed</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-06-map-check.png" class="img-fluid"><em>Figure 6. Re-checking the spatial intersection between the old municipalities and NUTS-3 regions of Denmark</em></p>
<p>Now everything seems okay.</p>
</section><section id="joining-spatial-and-statistical-data-fuzzy-join" class="level2"><h2 class="anchored" data-anchor-id="joining-spatial-and-statistical-data-fuzzy-join">Joining spatial and statistical data (fuzzy join)</h2>
<p>The next task is to join the spatial data and statistical data together. The spatial layer for municipalities does not contain the codes that are used by Statistics Denmark, so I have to match municipalities in the two datasets by their names. This is quite a difficult task. Names can be written slightly differently, there are some special characters in Danish alphabet, and some municipalities may have experienced a change of name. To solve the task most efficiently, I used the ‘Fuzzy String Matching’ approach which is implemented in the <a href="https://github.com/dgrtwo/fuzzyjoin"><code>fuzzyjoin</code></a> package by <a href="http://varianceexplained.org/about/">David Robinson</a>.</p>
<p>First, I simplify the names in both datasets turning them into lowercase, replacing the character “å” with “aa”, and removing the “Kommune” word in the spatial dataset names. Please note that I downloaded (separately) a small selection from Statistics Denmark to have a <a href="https://ikashnitsky.github.io/share/1703-nuts2-denmark/stat-names-codes.csv.gz">lightweight dataframe</a> with municipal codes and names.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># simplify municipalities names</span></span>
<span><span class="va" style="color: #111111;">mun_geo</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">mun_coord</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">name</span>, <span class="st" style="color: #20794D;">" Kommune"</span>, replacement <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"å"</span>, <span class="st" style="color: #20794D;">"aa"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">mun_stat</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv2</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1703-nuts2-denmark/stat-codes-names.csv"</span>, </span>
<span>                      fileEncoding <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">danish_ecnoding</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, into <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"code"</span>, <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">)</span>, sep <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">" "</span>, extra <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"merge"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"\\s*\\([^\\)]+\\)"</span>, <span class="st" style="color: #20794D;">""</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"å"</span>, <span class="st" style="color: #20794D;">"aa"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Let’s try fuzzy join.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># first attempt</span></span>
<span><span class="va" style="color: #111111;">fuz_joined_1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/fuzzyjoin/man/regex_join.html">regex_left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mun_geo</span>, <span class="va" style="color: #111111;">mun_stat</span>, by <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The resulting dataframe has 278 rows instead of 271. That means that for some municipalities in the spatial dataset there was more than one match. Let’s identify them.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># identify more that 1 match (7 cases) and select which to drop</span></span>
<span><span class="va" style="color: #111111;">fuz_joined_1</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">n</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## Source: local data frame [14 x 5]</span></span>
<span><span class="co" style="color: #5E5E5E;">## Groups: objectid [7]</span></span>
<span><span class="co" style="color: #5E5E5E;">## </span></span>
<span><span class="co" style="color: #5E5E5E;">##         name.x objectid  code      name.y     n</span></span>
<span><span class="co" style="color: #5E5E5E;">##          &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;">## 1       haslev   105112   313      haslev     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 2       haslev   105112   403       hasle     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 3  brønderslev    47003   739       rønde     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 4  brønderslev    47003   805 brønderslev     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 5    hirtshals    47037   817        hals     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 6    hirtshals    47037   819   hirtshals     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 7      rønnede    46378   385     rønnede     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 8      rønnede    46378   407       rønne     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 9     hvidebæk    46268   317    hvidebæk     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 10    hvidebæk    46268   681     videbæk     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 11    ryslinge    46463   477    ryslinge     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 12    ryslinge    46463   737          ry     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 13     aarslev    46494   497     aarslev     2</span></span>
<span><span class="co" style="color: #5E5E5E;">## 14     aarslev    46494   861        aars     2</span></span></code></pre></div>
</div>
<p>So, for 7 municipalities, two matches were found. I will drop the imperfect match variants in the next iteration of fuzzy join.</p>
<p>The other issue is the municipalities for which no match was found in that statistical data.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># show the non-matched cases</span></span>
<span><span class="va" style="color: #111111;">fuz_joined_1</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">code</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">##              name.x objectid code name.y</span></span>
<span><span class="co" style="color: #5E5E5E;">## 1              faxe   105120 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;">## 2 nykøbing falsters    46349 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co" style="color: #5E5E5E;">## 3       herstederne    46101 &lt;NA&gt;   &lt;NA&gt;</span></span></code></pre></div>
</div>
<p>As there are only three such cases, I corrected them manually in the spatial data to match the statistical data. There are two cases of a difference in the way the name of municipality are written and <a href="http://albertslund.lokalavisen.dk/fra-herstederne-til-albertslund-/20131017/artikler/710179831">one case of name change</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># correct the 3 non-matching geo names</span></span>
<span><span class="va" style="color: #111111;">mun_geo_cor</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">mun_geo</span></span>
<span></span>
<span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"faxe"</span>, <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"fakse"</span></span>
<span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"nykøbing falsters"</span>, <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"nykøbing f."</span></span>
<span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">mun_geo_cor</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"herstederne"</span>, <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"albertslund"</span></span></code></pre></div>
</div>
<p>Now the second attempt to match the datasets (spatial dataset is corrected).</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># second attempt</span></span>
<span><span class="va" style="color: #111111;">fuz_joined_2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/fuzzyjoin/man/regex_join.html">regex_left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mun_geo_cor</span>, <span class="va" style="color: #111111;">mun_stat</span>, by <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"name"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># drop non-perfect match</span></span>
<span><span class="va" style="color: #111111;">fuz_joined_2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">fuz_joined_2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">objectid</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">n</span> <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fl" style="color: #AD0000;">2</span> <span class="op" style="color: #5E5E5E;">|</span> <span class="va" style="color: #111111;">name.x</span><span class="op" style="color: #5E5E5E;">==</span><span class="va" style="color: #111111;">name.y</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">fuz_joined_2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">fuz_joined_2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">name.x</span>, <span class="va" style="color: #111111;">objectid</span>, <span class="va" style="color: #111111;">code</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The output looks perfect. Now, the last step – using the matched “objectid” field, I will finally attach the NUTS data to statistical codes.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># finally, attach the NUTS info to matched table</span></span>
<span><span class="va" style="color: #111111;">key</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fuz_joined_2</span>, <span class="va" style="color: #111111;">fixed</span>, <span class="st" style="color: #20794D;">"objectid"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="aggregate-old-municipal-data-to-nuts-levels" class="level2"><h2 class="anchored" data-anchor-id="aggregate-old-municipal-data-to-nuts-levels">Aggregate old municipal data to NUTS levels</h2>
<p>The previous manipulations yielded a dataframe that links statistical codes of the old municipalities with the corresponding NUTS regions. The last thing that has to be done is aggregation. I will attach the “key” dataset to a statistical dataset and aggregate the data at NUTS-3 and NUTS-2 levels.</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># finally, we only need to aggregate the old stat data</span></span>
<span><span class="va" style="color: #111111;">df_agr</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">key</span>, <span class="va" style="color: #111111;">df</span>, <span class="st" style="color: #20794D;">"code"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year"</span>, <span class="st" style="color: #20794D;">"value"</span>, <span class="va" style="color: #111111;">y2001</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">y2006</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_nuts3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_agr</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">sex</span>, <span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_nuts2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_agr</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">sex</span>, <span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">nuts2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Let’s now calculate the shares of working age population in Danish NUTS-3 regions in 2001 and map the information.</p>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># total population in 2001 by NUTS-3 regions</span></span>
<span><span class="va" style="color: #111111;">tot_01</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_nuts3</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"y2001"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>tot <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># working-age population in 2001 by NUTS-3 regions</span></span>
<span><span class="va" style="color: #111111;">working_01</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_nuts3</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"y2001"</span>, <span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"a0"</span>, <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">64</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nuts3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>work <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># calculate the shares of working age population</span></span>
<span><span class="va" style="color: #111111;">sw_01</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">working_01</span>, <span class="va" style="color: #111111;">tot_01</span>, <span class="st" style="color: #20794D;">"nuts3"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>sw <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">work</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="va" style="color: #111111;">tot</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># map the shares of working age population in 2001 by NUTS-3 regions</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">gd_nuts3</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sw_01</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"id"</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"nuts3"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">long</span>, <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sw</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/fig-07-map-sw.png" class="img-fluid"><em>Figure 7. The share of working age (15-64) population by NUTS-3 regions of Denmark in 2001</em></p>
<p>The result (thankfully!) looks realistic, with higher shares of the working-age population in the capital region, and in other regions that have relatively big cities.</p>
<hr>
<center>
<button class="btn btn-lg btn-secondary" type="button">
<a href="https://demotrends.wordpress.com/2017/03/16/working-with-spatial-data-to-generate-a-consistent-demographic-time-series/">This post is written for Demotrends</a>.
</button>
</center>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>rspatial</category>
  <category>denmark</category>
  <category>nuts</category>
  <guid>https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/index.html</guid>
  <pubDate>Wed, 15 Mar 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Gender gap in Swedish mortality</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/gender-gap-in-swedish-mortality/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>Sweden, with its high quality statistical record since 1748, is the natural choice for any demographic study that aims to cover population dynamics during a long period of time.</p>
<section id="data" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="data">Data</h2>
<div class="page-columns page-full"><p>The data used for this visualization comes from <a href="http://www.mortality.org">Human Mortality Database</a>. It can be easily accessed from an R session using <a href="https://cran.r-project.org/web/packages/HMDHFDplus/index.html"><code>HMDHFDplus</code></a> package by <a href="https://sites.google.com/site/timriffepersonal/about-me">Tim Riffe</a> (for examples see my previous posts - <a href="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/">one</a> and <a href="https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/">two</a>). For this exercise, I will use the dataset for Sweden that was provided for an application task for <a href="http://www.rostock-retreat.org">Rostock Retreat Visualization</a><sup>1</sup>.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;By using this data, I agree to the <a href="http://www.mortality.org/Public/UserAgreement.php">user agreement</a></p></li></div></div>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download data</span></span>
<span><span class="va" style="color: #111111;">df_swe</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"http://www.rostock-retreat.org/files/application2017/SWE.csv"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># copy at https://ikashnitsky.github.io/doc/misc/application-rostock-retreat/SWE.csv</span></span>
<span></span>
<span><span class="va" style="color: #111111;">years</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1751</span>, <span class="fl" style="color: #AD0000;">1800</span>, <span class="fl" style="color: #AD0000;">1850</span>, <span class="fl" style="color: #AD0000;">1900</span>, <span class="fl" style="color: #AD0000;">1925</span>, <span class="fl" style="color: #AD0000;">1950</span>, <span class="fl" style="color: #AD0000;">1960</span>, <span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1980</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">2000</span>, <span class="fl" style="color: #AD0000;">2010</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># select years and calculate male-to-female arte-ratio of mortality</span></span>
<span><span class="va" style="color: #111111;">df_selected</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_swe</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span>, <span class="va" style="color: #111111;">Sex</span>, <span class="va" style="color: #111111;">Age</span>, <span class="va" style="color: #111111;">mx</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">years</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sex</span>, <span class="va" style="color: #111111;">mx</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>year <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Year</span>, age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span>, value <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">m</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="va" style="color: #111111;">f</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="visualization" class="level2"><h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_selected</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op" style="color: #5E5E5E;">(</span>yintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'grey25'</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, pch<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'grey50'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">value</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">year</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Male-to-female age-specific mortality rate ratio, Sweden"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Untill quite recent times, mortality of females was not much lower than that of males"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"\nData: Human Mortality Database (https://mortality.org)</span></span>
<span><span class="st" style="color: #20794D;">             Note: Colored lines are produced with loess smoothing"</span>,</span>
<span>             x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Age"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Rate ratio"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'none'</span>,</span>
<span>              plot.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Roboto Mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/gender-gap-in-swedish-mortality/sweden.png" class="img-fluid"></p>
</section><section id="comment" class="level2"><h2 class="anchored" data-anchor-id="comment">Comment</h2>
<p>Today it is common knowledge that male mortality is always higher than female. There are more males being born, then eventually the sex ratio levels due to higher male mortality (see <a href="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/">my previous post</a>). Though, male mortality was not always much higher. Back in the days, when infant mortality was much higher and women used to have much higher fertility, there was almost no gender gap in age-specific mortality levels. Constant pregnancy and frequent childbirths had a strong negative impact on female health and survival statistics. We can see that only in the second half of the 20-th century gender gap in mortality became substantial in Sweden.</p>
<hr>
<center>
<button class="btn btn-lg btn-secondary" type="button">
This post is based on my earlier <a href="https://twitter.com/ikashnitsky/status/802310186560081920">tweet</a> and <a href="https://gist.github.com/ikashnitsky/872d3a97390a60d26eeb64f0f5600067">gist</a>.
</button>
</center>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>tw</category>
  <category>death rates</category>
  <category>sweden</category>
  <category>sex gap</category>
  <guid>https://ikashnitsky.github.io/2017/gender-gap-in-swedish-mortality/index.html</guid>
  <pubDate>Fri, 24 Feb 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/gender-gap-in-swedish-mortality/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>30 issues of Demographic Digest - the most frequent journals</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/dd-journals-frequency/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>This week, the 30-th issue of my Demographic Digest <a href="http://demoscope.ru/weekly/2017/0715/digest01.php">was published</a>.</p>
<p><a href="../../dd">Demographic Digest</a> is my project that started in November 2015. Twice a month I select fresh demographic papers and write brief summaries of them in Russian to be published in <a href="http://demoscope.ru">Demoscope Weekly</a>, the most popular Russian journal/website in social sciences. If you read Russian, you may want to browse <a href="http://demoscope.ru/weekly/arc/arcdigest.php">the archive</a> or visit <a href="https://ikashnitsky.github.io/dem-digest/">the website</a> of the project (which is still to be filled).</p>
<p>The project is in the transitional phase now. Since 2016 Demographic Digest welcomes contributions from from external authors. In February 2017 I launched the <a href="https://www.hse.ru/org/hse/pfair/199751652.html">first iteration of a project</a> for the students of National Research University Higher School of Economics.</p>
<div class="page-columns page-full"><p>To draw a line after the first phase of the project, I analysed what journals supplied Demographic Digest most frequently. Also, my desire was to try visualizing data with treemaps, which I mentioned in the bonus part<sup>1</sup> of <a href="http://demoscope.ru/weekly/2017/0715/digest03.php">the latest digest issue</a>.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;I finish each issue of Demographic Digest with a bonus, in which I cover fun papers, discuss some academia related issues, or just provide link to cool visualizations and projects.</p></li></div></div>
<p>For that, I exported the bibliographic data of all the papers covered in Demographic Digest. I use <a href="https://www.zotero.org">Zotero</a> as a reference manager; the paper records are exported as a single .bib file, which I then saved as a <a href="../../share/1702-dd-stats/dd-bib.txt">plain text (.txt) file</a>. Then I read this data in R, cleaned it, and finally visualized.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>lines <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1702-dd-stats/dd-bib.txt"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>lines <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lines</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        </span>
<span>        <span class="co" style="color: #5E5E5E;"># grab only the lines that contain journals' titles</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">lines</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"journaltitle"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        </span>
<span>        <span class="co" style="color: #5E5E5E;"># remove everything that is not the bare journal's title</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>journals <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lines</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                       <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op" style="color: #5E5E5E;">(</span>pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"\tjournaltitle = |\\Q{\\E|\\Q}\\E,|\\Q}\\E"</span>, </span>
<span>                                       replacement <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="co" style="color: #5E5E5E;"># calculate frequencies</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">journals</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>For one journal title, Ageing and Society, I failed to replace the “&amp;” using <a href="https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">regular expressions</a>. This one is to be fixed manually. I also corrected the title of Lancet journal removing the article “The”. Finally, I corrected the frequencies for Population Studies and Population and Development Review subtracting 6, because for both journals I provided lists of most cited papers as a bonus. Following the same logic, I cleaned the data from the papers that appeared in the bonus part.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># correct "Ageing and Society"</span></span>
<span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Ageing and Society"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># correct the title of Lancet</span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>journals <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"The Lancet"</span>, <span class="st" style="color: #20794D;">"Lancet"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># correct "Population and Development Review" and "Population Studies" for 6 each</span></span>
<span><span class="co" style="color: #5E5E5E;"># Reason - top cited papers bonus</span></span>
<span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Population and Development Review"</span>, <span class="st" style="color: #20794D;">"Population Studies"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> </span>
<span>        <span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">df</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Population and Development Review"</span>, <span class="st" style="color: #20794D;">"Population Studies"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">6</span></span></code></pre></div>
</div>
<p>To provide some additional metrics of the journals, I downloaded bibliometric data from the <a href="">SCImago Journal &amp; Country Rank project</a>http://www.scimagojr.com/aboutus.php. Demographic journals usually have rather low SJR, compared to medical journals; that’s why I downloaded the data only for journals in <a href="http://www.scimagojr.com/journalrank.php?area=3300">Social Sciences</a> (the<a href="../../doc/misc/dd-stats/scimagojr.xlsx">.xlsx file</a>). Then I read the data in R and join to my data frame.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># read SJR data for journals in Social Sciences</span></span>
<span><span class="va" style="color: #111111;">sjr</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">readxl</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1702-dd-stats/scimagojr.xlsx"</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Title</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># join the data frames; note that I create an "id" variable in lower case</span></span>
<span><span class="va" style="color: #111111;">df_sjr</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">tolower</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sjr</span>, <span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span> </span></code></pre></div>
</div>
<div class="page-columns page-full"><p>Finally, it’s time to visualize the data. I use the amazing <code>treemap</code> package<sup>2</sup>.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;I also tried <code>portfolio</code> and <code>treemapify</code>, but liked the output from <code>treemap</code> most.</p></li></div></div>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># Treemap visualization</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">treemap</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/treemap/man/treemap.html">treemap</a></span><span class="op" style="color: #5E5E5E;">(</span>dtf <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_sjr</span>, </span>
<span>        index <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"journals"</span>, </span>
<span>        vSize <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"n"</span>, </span>
<span>        vColor <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"SJR"</span>, </span>
<span>        type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"value"</span>,</span>
<span>        n <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span>,</span>
<span>        palette <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"BrBG"</span>, </span>
<span>        border.col <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey10"</span>, </span>
<span>        title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Journals' frequency in Demographic Digest"</span>,</span>
<span>        title.legend <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"SJR (only social sciences)"</span>,</span>
<span>        fontfamily.title <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span>,</span>
<span>        fontfamily.labels <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span>,</span>
<span>        fontfamily.legend <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span>,</span>
<span>        drop.unused.levels <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<section id="here-is-how-the-output-looks" class="level2"><h2 class="anchored" data-anchor-id="here-is-how-the-output-looks">Here is how the output looks</h2>
<p><img src="https://ikashnitsky.github.io/2017/dd-journals-frequency/treemap-dd-stats.png" class="img-fluid"></p>
<p>Note that the lion’s share of Population Studies is mainly explained by <a href="http://demoscope.ru/weekly/2015/0661/digest01.php">the first issue of Demographic Digest</a>, in which I covered all the papers from the brilliant special issue <a href="http://www.tandfonline.com/toc/rpst20/69/sup1">Population — The long view</a>.</p>
<hr>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>demography</category>
  <category>bibliometrics</category>
  <guid>https://ikashnitsky.github.io/2017/dd-journals-frequency/index.html</guid>
  <pubDate>Mon, 13 Feb 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/dd-journals-frequency/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Male mortality in Russia and Japan</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<div class="page-columns page-full"><p>Russia is sadly notorious for its ridiculously high adult male mortality. According to <a href="http://www.mortality.org">Human Mortality Database data (2010)</a>, the probability for a Russian men to survive from 20 to 60 was just 0.64 <sup>1</sup>. For women the probability is 0.87. This huge gender disproportion in mortality results in a peculiar sex ratio profile (see <a href="https://demotrends.wordpress.com/2015/01/14/the-land-of-babushka/">my old DemoTrends post</a> and <a href="https://ikashnitsky.github.io/2017/hmd-sex-all-ratio">the previous blog post</a>).</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;To compare, the same probabilities for males in some developed countries are: France (0.89), Japan (0.92), US (0.87), UK (0.91).</p></li></div></div>
<div class="page-columns page-full"><p>Now let’s compare age-specific mortality rates of Russian men to that of the Japanese. For years and years Japan performs best in reducing mortality. It became standard to compare mortality schedules of other countries to the Japanese one <sup>2</sup>.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;See for example the recent <a href="http://www.nidi.nl/shared/content/output/papers/nidi-wp-2017-01.pdf">NIDI working paper of Balachandran et. al (2017)</a>.</p></li></div></div>
<p>First, I need to get HMD data for both Russian and Japanese males. Again, I am using the amazing <code>R</code> package <code>HMDHFDplus</code> of <a href="https://sites.google.com/site/timriffepersonal/">Tim Riffe</a> to download HMD data with just a couple of lines of <code>R</code> code.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 1.0.0</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/timriffe/TR1">HMDHFDplus</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 1.1.8</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load life tables for men, RUS and JPN</span></span>
<span><span class="va" style="color: #111111;">rus</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'RUS'</span>, <span class="st" style="color: #20794D;">"mltper_1x1"</span>, <span class="va" style="color: #111111;">ik_user_hmd</span>, <span class="va" style="color: #111111;">ik_pass_hmd</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">jpn</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'JPN'</span>, <span class="st" style="color: #20794D;">"mltper_1x1"</span>, <span class="va" style="color: #111111;">ik_user_hmd</span>, <span class="va" style="color: #111111;">ik_pass_hmd</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><em>Please note, the arguments <code>ik_user_hmd</code> and <code>ik_pass_hmd</code> are my login credidantials at the website of <a href="http://www.mortality.org">Human Mortality Database</a>, which are stored locally at my computer. In order to access the data, one needs to create an account at http://www.mortality.org/ and provide his own credidantials to the <code><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb()</a></code> function.</em></p>
<p>Next, I select the most recent year for comparison, 2014, and compute the rate ratio of age specific mortality rates.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># compare mortality rates for 2014</span></span>
<span><span class="va" style="color: #111111;">ru</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">rus</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span>, rus <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mx</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">jp</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">jpn</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">2014</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span>, jpn <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mx</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">jp</span>, <span class="va" style="color: #111111;">ru</span>, <span class="st" style="color: #20794D;">'age'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>ru_rate <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">rus</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="va" style="color: #111111;">jpn</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Finally, I plot the resulting rate ratio of male mortality in Russia and Japan.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># get nice font</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># plot</span></span>
<span><span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">ru_rate</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op" style="color: #5E5E5E;">(</span>yintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'red'</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'mortality rate ratio'</span>,</span>
<span>                           breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">10</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">10</span>, limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'text'</span>,x<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">55</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1.75</span>,<span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 color <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'red'</span>,<span class="st" style="color: #20794D;">'black'</span><span class="op" style="color: #5E5E5E;">)</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>,</span>
<span>                 label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Japan'</span>,<span class="st" style="color: #20794D;">'Russia'</span><span class="op" style="color: #5E5E5E;">)</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Compare age-specific mortality of males'</span>,</span>
<span>                subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Russia and Japan, 2014, HMD"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/male-mortality-compare.png" class="img-fluid"></p>
<p>In the middle ages, male mortality in Russian is up to 10 times higher than in Japan!</p>
<hr>
<button class="btn btn-lg btn-secondary" type="button">
This post is based on my earlier <a href="https://twitter.com/ikashnitsky/status/792305556132331520">tweet</a> and <a href="https://gist.github.com/ikashnitsky/8df43c9a5dcd1798116ba09b336cdcf2">gist</a>.
</button>


<!-- -->

 ]]></description>
  <category>r</category>
  <category>tw</category>
  <category>hmd</category>
  <category>death rates</category>
  <category>russia</category>
  <guid>https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/index.html</guid>
  <pubDate>Sun, 05 Feb 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Sex ratios in all countries from Human Mortality Database</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<div class="page-columns page-full"><p>Sex ratios reflect the two basic regularities of human demographics: 1) there are always more boys being born; 2) males experience higher mortality throughout their life-course. The sex ratio at birth does not vary dramatically<sup>1</sup> and is more or less constant at the level of 105-106 boys per 100 girls. Hence, differences in the sex ratio profiles of countries mainly reflect gender gap in mortality. In this post I will compare sex ratios age profiles in all countries included in <a href="http://www.mortality.org">Human Mortality Database</a>.</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;There are cases of big deviations from this natural constant. The most well known one is the skewed sex ratio in China, where decades of One Child Policy together with strong traditional son preference resulted in selective abortions. Read more: Frejka et. al (<a href="http://dx.doi.org/10.1111/j.1728-4457.2010.00347.x">2010</a>); Wang (<a href="http://dx.doi.org/10.1111/j.1728-4457.2011.00383.x">2011</a>); Basten and Verropoulou (<a href="http://dx.doi.org/10.1080/00324728.2013.826372">2013</a>).</p></li></div></div>
<p><code>R</code> gives amazing opportunities to grab data fast and easy. Thanks to <a href="https://sites.google.com/site/timriffepersonal/">Tim Riffe’s</a> <code>HMDHFDplus</code> package, one can now download HMD data with just a couple of lines of <code>R</code> code.</p>
<p>There is a handy function in <code>HMDHFDplus</code> package – <code><a href="https://rdrr.io/pkg/HMDHFDplus/man/getHMDcountries.html">getHMDcountries()</a></code>. It lists the codes for all countries in HMD. So it becomes really easy to loop through the database and download data for all countries.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 1.0.0</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/timriffe/TR1">HMDHFDplus</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># version 1.1.8</span></span>
<span></span>
<span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/getHMDcountries.html">getHMDcountries</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">exposures</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">for</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="va" style="color: #111111;">cnt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span>        <span class="va" style="color: #111111;">exposures</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">cnt</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cnt</span>, <span class="st" style="color: #20794D;">"Exposures_1x1"</span>,</span>
<span>                                       <span class="va" style="color: #111111;">ik_user_hmd</span>, <span class="va" style="color: #111111;">ik_pass_hmd</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        <span class="co" style="color: #5E5E5E;"># let's print the progress</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span>,<span class="st" style="color: #20794D;">'out of'</span>,<span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p><em>Please note, the arguments <code>ik_user_hmd</code> and <code>ik_pass_hmd</code> are my login credidantials at the website of <a href="http://www.mortality.org">Human Mortality Database</a>, which are stored locally at my computer. In order to access the data, one needs to create an account at http://www.mortality.org/ and provide his own credidantials to the <code><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb()</a></code> function.</em></p>
<p>Next, I select 2012 for comparison – it is quite recent, and for most of the HMD countries there are data for 2012. The loop goes through each of the countries’ dataframe in <code>exposures</code> list, selects data for 2012 and calculates sex ratio at each age. I also remove data for several populations (like East and West Germany separately).</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="kw" style="color: #003B4F;">for</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">exposures</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="va" style="color: #111111;">di</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">exposures</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span>        <span class="va" style="color: #111111;">sr_agei</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">di</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span>,<span class="va" style="color: #111111;">Age</span>,<span class="va" style="color: #111111;">Female</span>,<span class="va" style="color: #111111;">Male</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">2012</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">Year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">exposures</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span>,</span>
<span>                          age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span>, sr_age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Male</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="va" style="color: #111111;">Female</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="va" style="color: #111111;">sr_age</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sr_agei</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span><span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sr_age</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># remove optional populations</span></span>
<span><span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"FRACNP"</span>,<span class="st" style="color: #20794D;">"DEUTE"</span>,<span class="st" style="color: #20794D;">"DEUTW"</span>,<span class="st" style="color: #20794D;">"GBRCENW"</span>,<span class="st" style="color: #20794D;">"GBR_NP"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>After age 90, sex ratios become quite jerky due to the relatively small numbers of survivors. I decided to aggregate data after the age 90.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># summarize all ages older than 90 (too jerky)</span></span>
<span><span class="va" style="color: #111111;">sr_age_90</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">110</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>sr_age <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sr_age</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, age<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">90</span>, <span class="va" style="color: #111111;">sr_age</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_plot</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sr_age</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">110</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sr_age_90</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Finally, I plot the resulting sex ratios.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># get nice font</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># finaly - plot</span></span>
<span><span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_plot</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">sr_age</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op" style="color: #5E5E5E;">(</span>yintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">100</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'grey50'</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">120</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">120</span>, <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">80</span>, <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Age'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'Sex ratio, males per 100 females'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span>, base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'none'</span>,</span>
<span>              panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/hmd-sex-ratios.png" class="img-fluid"></p>
<p>There is quite a variety in the sex ratio profiles. If the initial prevalence of males equalizes in Japan, Sweden, or Norway at around 60, in Russia, Belarus, and Ukraine this happens at around 30 due to very high male mortality. In many countries there are pronounced bumps in the sex ratio at ages 20-30, that are likely to be caused by international migration. For example, Scotland, Northern Ireland, Portugal, and New Zealand are experiencing substantial outflow of young men.</p>
<p>What happened in Taiwan?</p>
<hr>
<button class="btn btn-lg btn-secondary" type="button">
This post is based on my earlier <a href="https://twitter.com/ikashnitsky/status/785973218775478273">tweet</a> and <a href="https://gist.github.com/ikashnitsky/a578eaef6b122aa2aa2e3469fd2dcbe7">gist</a>.
</button>


<!-- -->

 ]]></description>
  <category>r</category>
  <category>tw</category>
  <category>hmd</category>
  <category>death rates</category>
  <guid>https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/index.html</guid>
  <pubDate>Sat, 04 Feb 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Hello R world post</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/hello-r-world/index.html</link>
  <description><![CDATA[ <script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script><hr>
<p>Welcome to my blog!</p>
<p>My name is Ilya, I am a demographer. Here I plan to post some research related stuff. As I am crazy about <a href="https://www.r-project.org">R</a>, my post will touch upon this tool/environment – I will share some tricks and cool visualizations. Eventually, I hope to contribute to the amazing <a href="https://www.r-bloggers.com">R-bloggers</a> project. First, I am going to post older bits – to gain momentum.</p>
<hr>
<p>Just to start with, let me show you a small and handy self-written R function.<br>
Quite often, visualizing data in R, we compose color palettes manually. It is nice to have a function that shows the actual colors of a vector with color values. Here it is.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">glimpse_colors</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">colors_string</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="va" style="color: #111111;">n</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">colors_string</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">n</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">n</span>, col <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">colors_string</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>The function takes a vector of colors as input and produces a basic uniform histogram with one bar for each color, filled accordingly. Let’s try it out. First, we create some colors, and then visualize them.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">RColorBrewer</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">pal</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">9</span>, name <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'BrBG'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;">glimpse_colors</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">pal</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ikashnitsky.github.io/2017/hello-r-world/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Enjoy!</p>
<p>P.S. If something similar exists in one of the well known packages, please tell me.</p>
<p>***s</p>


<!-- -->


 ]]></description>
  <category>r</category>
  <guid>https://ikashnitsky.github.io/2017/hello-r-world/index.html</guid>
  <pubDate>Sat, 28 Jan 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/hello-r-world/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>demographeR’s notes</title>
  <link>https://ikashnitsky.github.io/index.html</link>
  <description><![CDATA[ 



<script defer="" data-domain="ikashnitsky.github.io" src="https://plausible.io/js/script.js"></script>
<!-- ## 2022 -->
<!-- ::: {#posts_2022} -->
<!-- ::: -->
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">2021</h2>
<div id="listing-posts_2021" class="quarto-listing quarto-listing-container-custom">
<div class="list blog">
    <div class="blog-entry" data-index="0" data-categories="r,tw,demography-101,life expectancy" data-listing-date-sort="1614898800000" data-listing-file-modified-sort="1671429090018" data-listing-reading-time-sort="5.315">
        <div class="metadata">          
            <p class="date listing-date">March 5, 2021</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2021/life-expectancy-101/index.html">What is life expectancy? And, even more important, what it isn't</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('tw'); return false;">
                    tw
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('demography-101'); return false;">
                    demography-101
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('life expectancy'); return false;">
                    life expectancy
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2021/life-expectancy-101/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2021/life-expectancy-101/teaser.png" alt="What is life expectancy? And, even more important, what it isn't" title="What is life expectancy? And, even more important, what it isn't">
        </div>
    </div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">2020</h2>
<div id="listing-posts_2020" class="quarto-listing quarto-listing-container-custom">
<div class="list blog">
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2">2019</h2>
<div id="listing-posts_2019" class="quarto-listing quarto-listing-container-custom">
<div class="list blog">
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3">2018</h2>
<div id="listing-posts_2018" class="quarto-listing quarto-listing-container-custom">
<div class="list blog">
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4">2017</h2>
<div id="listing-posts_2017" class="quarto-listing quarto-listing-container-custom">
<div class="list blog">
    <div class="blog-entry" data-index="0" data-categories="r,hockey,sport,height" data-listing-date-sort="1495836000000" data-listing-file-modified-sort="1671431214629" data-listing-reading-time-sort="33.115">
        <div class="metadata">          
            <p class="date listing-date">May 27, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/ice-hockey-players-height/index.html">Evolution of ice hockey players' height: IIHF world championships 2001-2016</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('hockey'); return false;">
                    hockey
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('sport'); return false;">
                    sport
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('height'); return false;">
                    height
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/ice-hockey-players-height/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/teaser.png" alt="Evolution of ice hockey players' height: IIHF world championships 2001-2016" title="Evolution of ice hockey players' height: IIHF world championships 2001-2016">
        </div>
    </div>
    <div class="blog-entry" data-index="1" data-categories="r,ggplot2,rspatial" data-listing-date-sort="1492984800000" data-listing-file-modified-sort="1671430161782" data-listing-reading-time-sort="5.66">
        <div class="metadata">          
            <p class="date listing-date">April 24, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/map-hacking/index.html">Hacking maps with ggplot2</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('ggplot2'); return false;">
                    ggplot2
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('rspatial'); return false;">
                    rspatial
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/map-hacking/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/map-hacking/teaser.png" alt="Hacking maps with ggplot2" title="Hacking maps with ggplot2">
        </div>
    </div>
    <div class="blog-entry" data-index="2" data-categories="r,animaion,pyramid,sweden,prospective ageing" data-listing-date-sort="1490911200000" data-listing-file-modified-sort="1671431380355" data-listing-reading-time-sort="13.345">
        <div class="metadata">          
            <p class="date listing-date">March 31, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/who-is-old/index.html">Who is old? Visualizing the concept of prospective ageing with animated population pyramids</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('animaion'); return false;">
                    animaion
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('pyramid'); return false;">
                    pyramid
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('sweden'); return false;">
                    sweden
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('prospective ageing'); return false;">
                    prospective ageing
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/who-is-old/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/who-is-old/teaser.png" alt="Who is old? Visualizing the concept of prospective ageing with animated population pyramids" title="Who is old? Visualizing the concept of prospective ageing with animated population pyramids">
        </div>
    </div>
    <div class="blog-entry" data-index="3" data-categories="r,rspatial,denmark,nuts" data-listing-date-sort="1489618800000" data-listing-file-modified-sort="1671431621289" data-listing-reading-time-sort="17.99">
        <div class="metadata">          
            <p class="date listing-date">March 16, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/denmark-nuts-reconstruction/index.html">R, GIS, and fuzzyjoin to reconstruct demographic data for NUTS regions of Denmark</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('rspatial'); return false;">
                    rspatial
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('denmark'); return false;">
                    denmark
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('nuts'); return false;">
                    nuts
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/denmark-nuts-reconstruction/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/teaser.png" alt="R, GIS, and fuzzyjoin to reconstruct demographic data for NUTS regions of Denmark" title="R, GIS, and fuzzyjoin to reconstruct demographic data for NUTS regions of Denmark">
        </div>
    </div>
    <div class="blog-entry" data-index="4" data-categories="r,tw,death rates,sweden,sex gap" data-listing-date-sort="1487977200000" data-listing-file-modified-sort="1671431532377" data-listing-reading-time-sort="2.57">
        <div class="metadata">          
            <p class="date listing-date">February 25, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/gender-gap-in-swedish-mortality/index.html">Gender gap in Swedish mortality</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('tw'); return false;">
                    tw
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('death rates'); return false;">
                    death rates
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('sweden'); return false;">
                    sweden
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('sex gap'); return false;">
                    sex gap
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/gender-gap-in-swedish-mortality/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/gender-gap-in-swedish-mortality/teaser.png" alt="Gender gap in Swedish mortality" title="Gender gap in Swedish mortality">
        </div>
    </div>
    <div class="blog-entry" data-index="5" data-categories="r,demography,bibliometrics" data-listing-date-sort="1487026800000" data-listing-file-modified-sort="1671431637604" data-listing-reading-time-sort="4.59">
        <div class="metadata">          
            <p class="date listing-date">February 14, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/dd-journals-frequency/index.html">30 issues of Demographic Digest - the most frequent journals</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('demography'); return false;">
                    demography
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('bibliometrics'); return false;">
                    bibliometrics
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/dd-journals-frequency/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/dd-journals-frequency/teaser.png" alt="30 issues of Demographic Digest - the most frequent journals" title="30 issues of Demographic Digest - the most frequent journals">
        </div>
    </div>
    <div class="blog-entry" data-index="6" data-categories="r,tw,hmd,death rates,russia" data-listing-date-sort="1486335600000" data-listing-file-modified-sort="1671429367170" data-listing-reading-time-sort="2.74">
        <div class="metadata">          
            <p class="date listing-date">February 6, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/hmd-male-mortality-rus-jpn/index.html">Male mortality in Russia and Japan</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('tw'); return false;">
                    tw
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('hmd'); return false;">
                    hmd
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('death rates'); return false;">
                    death rates
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('russia'); return false;">
                    russia
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/hmd-male-mortality-rus-jpn/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/hmd-male-mortality-rus-jpn/teaser.png" alt="Male mortality in Russia and Japan" title="Male mortality in Russia and Japan">
        </div>
    </div>
    <div class="blog-entry" data-index="7" data-categories="r,tw,hmd,death rates" data-listing-date-sort="1486249200000" data-listing-file-modified-sort="1671429279227" data-listing-reading-time-sort="4.46">
        <div class="metadata">          
            <p class="date listing-date">February 5, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/hmd-all-sex-ratio/index.html">Sex ratios in all countries from Human Mortality Database</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('tw'); return false;">
                    tw
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('hmd'); return false;">
                    hmd
                </div>
                <div class="post-category listing-category" onclick="window.quartoListingCategory('death rates'); return false;">
                    death rates
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/hmd-all-sex-ratio/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/teaser.png" alt="Sex ratios in all countries from Human Mortality Database" title="Sex ratios in all countries from Human Mortality Database">
        </div>
    </div>
    <div class="blog-entry" data-index="8" data-categories="r" data-listing-date-sort="1485644400000" data-listing-file-modified-sort="1671429184559" data-listing-reading-time-sort="0.99">
        <div class="metadata">          
            <p class="date listing-date">January 29, 2017</p>
        </div>
        <div class="body">
            <p class="title listing-title"><a href="./2017/hello-r-world/index.html">Hello R world post</a></p>
            <div class="post-categories listing-categories">
                <div class="post-category listing-category" onclick="window.quartoListingCategory('r'); return false;">
                    r
                </div>
            </div>
            <p class="description listing-description"><!-- desc(5A0113B34292)[max=175]:2017/hello-r-world/index.html --></p>
        </div>
        <div class="thumbnail">
            <img src="https://ikashnitsky.github.io/2017/hello-r-world/teaser.png" alt="Hello R world post" title="Hello R world post">
        </div>
    </div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>



</section>

<div class="quarto-listing quarto-listing-container-custom" id="listing-posts_2022">
<div class="list blog">
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div> ]]></description>
  <guid>https://ikashnitsky.github.io/index.html</guid>
  <pubDate>Mon, 19 Dec 2022 06:34:58 GMT</pubDate>
</item>
</channel>
</rss>
