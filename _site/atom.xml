<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Ilya Kashnitsky</title>
<link>https://ikashnitsky.github.io/atom.html</link>
<atom:link href="https://ikashnitsky.github.io/atom.xml" rel="self" type="application/rss+xml"/>
<description>Dr. Ilya Kashnitsky is an Assistant Professor of demography at the Interdisciplinary Centre on Population Dynamics, University of Southern Denmark, Odense, DK.</description>
<generator>quarto-1.2.269</generator>
<lastBuildDate>Sat, 24 Dec 2022 23:00:00 GMT</lastBuildDate>
<item>
  <title>Were there too many unlikely results at the FIFA World Cup 2022 in Qatar?</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2022/exceptional-world-cup/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>FIFA World Cup 2022 in Qatar saw many surprising results. In fact, too many – some would argue. From the unbelievable loss of Argentina to Saudi Arabia at the very beginning of the group stage, via the loss of the magnificent Brazil to Cameroon at the end of the group stage, to the groundbreaking performance of Morocco who were competitive playing against all the usual grands.</p>
<div class="page-columns page-full"><p>Somewhere towards the middle of the group stage I started wondering – is it ordinary to have so many surprises at the World Cup? What if this particular World Cup is really exceptional by the number of unlikely match outcomes? <sup>1</sup> If so, how should I measure it?</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Through discussions of <a href="https://www.reddit.com/r/dataisbeautiful/comments/zcm4r0">my earlier postings of this analysis</a> I figured out that the usual term to describe these unlikely outcomes is “upset”. I don’t like the term since it seems to suggest inherently that one always supports the favorite, which is definitely no my case, I tend to cheer for the underdogs. The term I used initially was “sensations”, which apparently makes little sense in English and reveals the direct translation from Russian happening in my head in this case. Throughout this post I’ll use the term “unlikely outcome”.</p></li></div></div>
<div class="page-columns page-full"><p>Just a bit of thinking yielded an answer that was really on the surface – <strong>bookmakers</strong>. They are the people who use all available knowledge to make money on the outcome expectations. Pretty soon I <a href="https://opendata.stackexchange.com/a/9010/7044">figured out</a> that there is one website [oddsportal.com][oddsportal] that offers long historical data series of betting odds and match outcomes. The real challenge came at the step of scraping the website. Stack Overflow and other similar places are <a href="https://stackoverflow.com/q/34785764">filled</a> with <a href="https://stackoverflow.com/q/23417638">questions</a> about <a href="https://stackoverflow.com/q/56984218">scraping</a> this specific tricky website. Having finally figured out how to do this (after countless trials and failures) I wrapped up the working solution into an R package <a href="https://github.com/ikashnitsky/oddor"><code>oddor</code></a>. The idea is that the package provides both scraping tools and the cleaned extracted datasets. <sup>2</sup></p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;For now I only scraped and added several football tournaments and leagues. Please, feel free to add more results via <a href="https://github.com/ikashnitsky/oddor/pulls">GitHub pull requests</a>.</p></li></div></div>
<div class="page-columns page-full"><p>Okay, so the data issue is solved. Now, it’s time for the experiment, a really simple one. I simulate the scenario where I consistently bet on the <strong>least likely outcome</strong> and track how my fictional balance changes over time. Out of the three possible outcomes of the games – (1) home team wins, (2) draw in main time, and (3) away team wins <sup>3</sup> – I always select the one that promises the highest odds, meaning that this outcome is considered the least likely of the three by the bookmakers.</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;Of course, “home” and “away” designation is very arbitrary at world cups, still I use the terms for consistency.</p></li></div></div>
<p>Here are the results for the latest World Cup 2022 (darkest line with all the unlikely outcomes annotated) in comparison with three previous World Cups, 2018, 2014, and 2010.</p>
<p><img src="https://ikashnitsky.github.io/2022/exceptional-world-cup/world-cup-odds-since-2010.png" class="preview-image img-fluid"></p>
<p>Decreasing step lines in the plot represent my decreasing fictional balance. Each game I bet 1 coin on the least likely outcome. Most often I lose this bet, and my balance decreases. Though, sometimes the least likely outcome happens, then my balance increases substantially by the size of the unlikely outcome odds. For example, in case of Argentina losing to Saudi Arabia the odds for this outcome was 25.</p>
<p>We can see that the 2022 World Cup was really exceptional – too often the outcomes that were considered the least likely happened. It’s also evident that surprises happen more often at the group stage, especially in the third round when many leaders apparently have already reached their group-stage goals (think of the recent game Brazil–Cameroon, where Brazilians literally played with the second team). I would say it’s <strong>really</strong> surprising – if one bets consistently against the odds at all the group-stage games, at least in the last 4 World Cups (for which we have odds and outcomes data) this dead-simple strategy turns out to be beneficial. My wild guess is that the World Cups see masses of inexperienced new betters who are placing bets on their national teams whatever, which at the global scale is disbalancing the whole system. Alternatively, maybe we are just slow and bad at recognizing how football is becoming more international, and now more underdogs are able to give a decent fight to the traditional grands.</p>
<p>In contrast, Play-offs are apparently less chaotic and more predictable. Betting on the underdogs at the Play-offs stage would guarantee to lose money in all 4 recent World Cups.</p>
<div class="page-columns page-full"><p>Of course, the surprising beneficial result of the betting-on-the-underdog experiment at the group-stage games at World Cups made me curious about other competitions. So I did a similar analysis for the <a href="https://www.reddit.com/r/dataisbeautiful/comments/zim8d6">Champions League (from season 2004–05)</a> and for <a href="https://www.reddit.com/r/dataisbeautiful/comments/ziojgj">English Premier League (from season 2003–04)</a>. Predictably, no miracle happened – betting consistently on the underdogs would almost always bring financial losses. So, either World Cups are just different, or all 4 last tournaments were exceptional with the latest being a crazy outlier. Would it be reasonable to try this no-brainer betting strategy at the group-stage of the next World Cup? I’m not sure. But let’s see in 4 years. <sup>4</sup></p><div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;I guess I have to say that this is not a financial advise =)</p></li></div></div>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Replicate this analysis using the <code>R</code> code from this <a href="https://gist.github.com/ikashnitsky/e7b391c03f9f5b98d589b2388d16089f">gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->



 ]]></description>
  <category>r</category>
  <category>oddor</category>
  <category>football</category>
  <category>sport</category>
  <guid>https://ikashnitsky.github.io/2022/exceptional-world-cup/index.html</guid>
  <pubDate>Sat, 24 Dec 2022 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2022/exceptional-world-cup/teaser.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>What is life expectancy? And, even more important, what it isn’t</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2021/life-expectancy-101/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>It really is a remarkable achievement and maybe a lot of luck that the world mundanely operates with such a complex indicator as life expectancy. Unlike many statistics and quantities of general use that are being monitored and reported regularly, life expectancy is not observed directly. It’s an output of a <strong>mathematical model</strong> called <strong>life table</strong>. And as any model it comes with a certain load of assumptions and limitations, which are easily forgotten and omitted in the everyday interpretations and misinterpretations of the indicator.</p>
<p>So, why do we need any mathematical modelling in the first place? Consider a seemingly simple task: you want to know how long people live. What can be easier? Let’s just see how many years lived those who died recently. Why not? Such a metric would be massively driven by population age structure. For the most of the recent history human populations were rapidly growing, which means that each next generation was bigger than the previous one. Relative differences in the size of generations affect the age composition of those dying.</p>
<p>Okay. Then why don’t we simply take a group of people born in the same year and see how long on average they live? We could (demographers call such groups cohorts). But it takes remarkably long to wait until the last person in the cohort dies. And we want to know what’s happening <strong>now</strong>.</p>
<p>How can we learn what’s happening now? Well, for that we need a mathematical model. We cannot observe the unfulfilled lifespans directly but we can construct/imagine an artificial population to help us understand the current mortality. The idea is simple: let’s take those dying now and divide them by the size of their age groups. This yields age-specific death rates – the key input for the life table needed to calculate life expectancy. Now, let’s take an imaginary cohort and see how long would they live on average if they experience these observed age-specific death rates. The imaginary population is know as a <strong>synthetic cohort</strong>. And here comes the main assumption of the life table: The model assumes that the observed age-specific death rates stay unchanged throughout the hypothetical lives of the hypothetical people in the synthetic cohort.</p>
<p>This big assumption of unchanging age profile of death rates almost never holds in real life. Mortality in human populations keeps improving beyond the most optimistic expectations. For decades the best demographers were systematically underestimating the progress in mortality reduction <span class="citation" data-cites="oeppen2002s">(Oeppen and Vaupel, 2002)</span>.</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/oeppen-vaupel.jpg" class="img-fluid"></p>
<p><strong>The horizontal lines are the limits of human population-level life expectancy as anticipated by renowned scholars; points are the actual data in the world leading countries. Source: (Oeppen and Vaupel, 2002)</strong></p>
<p>Life expectancy is a snapshot of the current mortality and is not a projection/forecast of the actual experience of the newborn cohorts. The current nature of period life expectancy is nicely <a href="https://twitter.com/therealrchung/status/1365091610766155778">illustrated by Dr.&nbsp;Robert Chung</a>: “I have a car that can display”driving range” given its estimate of fuel level and how I’m driving. When climbing a steep hill, the range can decrease a lot; when descending, the range can increase. That’s what period e(x) is like.”</p>
<p>But if life expectancy talk about now and not the future, why is it called “expectancy” in the first place? This rather unfortunate and confusing <a href="https://twitter.com/therealrchung/status/1365313760416526340">naming comes from statistics</a>, where “expected value” is a standard term for the mean of a distribution. The connotation crossing is rather unfortunate and as it strongly nudges the common future oriented misinterpretation of life expectancy.</p>
<p>The most popular error in public perception of period life expectancy forgets about the heavy assumption of the synthetic cohort (constant age-specific death rates throughout their hypothetic lives anchored in current year) and talks about the future of kids being born now. In normal years this large interpretation error is somewhat masked by the gradual and often close to linear improvements in mortality. A rule of thumb is to simply add ~6 years to period life expectancy to obtain a reasonable cohort estimate <span class="citation" data-cites="goldstein2006ps">(Goldstein and Wachter, 2006)</span>. Mortality shocks like 2020 are a different story though. Here the “forward looking” (mis)interpretation of period life expectancy projects the <strong>shock levels of mortality</strong> into the future. Of course this doesn’t happen. Shocks are called shocks because they are temporal.</p>
<p>Another important detail that often misses public attention is that life expectancy is not a single value – it can be estimated for every age. Most often and by default life expectancy is reported “at birth”. But we can estimate remaining life expectancy for various ages. And here comes another popular misunderstanding of life expectancy. Too often we come across the references to human age and longevity in the past that sound something like: “She was 40, a very elderly lady by the standards of that time as people lived on average about 30 years back the”. True, there were times when life expectancy <strong>at birth</strong> was about 30 years even in the most developed now countries. This doesn’t mean though that those who outlived this threshold age were getting old at young (by our current standards) ages. Let me illustrate.</p>
<p>Let’s take Italian male population in 1872, the first available year in <a href="https://www.mortality.org/">Human Mortality Database</a>. Have a look at the survival of this synthetic cohort – the proportion of the initial cohort that is still alive by certain age. Half of the synthetic cohort died by age 15!</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/ita-lx.png" class="img-fluid"></p>
<p>And here is how remaining period life expectancy looked by age. Infant and child mortality was sooo high that those escaping early deaths had higher remaining life expectancy.</p>
<p><img src="https://ikashnitsky.github.io/2021/life-expectancy-101/ita-ex.png" class="img-fluid"></p>
<p>At age 34 remaining life expectancy was the same as at birth. Only, it applied to the 41% survivors. And I guess the perception of age was not radically different among those survivors. It was all about selection and luck getting there. The high early life mortality is responsible for another popular demographic myth, which postulates that everybody used to have many kids in the past. No, people used to have many births, and only a fraction of those kids survived to adult life.</p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
This post is based on my previous <a href="https://twitter.com/ikashnitsky/status/1367856010476613632">Twitter thread</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2">
<div id="ref-goldstein2006ps" class="csl-entry">
Goldstein JR, Wachter KW. 2006. Relationships between <span>Period</span> and <span>Cohort Life Expectancy</span>: <span>Gaps</span> and <span>Lags</span>. <em>Population Studies</em> <strong>60</strong>: 257–269 DOI: <a href="https://doi.org/10.1080/00324720600895876">10.1080/00324720600895876</a>
</div>
<div id="ref-oeppen2002s" class="csl-entry">
Oeppen J, Vaupel JW. 2002. Broken limits to life expectancy. <em>Science</em> <strong>296</strong>: 1029–1031 DOI: <a href="https://doi.org/10.1126/science.1069675">10.1126/science.1069675</a>
</div>
</div></section></div> ]]></description>
  <category>r</category>
  <category>tw</category>
  <category>101</category>
  <category>life expectancy</category>
  <guid>https://ikashnitsky.github.io/2021/life-expectancy-101/index.html</guid>
  <pubDate>Thu, 04 Mar 2021 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2021/life-expectancy-101/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Dotplot – the single most useful yet largely neglected dataviz type</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2019/dotplot/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>I have to confess that the core message of this post is not really a fresh saying. But if I was given a chance to deliver one dataviz advise to every (ha-ha-ha) listening mind, I’d choose this: <strong>forget multi-category bar plots and use dotplots instead</strong>.</p>
</div>
</div>
<p>I was converted several years ago after reading <a href="http://www.b-eye-network.com/view/2468">this brilliant post</a>. Around the same time, as I figured out later, demographer Griffith Feeney wrote a <a href="http://demographer.com/dsitl/08-cleveland-dot-plots/">similar post</a>. From fresher examples, there are chapters discussing dotplot visualizations in <a href="https://serialmentor.com/dataviz/visualizing-amounts.html#dot-plots-and-heatmaps">Claus Wilke’s book</a> and <a href="https://socviz.co/workgeoms.html#continuous-variables-by-group-or-category">Kieran Healy’s book</a>. So, what are dotplots and what’s so special about them?</p>
<p>Basically, dotplots are the same regular barplots rotated 90 degrees and optimized on “ink usage”, i.e.&nbsp;dots represent values along the continuous horizontal axis. This leaves the vertical axis for the categorical variable allowing to write out long labels for the categories as normal horizontally aligned text (nobody likes to read that awful 45 degrees labels). The use of dots instead of bars allows to represent several comparable values for each category.</p>
<p>Here is a sample of some ugly plots that I found in the recent papers in my personal library of papers.</p>
<p><img src="https://ikashnitsky.github.io/2019/dotplot/examples.png" class="img-fluid"></p>
<p>It was not difficult to compose such a selection as these plots are, unfortunately, super popular. I think, the guy to blame here is (surprise-surprise) Excel. I’m failing to understand how such a basic plot type can be missed out.</p>
<p>Just to be clear, I’m guilty too. Before the happy rstats-ggplot switch, I’ve been producing the same Excel plots. Here is an example from my <a href="https://ikashnitsky.github.io/www.nidi.nl/shared/content/output/papers/nidi-wp-2014-14.pdf">2014 working paper</a> on internal youth migration in the central regions of Russia.</p>
<p><img src="https://ikashnitsky.github.io/2019/dotplot/two-figures.png" class="img-fluid"></p>
<p>These two figures became one in the final paper recently <a href="https://doi.org/10.1007/s10708-018-9953-5">published in GeoJournal</a>. I think it’s a nice example how information dense, pretty looking (very subjective here), and easy to read a dotplot can be.</p>
<p><img src="https://ikashnitsky.github.io/2019/dotplot/one-figure.png" class="img-fluid"></p>
<p>The figure shows discrepancy in migration estimates based on statistical record and census indirect estimates.</p>
<p>The code to replicate this figure is in <a href="https://gist.github.com/ikashnitsky/2f3e2b2af6f50911bb775bbce6eb0fb8">this gist</a>. A couple of coding solutions might be interesting here. First, the trick to offset vertically the dots for the two cohorts. Yet I realise that the way I implemented it is a bit clumsy; if you know a more elegant solution please let me know. Also, I believe in some cases composing the legend manually pays off, especially when we are dealing with two-dimensional legend. If the plot has some empty area it’s always a good idea to move the legend in the plotting area thus cutting away the margins.</p>
<hr>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>dataviz</category>
  <category>tip</category>
  <guid>https://ikashnitsky.github.io/2019/dotplot/index.html</guid>
  <pubDate>Thu, 18 Jul 2019 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2019/dotplot/teaser.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Zotero hacks: unlimited synced storage and its smooth use with rmarkdown</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2019/zotero/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
About this tutorial
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is a bit refreshed translation of <a href="https://habr.com/en/post/271045/">my 2015 blog post</a>, initially published on Russian blog platform <a href="https://habr.com/en/top/">habr.com</a>. The post shows how to organize a personal academic library of unlimited size for free. This is a funny case of a self written manual which I came back to multiple times myself and many many more times referred my friends to it, even non-Russian speakers who had to use Google Translator and infer the rest from screenshots. Finally, I decided to translate it adding some basic information on how to use Zotero with rmarkdown.</p>
</div>
</div>
<p><img src="https://ikashnitsky.github.io/2019/zotero/teaser.png" class="img-fluid"></p>
<section id="a-brief-and-hopefully-unnecessary-for-you-intro-of-bibliographic-managers" class="level1">
<h1>A brief (and hopefully unnecessary for you) intro of bibliographic managers</h1>
<p>Bibliographic manager is a life saver in everyday academic life. I suffer almost physical pain just thinking about colleagues who for some reason never started using one – all those excel spreadsheets with favorite citations, messy folders with PDFs, constant hours lost for the joy-killing task of manual reference list formatting. Once you start using a reference manager this all becomes a happily forgotten nightmare.</p>
<p>I tend to think of bibliographic metadata as LEGO.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/lego.jpg" class="img-fluid"></p>
<p>For each paper (book chapter / pre-print / R package) we have a number of metadata pieces – title, authors, date published, etc. These are the LEGO blocks. For different bibliographic styles we just need to re-shuffle those blocks inserting various commas, semicolons, and quotation marks.</p>
<p>Bibliographic manager keeps track of all the LEGO blocks and knows (learns easily) how to compose proper citation styles out of them. All we need is to <a href="https://www.zotero.org/styles">download a specific journal’s citation style</a>. There are more than six thousand bibliographic styles! [This is my #1 argument against the conspiracy ideas of some centralized power that rules our world .)]</p>
</section>
<section id="why-zotero" class="level1">
<h1>Why Zotero?</h1>
<p>There are dozens of bibliographic managers out there (<a href="https://en.wikipedia.org/wiki/Comparison_of_reference_management_software">see a comparative table</a>). Some of them are free, the others require paid subscriptions. Probably, the most popular two are <a href="https://www.zotero.org">Zotero</a> and <a href="https://www.mendeley.com/download-desktop/">Mendeley</a>. Both are free to use and make money by offering cloud storage to sync PDFs of the papers. Yet, both give some limited storage for free – Zotero gives 300MB, and Mendeley gives 2GB.</p>
<p>Why do I choose and recommend Zotero then? Because it’s fairly easy to set-up Zotero so that the free 300MB are only used to sync metadata (which in practice means almost infinite storage), and the PDFs are synced separately using a cloud solution of one’s choice (I use Google Drive). <strong>It’s the main set-up hack that I’m showing in this blog post</strong>. There is no similar hack for Mendeley, and with them at some point one is bound to pay for extra storage.</p>
<p>Another consideration in favor of Zotero is that it’s an open-source program with strong community and outspoken commitment to stay free forever, while Mendeley is an Elsevier for-profit product. Academic community knows a lot about Elsevier in particular and for-profit products in general. Here the story of Academia.edu is very indicative. Have a look at <a href="https://www.forbes.com/sites/drsarahbond/2017/01/23/dear-scholars-delete-your-account-at-academia-edu/">this Forbes piece</a>. As a career-long decision I’m confident in choosing Zotero. And the project keeps developing nicely – just look at the recent Zotero blog entries on the new features such as <a href="https://www.zotero.org/blog/google-docs-integration/">Google Docs integration</a>, <a href="https://www.zotero.org/blog/improved-pdf-retrieval-with-unpaywall-integration/">Unpaywall integration</a> and <a href="https://www.zotero.org/blog/improved-pdf-retrieval-with-unpaywall-integration/">a new web service for quick citations</a>.</p>
<p>Finally, an example of how strong Zotero community is. Once I figured out there the style repository does not have a style for Demographic Research, one of the best journals in demography. I’ve opened <a href="https://forums.zotero.org/discussion/57130/style-request-demographic-research">a request on Zotero forum</a> and in two days the style was created.</p>
</section>
<section id="prerequisites" class="level1">
<h1>Prerequisites</h1>
<ol type="1">
<li><p><a href="https://www.zotero.org/download/">Download and install Zotero</a>. It’s cross-platform and works smoothly with various systems, even when the same database is sycned in parallel on machines with different operation systems. I’ve used win+linux and win+mac – no sync problems ever.</p></li>
<li><p>From the same <a href="https://www.zotero.org/download/">download page</a> go to install Zotero Connector, a browser extension that helps to retrieve bibliographic metadata.</p></li>
<li><p>Create an <a href="https://www.zotero.org/user/register/">account on Zotero website</a>. It will be used later on to sync the database of bibliographic metadata.</p></li>
<li><p>Download and install the two plugins we’ll need – <a href="http://zotfile.com">ZotFile</a> (organizes the database of PDFs) and <a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a> (exports the library to .bib, we’ll use it later with rmarkdown). The plugins for Zotero are .xpi archives. To install the plugins open Zotero and click <code>Tools --&gt; Add-ons</code>. A separate window for <code>Add-ons manager</code> will pop-up.</p></li>
</ol>
<p><img src="https://ikashnitsky.github.io/2019/zotero/plugin.png" class="img-fluid"></p>
<p>There we need to click the options gear button and select <code>Install Add-on From File</code> option. Finally navigate to the .xpi file and install. Zotero will ask to restart, please do.</p>
<p>We are ready to go through the setup step-by-step.</p>
</section>
<section id="zotero-preferences" class="level1">
<h1>Zotero preferences</h1>
<p>First, let’s walk though Zotero Preferences. To edit them click <code>Edit --&gt; Preferences</code>. A window with several tabs pops up.</p>
<p><strong>General</strong>. I only uncheck the option to create automatic web page snapshots which I find not so useful compared with all the cluttering effect of all those multiple small files needed to replicate an html page locally.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/pref-general.png" class="img-fluid"></p>
<p><strong>Sync</strong>. Here we need to specify the account details to sync our database. It is important to uncheck the option of full-text sync otherwise the 300MB storage will quickly get filled. We’ll have the solution for full text a bit later.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/pref-sync.png" class="img-fluid"></p>
<p><strong>Search</strong>. Defines the database for internal search engine. Defaults are reasonable.</p>
<p><strong>Export</strong>. Choose the style for quick export using <code>Shift+Ctrl+C</code> shortcut.</p>
<p><strong>Cite</strong>. Citation styles stored locally. One nice feature here is the <code>Get additional styles</code> link which brings an integrated selection from the whole <a href="https://www.zotero.org/styles">Zotero Styles Database</a>. Styles can also be installed from local .csl files, for that press the <code>+</code> button. Don’t miss the <code>Word Processors</code> sub-tab. There we can get the plugins that integrate Zotero to Microsoft Word and Libre Office.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/pref-cite.png" class="img-fluid"></p>
<p><strong>Advanced</strong>. Here we are most interested in the sub-tab <code>Files and Folders</code>. This is the most important step to separate the storage of metadata and files.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/pref-files.png" class="img-fluid"></p>
<p>The <strong>first</strong> path should lead to a directory which stores the full-text PDFs, I call it <code>zotero-library</code>. This directory should be somewhere in the part of the local file system that is synced. In my case it’s the directory named <code>ikashnitsky</code>, which I sync with Google Drive. The <strong>second</strong> path leads to the system files of Zotero, I call it <code>zotero-system</code>. This directory should be placed somewhere in the non-synced part of the local file system. It will be updated by the native Zotero sync, and it’s better if those system files are not overwritten by any external sync software.</p>
<p><strong>Better BibTeX</strong>. This tab appears after we install the Better BibTeX extension. The extension is needed to export the whole bibliographic library (or some of its parts) as a plain .bib text file. This step is needed to use Zotero in RStudio while writing academic papers with <code>rmarkdown</code>.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/pref-bbt.png" class="img-fluid"></p>
<p>The most important option here is to define the rules for creating citation keys. There are almost infinite number of ways one can define these keys (<a href="https://retorque.re/zotero-better-bibtex/citation-keys/">check the manual</a>). My personal choice is <code>[auth:lower][year][journal:lower:abbr]</code>, which means that a key consists of the first author’s name, publication year, and the first letters abbreviation of the journal’s title, everything in lower case. Thus the key for my <a href="https://doi.org/10.1111/tesg.12357">most recent paper</a> published in <em>Tijdschrift voor economische en sociale geografie</em> is <code>kashnitsky2019tveesg</code>.</p>
</section>
<section id="zotfile-preferences" class="level1">
<h1>ZotFile Preferences</h1>
<p>Next we need to setup ZotFile. This extension helps to rename PDFs according to pre-defined rules and store them in a hierarchical database with meaningful names of the sub-directories. To open the setup window click <code>Tools --&gt; ZotFile Preferences</code>. Again, the window has several tabs.</p>
<p><strong>General</strong>. Here we define two paths. The <strong>first</strong> is the default location of the files downloaded by your browser. This option tells ZotFile where to look for the PDFs to process when you import a paper from the publisher’s website (recall that earlier we installed Zotero Connector). The <strong>second</strong> path leads to the local directory created for the full-text PDFs, the one that I named <code>zotero-library</code> and which is synced with an external cloud solution of our choice.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/zf-general.png" class="img-fluid"></p>
<p>To navigate easier in this database of PDFs check the option <code>Use subfolder defined by</code>. Here again we have a wide choice of the ways to define the rules to name the sub-directories. Click the info icon to learn the options. I choose to simply have a separate folder for each first author.</p>
<p><strong>Tablet Settings</strong>. Apparently, this menu allows to setup an exchange of PDFs with a tablet. I’ve never used it, thus omit.</p>
<p><strong>Renaming Rules</strong>. Here it’s important to make sure that ZotFile is responsible for renaming. Then we define how to rename the PDFs based on the bibliographic metadata available. Again, here we have many many options. My choice is {% raw %}<code>{%a_}{%y_}{%t}</code>{% endraw %} which yields file names like <code>kashnitsky_2018_russian_periphery_is_dying_in_movement.pdf</code> (again an example for <a href="https://doi.org/10.1007/s10708-018-9953-5">my recent paper</a> in <em>GeoJournal</em>).</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/zf-renaming.png" class="img-fluid"></p>
<p><strong>Advanced Settings</strong>. I only checked the option to replace all the non-standard symbols with plain ASCII.</p>
<p><strong>A very important note on ZotFile!</strong>.</p>
<p>If you parse the metadata manually from a PDF, make sure to rename the file using ZotFile. For that right-click the metadata record <code>Manage Attachments --&gt; Rename Attachments</code>. This action explicitly tells to use ZotFile for renaming and will move the renamed PDF to a proper sub-directory. The attachment in Zotero should not look like a PDF file…</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/att-pdf.png" class="img-fluid"></p>
<p>… but rather should be a link to the renamed file.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/att-link.png" class="img-fluid"></p>
<p>In these screenshot I also show the location of the actual PDFs in both cases (right-click the metadata record <code>Show File</code>). As you can see, in the first case the PDF is located in a meaninglessly named folder somewhere in the <code>zotero-system</code> directory. In contrast, the renamed by ZotFile PDF is located in a properly named sub-directory in <code>zotero-library</code>. Thus, in the latter case the PDF is synced to my Google Drive and can be accessed from anywhere.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/gdrive.png" class="img-fluid"></p>
<p>More importantly, when I need to restore my whole database of academic papers on another machine, I just need to go through these steps. As long as the system metadata data base is synced by Zotero and I provide Zotero the link to a PDFs storage, it will recognize all the relative paths to the files, and the whole library is restored. This setup also makes it possible to have the same continuously synced library on multiple machines. The hack is in ZotFile which adds a <code>file</code> path line to the metadata of the papers.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/zf-bib.png" class="img-fluid"></p>
<p>As long as I keep the settings unchanged, everything will be synced fine across multiple devices. In the end, I enjoy the unlimited storage of my PDFs with the very nice and reliable native sync of metadata form Zotero.</p>
<p><strong>Final remark on Zotero</strong>. Feel free to clean from time to time all the clutter from <code>zotero-system/storage</code>.</p>
</section>
<section id="use-zotero-library-in-rstudio-with-rmarkdown" class="level1">
<h1>Use Zotero library in RStudio with <code>rmarkdown</code></h1>
<p>Zotero has a very nice built-in integration with Microsoft Word and Libre Office. A bit of magic is needed if one wants to use it with LaTeX or (like me) with <code>rmarkdown</code>. The magic part is the Better BibTeX plugin, which we’ve installed and set up earlier.</p>
<p>Better BibTeX offers an easy way to export bibliographic records from Zotero as plain .bib text and keep the file updated once the records are changed. Just right-click on the collection in Zotero and choose <code>Export Collection</code>.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/bbt-export.png" class="img-fluid"></p>
<p>Then in the next window choose to export as Better BibTeX and check the option to <code>Keep updated</code>.</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/bbt-menu.png" class="img-fluid"></p>
<p>The output .bib file should be placed in the directory from which we are going to knit the .rmd file. The name of the .bib is specified in YAML header of the .rmd. Here is an example from my <a href="https://doi.org/10.31219/osf.io/f49n6">running project</a> with <a href="https://twitter.com/jm_aburto"><span class="citation" data-cites="jm_aburto">(</span></a><strong>jm_aburto?</strong>).</p>
<p><img src="https://ikashnitsky.github.io/2019/zotero/yaml.png" class="img-fluid"></p>
<p>Note that the exact YAML functions may vary depending on the <code>rmarkdown</code> template package. In this case I’m using <code>bookdown</code>, which also allows to specify the desired bibliographic style, .csl file should also be copied to the knit directory.</p>
<p>Then, everything is ready to use the citation keys to generate citations throughout the text. For details on <code>rmarkdown</code> citation syntax, it’s better to refer to <a href="https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html">RStudio’s manual</a> (see below) or <a href="https://bookdown.org/yihui/bookdown/citations.html">the relevant chapter</a> of <a href="https://twitter.com/xieyihui"><span class="citation" data-cites="xieyihui">(</span></a><strong>xieyihui?</strong>)’s book on <code>bookdown</code>.</p>
<iframe width="100%" height="500px" style="background: #FFFFFF;" src="https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html">
</iframe>
<p>The final hint here is to use <code>citr</code> package, which brings an easy and interactive way to select citations from the .bib file. Once the package in installed, an RStudio addin <code>Insert citation</code> appears which executes the <code>citr:::insert_citation()</code> command (you can assign a short-key to the addin). This function brings a shiny app to select a citation interactively. More details in the <a href="https://github.com/crsh/citr">github repo</a>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Happy paper writing with Zotero and RStudio!
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<hr>


<!-- -->

</section>

 ]]></description>
  <category>r</category>
  <category>tutorial</category>
  <category>zotero</category>
  <guid>https://ikashnitsky.github.io/2019/zotero/index.html</guid>
  <pubDate>Wed, 13 Mar 2019 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2019/zotero/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>See you in Barcelona this summer</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2019/barcelona-summer-school-of-demography/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p><img src="https://ikashnitsky.github.io/2019/barcelona-summer-school-of-demography/tutors-bg.png" class="img-fluid"></p>
<p>Have you been feeling lately that you are missing out the coolest skill-set in academia?</p>
<iframe src="https://gifer.com/embed/fxTM" width="480" height="269.011" frameborder="0" allowfullscreen="">
</iframe>
<p>Here is you chance to cut in and dive into R.</p>
<p>In July <a href="https://bit.ly/bssd2019">BaRacelona Summer School of Demography</a> welcomes dedicated scholars, aspiring or established, to help them migrate to the world of new oppoRtunities.</p>
<p>The school consists of 4 modules. You can take them all or choose specific ones. The first, instructed by <a href="https://twitter.com/timriffe1">Tim Riffe</a>, introduces the basics of R. The second, instructed by <a href="https://twitter.com/ikashnitsky">myself</a>, focuses on visualizing data, very general with a slight tilt towards population data. The third, instructed by <a href="https://portal.findresearcher.sdu.dk/da/persons/mpbergeron">Marie-Pier Bergeron Boucher</a>, presents the foundations of demographic analysis with R. Even if you are not (yet) a demographer these methods are very general and are usable in a wide range of social science disciplines. Finally, the fourth course, instructed by <a href="https://twitter.com/CEDemografia">Juan Galeano</a>, teaches the powerful ways to unleash the spatial dimension of data analysis.</p>
<p>There are still several places available, the call closes on March 31st.</p>
<p>I’ll be happy to see you in sunny Catalonia!</p>
<hr>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>dataviz</category>
  <category>teaching</category>
  <guid>https://ikashnitsky.github.io/2019/barcelona-summer-school-of-demography/index.html</guid>
  <pubDate>Wed, 06 Mar 2019 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2019/barcelona-summer-school-of-demography/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Compare population age structures of Europe NUTS-3 regions and the US counties using ternary color-coding</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2018/ddd-poster/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>On 28 November 2018 I presented a poster at <a href="http://www.nvdemografie.nl/en/activities/dutch-demography-day/dutch-demography-day-2018">Dutch Demography Day</a> in Utrecht. Here it is:</p>
<p><img src="https://ikashnitsky.github.io/2018/ddd-poster/compare-poster.png" class="img-fluid"></p>
<p>The poster compares population age structures, represented as ternary compositions in three broad age groups, of European NUTS-3 regions and the United States counties. I used ternary color-coding, a dataviz approach that <a href="https://twitter.com/jschoeley">Jonas Schöley</a> and me recently brought to R in <a href="https://cran.r-project.org/web/packages/tricolore/index.html">tricolore</a> package.</p>
<p>In these maps, each region’s population age composition is uniquely color-coded. Colors show direction and magnitude of deviation from the center point, which represents the average age composition. Hue component of a color encodes the direction of deviation: towards yellow – more elderly population (65+); cyan – more people at working ages (15–64); magenta–more kids (&lt;15).</p>
<p>Of course, NUTS-3 regions and the US counties are not perfect to compare; on average, NUTS-3 regions are roughly ten times bigger. That’s why the colors for European regions look quite muted, they are closer to the grey average composition.</p>
<p>The poster won <a href="http://www.nvdemografie.nl/en/activities/dutch-demography-day/dutch-demography-day-2018">NVD</a> Poster Award via online voting of the conference participants.</p>
<p><img src="https://ikashnitsky.github.io/2018/ddd-poster/poster-award.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Replication
</div>
</div>
<div class="callout-body-container callout-body">
<p>This time I layouted the poster in <a href="https://inkscape.org">Inkscape</a> rather than arranging everything with hundreds of R code lines. But all the elements of the posted are reproducible with code from <a href="https://github.com/ikashnitsky/compare-pop-eu-us">this github repo</a>.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
See also
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://doi.org/10.1186/s41118-017-0018-2">Kashnitsky, I., &amp; Schöley, J. (2018). Regional population structures at a glance. <em>The Lancet</em>, 392(10143), 209–210.</a></li>
<li><a href="https://osf.io/d4hjx/">My PhD project – Regional demographic convergence in Europe</a></li>
<li><a href="https://doi.org/10.4054/DemRes.2017.36.21">Paper (Schöley &amp; Willekens 2017) with the initial ideas for tricolore package</a></li>
<li><a href="https://github.com/ikashnitsky/demres-2018-geofacet">An example of ternary colorcoding used to visualize cause-of-death data</a></li>
</ul>
</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>poster</category>
  <category>tricolore</category>
  <category>rspatial</category>
  <category>award</category>
  <guid>https://ikashnitsky.github.io/2018/ddd-poster/index.html</guid>
  <pubDate>Sun, 02 Dec 2018 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2018/ddd-poster/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>sjrdata: all SCImago Journal &amp; Country Rank data, ready for R</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2018/sjrdata-package/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p><img src="https://ikashnitsky.github.io/2018/sjrdata-package/sjrdata-logo.png" class="img-fluid"></p>
<p>SCImago Journal &amp; Country Rank provides valuable estimates of academic journals’ prestige. The data is freely available at <a href="https://www.scimagojr.com">the project website</a> and is distributed for deeper analysis in forms of .csv and .xlsx files. I downloaded all the files and pooled them together, ready to be used in R.</p>
<p>Basically, all the package gives you three easily accessible data frames: <code>sjr_journals</code> (Journal Rank), <code>sjr_countries</code> (Country Rank, year-by-year), and <code>sjr_countries_1996_2017</code> (Country Rank, all years together).</p>
<p>The whole process of data acquisition can be found in the <a href="https://github.com/ikashnitsky/sjrdata">github repo</a> (<code>dev</code> directory) or this <a href="https://gist.github.com/ikashnitsky/3133422ef85ff3f3d65be9926d6bd990">gist</a>.</p>
<section id="how-to-use-sjrdata" class="level1"><h1>How to use <code>sjrdata</code>
</h1>
<p>Install the package from github, load it and use the data.</p>
<p>The installation will take a while since the main dataset <code>sjr_journals</code> is pretty heavy (15.7MB compressed).</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># install</span></span>
<span><span class="fu" style="color: #4758AB;">devtools</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"ikashnitsky/sjrdata"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/ikashnitsky/sjrdata">sjrdata</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># use</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sjr_countries</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="a-couple-of-examples" class="level1"><h1>A couple of examples</h1>
<p>Let’s compare <em>Nature</em> and <em>Science</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/ikashnitsky/sjrdata">sjrdata</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">sjr_journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">title</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Nature"</span>, <span class="st" style="color: #20794D;">"Science"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cites_doc_2years</span>, <span class="va" style="color: #111111;">sjr</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">title</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, label.padding <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.15</span>, <span class="st" style="color: #20794D;">"line"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2018/sjrdata-package/nature-science.png" class="img-fluid"></p>
<p>Several demographic journals.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">sjr_journals</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">title</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        <span class="st" style="color: #20794D;">"Demography"</span>,</span>
<span>        <span class="st" style="color: #20794D;">"Population and Development Review"</span>,</span>
<span>        <span class="st" style="color: #20794D;">"European Journal of Population"</span>,</span>
<span>        <span class="st" style="color: #20794D;">"Population Studies"</span>,</span>
<span>        <span class="st" style="color: #20794D;">"Demographic Research"</span>,</span>
<span>        <span class="st" style="color: #20794D;">"Genus"</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cites_doc_2years</span>, <span class="va" style="color: #111111;">sjr</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">title</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op" style="color: #5E5E5E;">(</span>palette <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Dark2"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op" style="color: #5E5E5E;">(</span>expand <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2018/sjrdata-package/demographic-journals.png" class="img-fluid"></p>
<hr>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>package</category>
  <category>sjr</category>
  <category>bibliometrics</category>
  <guid>https://ikashnitsky.github.io/2018/sjrdata-package/index.html</guid>
  <pubDate>Sat, 22 Sep 2018 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2018/sjrdata-package/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Regional population structures at a glance</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2018/the-lancet-paper/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p><img src="https://ikashnitsky.github.io/2018/the-lancet-paper/full-text.png" class="img-fluid"></p>
<p>I am happy to announce that our paper is <a href="https://doi.org/10.1016/S0140-6736(18)31194-2">published today in <em>The Lancet</em></a>.</p>
<blockquote class="blockquote">
<p>Kashnitsky I, Schöley J. 2018. Regional population structures at a glance. <em>The Lancet</em> <strong>392</strong>: 209–210. <a href="https://doi.org/10.1016/S0140-6736(18)31194-2">https://doi.org/10.1016/S0140-6736(18)31194-2</a></p>
</blockquote>
<section id="at-a-glance" class="level1"><h1>At a glance</h1>
<p>Demographic history of a population is imprinted in its age structure. A meaningful representation of regional population age structures can tell numerous demographic stories – at a glance. To produce such a snapshot of regional populations, we use an innovative approach of <strong>ternary colour coding</strong>.</p>
<p>Here is the map:</p>
<p><img src="https://ikashnitsky.github.io/2018/the-lancet-paper/the-map.png" class="img-fluid"></p>
</section><section id="we-let-the-data-speak-colours" class="level1"><h1>We let the data speak colours</h1>
<p>With ternary colour coding, each element of a three-dimensional array of compositional data is represented with a unique colour. The resulting colours show direction and magnitude of deviations from the centrepoint, which represents the average age of the European population, and is dark grey. The hue component of a colour encodes the direction of deviation: yellow indicates an elderly population (&gt;65 years), cyan indicates people of working age (15–64 years), and magenta indicates children (0–14 years).</p>
<p>The method is very flexible, and one can easily produce these meaningful colours using our <a href="https://github.com/jschoeley/tricolore">R package <code>tricolore</code></a>. Just explore the capabilities of the package in a built-in shiny app using the following lines of code:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"tricolore"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">tricolore</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/tricolore/man/DemoTricolore.html">DemoTricolore</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Replication materials <a href="https://github.com/ikashnitsky/the-lancet-2018">at github</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Folow us on Twitter: <a href="https://twitter.com/ikashnitsky">ikashnitsky</a>, <a href="https://twitter.com/jschoeley">jschoeley</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
See also
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://osf.io/d4hjx/"><strong>My PhD project – Regional demographic convergence in Europe</strong></a></li>
<li><a href="https://ikashnitsky.github.io/2017/colorcoded-map/">Blog post on the first version of the map presented at Rostock Retreat Visualization in June 2017</a></li>
<li><a href="https://doi.org/10.4054/DemRes.2017.36.21">Paper (Schöley &amp; Willekens 2017) with the initial ideas for tricolore package</a></li>
<li><a href="https://github.com/ikashnitsky/demres-2018-geofacet">An example of ternary colorcoding used to visualize cause-of-death data</a></li>
<li><a href="https://doi.org/10.1186/s41118-017-0018-2">My other paper , which explores regional differences in population age structures</a></li>
</ul>
</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>paper</category>
  <category>dataviz</category>
  <category>tricolore</category>
  <guid>https://ikashnitsky.github.io/2018/the-lancet-paper/index.html</guid>
  <pubDate>Fri, 20 Jul 2018 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2018/the-lancet-paper/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Deep Catalan roots: playing with stringdist</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2018/deep-catalan-roots/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<section id="preambule" class="level1">
<h1>Preambule</h1>
<p>This academic year I am participating in <a href="https://www.demogr.mpg.de/en/education_career/european_doctoral_school_of_demography_1913/default.htm">European Doctoral School of Demography</a>. It is a unique one-year-long training for PhD students in demography. It keeps migrating across European research centers; this year Jim Vaupel’s research group in Odense hosts the program. Best demographers visit us to give us various one-week-long courses. Here we are, the EDSD cohort 2017/18:</p>
<p><img src="https://ikashnitsky.github.io/2018/deep-catalan-roots/our-cohort.jpg" class="img-fluid"></p>
</section>
<section id="the-creative-task" class="level1">
<h1>The creative task</h1>
<p>Back in February (yes, I know, that was a quarter of a year ago, EDSD is quite dense), <a href="https://twitter.com/VillavicencioFG">Francisco Villavichencio</a> gave us a fascinating lecture on probabilistic string matching. Pancho used the approach in <a href="https://link.springer.com/chapter/10.1007/978-3-319-19884-2_10">one of his PhD papers</a>, in which he squeezed some demographic knowledge from scarce Catalan data on marriages that happened back in 16-17 centuries. Each marriage record contains name of a bride, name and surname of a groom, and the same data for two pairs their of parents. Having data for period spanning several adjacent generations, Pancho linked kids to their parents, thus getting interval censored dataset on demographic events of Renaissance Catalans. From this data he managed to estimate life expectancy of that population! Just make sure you check the paper if you want more details:</p>
<blockquote class="blockquote">
<p>Villavicencio F, Jordà JP, Pujadas-Mora JM. 2015. Reconstructing lifespans through historical marriage records of Barcelona from the sixteenth and seventeenth centuries. In <em>Population Reconstruction</em>, 199–216. Springer.</p>
</blockquote>
<p>Our assignment was to play with a sample of the dataset and link daughters, who got married in 1597–1629, to their possible parents, who got married in 1573–1617, using string distance metrics. But that’s not what I am about to show you.</p>
</section>
<section id="a-side-walk-solution" class="level1">
<h1>A side-walk solution</h1>
<p>While doing the assignment, I decided to check if there lived “re-incarnations” of my group-mates in Barcelona back in the day. Instead of linking daughters to parents I linked us, 20 young demographers from various countries, to Catalans from 16-17 century. Here is how I handed in the assignment =)</p>
<p><img src="https://ikashnitsky.github.io/2018/deep-catalan-roots/hand-in.jpg" class="img-fluid"></p>
<p>So, let’s dive into string distances and probabilistic string matching.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Reproducibility note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the sake of post’s readability, this time I chose not to insert code chunks in the post. Instead, you are welcome to explore the <a href="https://github.com/ikashnitsky/deep-catalan-roots">github repo</a> that replicates all the analyses presented here. Since I cannot publish openly a big chunk of The Barcelona Historical Marriage Database, the guthub repo only contains minimal indicative data sample – 10 best matching records to each of the groupmate’s name.</p>
</div>
</div>
</section>
<section id="exploring-the-methods" class="level1">
<h1>Exploring the methods</h1>
<p>There are multiple ways to calculate string distances. Most popular are implemented in <code>stringdist</code> R package. I’m not going to present the methods themselve, just check <code>stringdist</code> <a href="https://cran.r-project.org/web/packages/stringdist/stringdist.pdf">documentation</a> if interested. All of the methods are pretty costly computationally. Even when each particular comparison happens quite fast, the problem is that for each person, for whom a match is being searched, we need to run the comparison with each of the records in the other dataset. Of course, when you want to use several methods and average the result of their “voting”, it takes even more time. Thus, a good idea is to narrow the list of candidates for matching as much as possible.</p>
<p>So, first I decided to compare the speed of these methods and choose the fastest for the first step comparison. Here is what I got calculating the distance between words “demography” and “democracy”.</p>
<p><img src="https://ikashnitsky.github.io/2018/deep-catalan-roots/benchmarking.png" class="img-fluid"></p>
<p>As we see, there is quite some variation in the speed of different methods, and sometimes an iteration takes much longer than usual. The fastest method is “jw”, Jaro-Winker distance. I use it for filtering out the pairs of candidate names that definitely have nothing in common. The choice of the cutting-off threshold is, of course, arbitrary and is based on empirical tests. The trade-off here is, on the one hand, to narrow down the list of candidates for match but, on the other hand, not to throw away the possible match based on just one distance measure.</p>
</section>
<section id="finally-lets-find-our-catalan-ancestors" class="level1">
<h1>Finally, let’s find our Catalan “ancestors”</h1>
<p>Instead of choosing some cut-off value I ranked the results of “jw” distance and filtered 10 best fitting results for each of the names of my fellows. For these pre-selected candidates I calculated also several other distance measures: “osa”, “lcs”, “qgram”, “cosine”, and “jaccard”. In the final tables I showed only 3 best matching results ranked by the geometric average of all the 6 calculated distances taken with equal weights.</p>
<section id="here-is-the-table-for-guys" class="level2">
<h2 class="anchored" data-anchor-id="here-is-the-table-for-guys">Here is the table for guys:</h2>
<p><img src="https://ikashnitsky.github.io/2018/deep-catalan-roots/edsd-males.png" class="img-fluid"></p>
<p>My personal favorite here is <strong>Hanbo Wo</strong> becoming <strong>Antonio Duc</strong>.</p>
</section>
<section id="and-a-similar-table-for-girls" class="level2">
<h2 class="anchored" data-anchor-id="and-a-similar-table-for-girls">And a similar table for girls:</h2>
<p><img src="https://ikashnitsky.github.io/2018/deep-catalan-roots/edsd-females.png" class="img-fluid"></p>
<p>Here I like <strong>Elena Bastianelli</strong> turning to <strong>Elena Albanell</strong>.</p>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>There are 20 people in our EDSD group, 10 guys and 10 girls. We come from different countries: Germany, Italy, China, United States, Russia, Spain, Mexico, Bosnia, Poland, Hungary, Estonia, and Denmark. Our names are quite different from that of 16-17 century Catalans. Still, using string distance matching we can find similarly named persons in the historical dataset. This fun example just exposes the power of formal text mining approach.</p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Replication materials <a href="https://github.com/ikashnitsky/deep-catalan-roots">at github</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>r</category>
  <category>stringdist</category>
  <guid>https://ikashnitsky.github.io/2018/deep-catalan-roots/index.html</guid>
  <pubDate>Sun, 03 Jun 2018 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2018/deep-catalan-roots/teaser.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>A perfect RStudio layout</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2018/perfect-rstudio-layout/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>Tiny things can separate life into “before” and “after”. Here is one. For almost a year I’ve been daily sending mental “thank you” to <a href="https://sciences.social/@ugobas">Ugo</a> who showed me how to re-organize panes in RStudio. Since then I’ve been spreading this tiny improvement so many times that I thought the tiny advise deserved a separate tiny post. Please note, below is an opinionated view of a comfortable UI improvement; feel free to ignore it if you don’t like. This advise is <strong>highly subjective</strong>, though, I really believe it is useful.</p>
<p>I find the default 4-pane layout of RStudio is not perfect. One needs more space for the “Source” pane. Especially when RStudio is used as the main text editor, i.e.&nbsp;<strong>the</strong> program to write code, papers, blog posts, prepare presentations… Thus, the perfect solution is to move “Console” to the top-right position, leave least useful “History” in the bottom-left corner and collapse it, and move everything else to the bottom-right corner (see the screenshot).</p>
<p><img src="https://ikashnitsky.github.io/2018/perfect-rstudio-layout/layout-annotated.png" class="img-fluid"></p>
<p>Just go to “Tools” –&gt; “Global options” –&gt; “Pane layout” and fix it.</p>
<p><img src="https://ikashnitsky.github.io/2018/perfect-rstudio-layout/options.png" class="img-fluid"></p>
<p>That’s it!</p>
<p>Just enjoy your improved RStudio, <strong>the</strong> program.</p>
<p>P.S. It is also very handy to memorize and use the hot keys for panes. <code>CTRL + #</code> moves focus to the pane, <code>CTRL + SHIFT + #</code> maximizes the pane.</p>
<p><img src="https://ikashnitsky.github.io/2018/perfect-rstudio-layout/hotkeys.png" class="img-fluid"></p>
<hr>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>rstudio</category>
  <category>tip</category>
  <guid>https://ikashnitsky.github.io/2018/perfect-rstudio-layout/index.html</guid>
  <pubDate>Mon, 21 May 2018 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2018/perfect-rstudio-layout/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Data acquisition in R (3/4)</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/data-acquisition-three/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The series consists of four posts:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://ikashnitsky.github.io/2017/data-acquisition-one/">Loading prepared datasets</a></li>
<li><a href="https://ikashnitsky.github.io/2017/data-acquisition-two">Accessing popular statistical databases</a></li>
<li><strong>Demographic data sources</strong></li>
<li>Getting spatial data</li>
</ul>
</div>
</div>
<p>For each of the data acquisition options I provide a small visualization use case.</p>
<section id="human-mortality-database" class="level1"><h1>Human Mortality Database</h1>
<p>When it comes to testing the big questions of human population dynamics, there is no more reliable data source than <a href="http://www.mortality.org">Human Mortality Database</a>. This database is run by demographers who use state-of-the-art methodology to overcome issues in the data. As the result, the estimates are as precise as possible. Their <a href="http://www.mortality.org/Public/Docs/MethodsProtocol.pdf">methods protocol</a> is a masterpiece of demographic data processing. On the down side, the data of decent enough quality is available for only a bunch of countries. To explore the data I highly recommend [Human Mortality Database Explorer][exp] by <a href="https://twitter.com/jschoeley">Jonas Schöley</a>.</p>
<p>Thanks to <a href="https://twitter.com/timriffe1">Tim Riffe</a>’s <code>HMDHFDplus</code> package, one can now download HMD data with just a couple of lines of <code>R</code> code. Please note that an account at <a href="http://www.mortality.org">mortality.org</a> is needed in order to download data. As one may guess from the package name, it also helps to grab data from equally brilliant <a href="http://www.humanfertility.org/">Human Fertility Database</a>.</p>
<p>The following example is taken from my <a href="https://ikashnitsky.github.io/2017/hmd-all-sex-ratio/">earlier post</a> (and updated a bit). I think it illustrates nicely the power of automated data acquisition in <code>R</code>. Here I am going to download one year population population structures for both males and females for each single country of HMD. If you want to reproduce the result, beware that the script will download a couple of dozens megabits of data. Then I will calculate and visualize as small multiples sex ratios in all countries along age dimension. Sex ratios reflect the two basic regularities of human demographics: 1) there are always more boys being born; 2) males experience higher mortality throughout their life-course. Besides some artificial and well known exceptions, sex ratio at birth does not vary dramatically and is more or less constant at the level of 105-106 boys per 100 girls. Hence, differences in the sex ratio profiles of countries mainly reflect gender gap in mortality.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/timriffe/TR1">HMDHFDplus</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># help function to list the available countries</span></span>
<span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/getHMDcountries.html">getHMDcountries</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># remove optional populations</span></span>
<span><span class="va" style="color: #111111;">opt_pop</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"FRACNP"</span>, <span class="st" style="color: #20794D;">"DEUTE"</span>, <span class="st" style="color: #20794D;">"DEUTW"</span>, <span class="st" style="color: #20794D;">"GBRCENW"</span>, <span class="st" style="color: #20794D;">"GBR_NP"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">[</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">opt_pop</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># temporary function to download HMD data for a simgle county (dot = input)</span></span>
<span><span class="va" style="color: #111111;">tempf_get_hmd</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">.</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Exposures_1x1"</span>, <span class="va" style="color: #111111;">ik_user_hmd</span>, <span class="va" style="color: #111111;">ik_pass_hmd</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download the data iteratively for all countries using purrr::map()</span></span>
<span><span class="va" style="color: #111111;">exposures</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">tempf_get_hmd</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># data transformation to apply to each county dataframe</span></span>
<span><span class="va" style="color: #111111;">tempf_trans_data</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">.</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span>, <span class="va" style="color: #111111;">Age</span>, <span class="va" style="color: #111111;">Female</span>, <span class="va" style="color: #111111;">Male</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Year</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">2012</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">Year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>age <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Age</span>, ratio <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Male</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="va" style="color: #111111;">Female</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># perform transformation</span></span>
<span><span class="va" style="color: #111111;">df_hmd</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">exposures</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">tempf_trans_data</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span>.id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"country"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># summarize all ages older than 90 (too jerky)</span></span>
<span><span class="va" style="color: #111111;">df_hmd_90</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hmd</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">110</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>ratio <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">ratio</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span>na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, age <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">90</span>, <span class="va" style="color: #111111;">ratio</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># insert summarized 90+</span></span>
<span><span class="va" style="color: #111111;">df_hmd_fin</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hmd</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">110</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">df_hmd_90</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># finaly - plot</span></span>
<span><span class="va" style="color: #111111;">df_hmd_fin</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">age</span>, <span class="va" style="color: #111111;">ratio</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op" style="color: #5E5E5E;">(</span>yintercept <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">100</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">120</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                           expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                           breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">120</span>, <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">90</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                           expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                           breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">80</span>, <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span>, base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span>              panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, </span>
<span>                                          color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Age"</span>, </span>
<span>             y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Sex ratio, males per 100 females"</span>, </span>
<span>             title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Sex ratio in all countries from Human Mortality Database"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"HMD 2012, via HMDHFDplus by @timriffe1"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ikashnitsky.github.io"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-three/hmd.png" class="img-fluid"></p>
</section><section id="united-nations-world-population-prospects" class="level1"><h1>United Nations World Population Prospects</h1>
<p>Population Department of the United Nations provides high quality population estimates for all countries of the world. They update estimates every 2-3 years and publish openly as an interactive report <a href="https://esa.un.org/unpd/wpp/">World Population Prospects</a>. One may find in these reports key highlights and, of course, rich data. The data is later wrapped in <code>R</code> packages called <code>wpp20xx</code>. Currently, the available packages are for the estimate updates 2008, 2010, 2012, 2015, and 2017. I will give here an example of <code>wpp2015</code> use adapted from my earlier <a href="https://ikashnitsky.github.io/2017/global-male-life-expectancy-convergence/">post</a>.</p>
<p>Using ridgeplot, the amazing type of dataviz promoted <code>ggridges</code> package by <a href="https://twitter.com/ClausWilke">Claus Wilke</a>, I am going to show the impressive reduction of global inequality in male mortality that took place since 1950.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://esa.un.org/wpp">wpp2015</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://wilkelab.org/ggridges/">ggridges</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># get the UN country names</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">UNlocations</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">countries</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">UNlocations</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">paste</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># data on male life expectancy at birth</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">e0M</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;">e0M</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">countries</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">last.observed</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span>, <span class="va" style="color: #111111;">value</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">value</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">period</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html">geom_density_ridges</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span>discrete <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, option <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B"</span>, direction <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">1</span>, </span>
<span>                           begin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span>, end <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.9</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Male life expectancy at birth"</span>,</span>
<span>             y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Period"</span>,</span>
<span>             title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Global convergence in male life expectancy at birth since 1950"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"UNPD World Population Prospects 2015 Revision, via wpp2015"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ikashnitsky.github.io"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span>  <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-three/wpp2015.png" class="img-fluid"></p>
</section><section id="european-social-survey-ess" class="level1"><h1>European Social Survey (ESS)</h1>
<p><a href="http://www.europeansocialsurvey.org/about/">European Social Survey</a> provides uniquely rich nationally representative cross-county comparable information on the values of Europeans. Every two years a cross-sectional sample is taken in each participating country. All the data is easily available <a href="http://www.europeansocialsurvey.org/user/new">upon registration</a>. Datasets are distributed as SAS, SPSS, or STATA files. Thanks to <a href="https://twitter.com/cimentadaj">Jorge Cimentada</a>, these datasets are now easily available via <code>ess</code> package. I am going to visualize how respondents assessed their level of trust in police in all available countries at the latest round of the survey.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/mlindsk/ess">ess</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># help gunction to see the available countries</span></span>
<span><span class="fu" style="color: #4758AB;">show_countries</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># check the available rounds for a selected country</span></span>
<span><span class="fu" style="color: #4758AB;">show_country_rounds</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Netherlands"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># get the full dataset of the last (8) round</span></span>
<span><span class="va" style="color: #111111;">df_ess</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">ess_rounds</span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>, your_email <span class="op" style="color: #5E5E5E;">=</span>  <span class="va" style="color: #111111;">ik_email</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># select a variable and calculate mean value</span></span>
<span><span class="va" style="color: #111111;">df_ess_select</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_ess</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">idno</span>, <span class="va" style="color: #111111;">cntry</span>, <span class="va" style="color: #111111;">trstplc</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cntry</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>avg <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">trstplc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span>na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>cntry <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cntry</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">avg</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_ess_select</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">trstplc</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">avg</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2</span>, <span class="fl" style="color: #AD0000;">10</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Average\ntrust\nscore"</span>, </span>
<span>                            low <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>, high <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"aquamarine"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cntry</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Trust score [0 -- 10]"</span>,</span>
<span>             y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"# of respondents"</span>,</span>
<span>             title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Trust in police"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ESS wave 8 2017, via ess by @cimentadaj"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ikashnitsky.github.io"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-three/ess.png" class="img-fluid"></p>
</section><section id="american-community-survey-and-census" class="level1"><h1>American Community Survey and Census</h1>
<p>There are several packages that provide access to the US Census and ACS data. Perhaps the most convenient one is the recent <code>tidycensus</code> package by <a href="https://twitter.com/kyle_e_walker">Kyle Walker</a>. One extremely useful feature of this approach is the ability to download geodata along with stats in the form of simple features. Simple features, a revolutionary approach to deal with spatial data in R implemented in <code>sf</code> package by <a href="https://twitter.com/edzerpebesma">Edzer Pebesma</a>, allow to manage and visualize geodata tidy and efficiently. Note that in order to reproduce the following example one would have to install the development version of ggplot2.</p>
<p>Below I map median ages of census tracts population in Chicago based on the ACS estimates in 2015. To use <code>tidycensus</code>, an API key is required. API is instantly provided <a href="https://api.census.gov/data/key_signup.html">upon registration</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># to use geom_sf we need the latest development version of ggplot2</span></span>
<span><span class="fu" style="color: #4758AB;">devtools</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"tidyverse/ggplot2"</span>, <span class="st" style="color: #20794D;">"develop"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># you need a personal API key, available free at</span></span>
<span><span class="co" style="color: #5E5E5E;"># https://api.census.gov/data/key_signup.html</span></span>
<span><span class="co" style="color: #5E5E5E;"># normally, this key is to be stored in .Renviron</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># see state and county codes and names</span></span>
<span><span class="va" style="color: #111111;">fips_codes</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">View</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># the available variables</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op" style="color: #5E5E5E;">(</span>year <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2015</span>, dataset <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"acs5"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">View</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># data on median age of population in Chicago</span></span>
<span><span class="va" style="color: #111111;">df_acs</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        geography <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"tract"</span>,</span>
<span>        county <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Cook County"</span>,</span>
<span>        state <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"IL"</span>,</span>
<span>        variables <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B01002_001E"</span>,</span>
<span>        year <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2015</span>,</span>
<span>        key <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">ik_api_acs</span>,</span>
<span>        geometry <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># map the data</span></span>
<span><span class="va" style="color: #111111;">df_acs</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">estimate</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                            <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">20</span>, <span class="fl" style="color: #AD0000;">60</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Median age"</span>, begin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op" style="color: #5E5E5E;">(</span>datum <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span>  <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.15</span>, <span class="fl" style="color: #AD0000;">.15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Median age of population in Chicago\nby census tracts\n"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ACS 2015, via tidycensus by @kyle_e_walker"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ikashnitsky.github.io"</span>, </span>
<span>             x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-three/tidycensus.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>All the code chunks together can be found in <a href="https://gist.github.com/ikashnitsky/2e4bb16e097b1a264eeeae13ca6d7ce3">this gist</a></p>
</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>tutorial</category>
  <category>data acquisition</category>
  <guid>https://ikashnitsky.github.io/2017/data-acquisition-three/index.html</guid>
  <pubDate>Sat, 09 Dec 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/data-acquisition-three/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Data acquisition in R (2/4)</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/data-acquisition-two/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>R is an incredible tool for reproducible research. In the present series of blog posts I want to show how one can easily acquire data within an R session, documenting every step in a fully reproducible way. There are numerous data acquisition options for R users. Of course, I do not attempt to show all the data possibilities and tend to focus mostly on demographic data. If your prime interest lies outside human population statistics, it’s worth checking the amazing <a href="https://github.com/ropensci/opendata">Open Data Task View</a>.</p>
<p>The series consists of four posts: - <a href="https://ikashnitsky.github.io/2017/data-acquisition-one/">Loading prepared datasets</a> - <strong>Accessing popular statistical databases</strong> - <a href="https://ikashnitsky.github.io/2017/data-acquisition-three">Demographic data sources</a> - Getting spatial data</p>
<p>For each of the data acquisition options I provide a small visualization use case.</p>
<section id="eurostat" class="level1"><h1>Eurostat</h1>
<p>The package <code>eurostat</code> has a function <code>search_eurostat</code> to search for the relevant datasets. Though, sadly enough, this function does not provide the codes of all the datasets that has the expression of interest in the title. For example, the search on the expression <code>life expectancy</code> produces an output with just 2 results, which does not make any sense. Thus, the best strategy is to go to <a href="http://ec.europa.eu/eurostat/data/database">Eurostat website</a>, find the needed dataset code, and fetch the desired dataset by its code. Note that there is a <a href="http://ec.europa.eu/eurostat/web/regions/data/database">separate database for subregional level indicators</a>.</p>
<p>I am going to download life expectancy estimates for European countries; the dataset code is <code>demo_mlexpec</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://ropengov.github.io/eurostat/">eurostat</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download the selected dataset</span></span>
<span><span class="va" style="color: #111111;">e0</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html">get_eurostat</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"demo_mlexpec"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>It can take a while because the dataset is quite big (0.4m obs). If the automated procedure does not work, one can download the data manually via the <a href="http://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing">Bulk Download Service</a> of Eurostat.</p>
<p>Let’s have a look at the remaining life expectancy at age 65, the most common conventional age at retirement, in some European countries, separately for males, females, and total population. Some data preparation steps are needed. First, we only need the life expectancy estimates for those aged 65. Next, we don’t need total population, only males and females separately. Finally, let’s select just a bunch of countries: Germany, France, Italy, Russia, Spain, the UK.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">e0</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span> <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T"</span>,</span>
<span>               <span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Y65"</span>, </span>
<span>               <span class="va" style="color: #111111;">geo</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"DE"</span>, <span class="st" style="color: #20794D;">"FR"</span>, <span class="st" style="color: #20794D;">"IT"</span>, <span class="st" style="color: #20794D;">"RU"</span>, <span class="st" style="color: #20794D;">"ES"</span>, <span class="st" style="color: #20794D;">"UK"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">time</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">values</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sex</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span> <span class="va" style="color: #111111;">geo</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Life expectancy at age 65"</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-two/eurostat.png" class="img-fluid"></p>
</section><section id="world-bank" class="level1"><h1>World Bank</h1>
<p>There are several packages that provide an API to World Bank data. Probably, the most elaborated one is a fairly recent <a href="https://cran.r-project.org/web/packages/wbstats/README.html"><code>wbstats</code></a>. Its <code>wbsearch</code> function really does great job searching through the database for the relevant datasets. For example, <code>wbsearch("fertility")</code> produces a dataframe of 339 entries with the codes and names of the relevant indicators.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/nset-ornl/wbstats">wbstats</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># search for a dataset of interest</span></span>
<span><span class="fu" style="color: #4758AB;">wbsearch</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"fertility"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">head</span></span></code></pre></div>
</div>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 18%">
<col style="width: 75%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">indicatorID</th>
<th style="text-align: left;">indicator</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2479</td>
<td style="text-align: left;">SP.DYN.WFRT.Q5</td>
<td style="text-align: left;">Total wanted fertility rate (births per woman): Q5 (highest)</td>
</tr>
<tr class="even">
<td style="text-align: left;">2480</td>
<td style="text-align: left;">SP.DYN.WFRT.Q4</td>
<td style="text-align: left;">Total wanted fertility rate (births per woman): Q4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2481</td>
<td style="text-align: left;">SP.DYN.WFRT.Q3</td>
<td style="text-align: left;">Total wanted fertility rate (births per woman): Q3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2482</td>
<td style="text-align: left;">SP.DYN.WFRT.Q2</td>
<td style="text-align: left;">Total wanted fertility rate (births per woman): Q2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2483</td>
<td style="text-align: left;">SP.DYN.WFRT.Q1</td>
<td style="text-align: left;">Total wanted fertility rate (births per woman): Q1 (lowest)</td>
</tr>
<tr class="even">
<td style="text-align: left;">2484</td>
<td style="text-align: left;">SP.DYN.WFRT</td>
<td style="text-align: left;">Wanted fertility rate (births per woman)</td>
</tr>
</tbody>
</table>
<p>Let’s have a look at the indicator <code>Lifetime risk of maternal death (%)</code> (code <code>SH.MMR.RISK.ZS</code>). World Bank provides a variety of country groupings. One of the curious groupings divides countries based on the advance over the Demographic Transition path. Below I plot our selected indicator for (1) the countries that have passed the Demographic Transition, (2) the countries that haven’t yet experienced demographic dividend, and (3) the whole World.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># fetch the selected dataset</span></span>
<span><span class="va" style="color: #111111;">df_wb</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">wb</span><span class="op" style="color: #5E5E5E;">(</span>indicator <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"SH.MMR.RISK.ZS"</span>, startdate <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2000</span>, enddate <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2015</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># have look at the data for one year</span></span>
<span><span class="va" style="color: #111111;">df_wb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">date</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">2015</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">View</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_wb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">iso2c</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"V4"</span>, <span class="st" style="color: #20794D;">"V1"</span>, <span class="st" style="color: #20794D;">"1W"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">date</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">value</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span>, palette <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Dark2"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Lifetime risk of maternal death (%)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid.minor <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.8</span>, <span class="fl" style="color: #AD0000;">.9</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-two/worldbank.png" class="img-fluid"></p>
</section><section id="oecd" class="level1"><h1>OECD</h1>
<p>Organization for Economic Cooperation and Development provides detailed economic and demographic data on the member countries. There is an R package <code>OECD</code> that streamlines the use of their data in R. The function <code>search_dataset</code> works nicely to browse the available datasets by keywords. Then <code>get_dataset</code> would fetch the chosen dataset. In the example below I grab the data on the duration of unemployment and then plot the data for the male population of EU16, EU28 and the US as heatmaps.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/expersso/OECD">OECD</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># search by keyword</span></span>
<span><span class="fu" style="color: #4758AB;">search_dataset</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"unemployment"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">View</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download the selected dataset</span></span>
<span><span class="va" style="color: #111111;">df_oecd</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">get_dataset</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"AVD_DUR"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># turn variable names to lowercase</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_oecd</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_oecd</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_oecd</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"EU16"</span>, <span class="st" style="color: #20794D;">"EU28"</span>, <span class="st" style="color: #20794D;">"USA"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"MEN"</span>, <span class="op" style="color: #5E5E5E;">!</span> <span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"1524"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">obstime</span>, <span class="va" style="color: #111111;">age</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">obsvalue</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Months"</span>, option <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">paste</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span> <span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Age groups"</span>, </span>
<span>             title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Average duration of unemployment in months, males"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-two/oecd.png" class="img-fluid"></p>
</section><section id="wid" class="level1"><h1>WID</h1>
<p><a href="http://wid.world/wid-world/">World Wealth and Income Database</a> is a harmonized dataset on income and wealth inequality. The developers of the database provide an R package to get their data, which is only <a href="https://github.com/WIDworld/wid-r-tool">available from github</a> so far.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;">#install.packages("devtools")</span></span>
<span><span class="fu" style="color: #4758AB;">devtools</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"WIDworld/wid-r-tool"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">wid</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The function to acquire data is <code>download_wid()</code>. To specify the arguments, one would have to consult help pages of the package and select desired datasets.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op" style="color: #5E5E5E;">?</span><span class="va" style="color: #111111;">wid_series_type</span></span>
<span><span class="op" style="color: #5E5E5E;">?</span><span class="va" style="color: #111111;">wid_concepts</span></span></code></pre></div>
</div>
<p>The following nice example is adapted from <a href="https://github.com/WIDworld/wid-r-tool/raw/master/inst/doc/wid-demo.pdf">the package vignette</a>. It shows the share of wealth that was owned by the richest 1% and 10% of population in France and Great Britain.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">df_wid</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">download_wid</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        indicators <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"shweal"</span>, <span class="co" style="color: #5E5E5E;"># Shares of personal wealth</span></span>
<span>        areas <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"FR"</span>, <span class="st" style="color: #20794D;">"GB"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="co" style="color: #5E5E5E;"># In France an Italy</span></span>
<span>        perc <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"p90p100"</span>, <span class="st" style="color: #20794D;">"p99p100"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># Top 1% and top 10%</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_wid</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">value</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Top 1% and top 10% personal wealth shares in France and Great Britain"</span>,</span>
<span>             y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"top share"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span> <span class="va" style="color: #111111;">percentile</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-two/wid.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
All the code chunks together can be found in <a href="https://gist.github.com/ikashnitsky/2362ce308f47ff38c3da556384acd20f">this gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>tutorial</category>
  <category>data acquisition</category>
  <guid>https://ikashnitsky.github.io/2017/data-acquisition-two/index.html</guid>
  <pubDate>Mon, 06 Nov 2017 23:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/data-acquisition-two/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Data acquisition in R (1/4)</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/data-acquisition-one/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The series consists of four posts:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>
<strong>Loading prepared datasets</strong><br>
</li>
<li>
<a href="https://ikashnitsky.github.io/2017/data-acquisition-two">Accessing popular statistical databases</a><br>
</li>
<li>
<a href="https://ikashnitsky.github.io/2017/data-acquisition-three">Demographic data sources</a><br>
</li>
<li>Getting spatial data<br>
</li>
</ul>
</div>
</div>
<p>For each of the data acquisition options I provide a small visualization use case.</p>
<section id="built-in-datasets" class="level1"><h1>Built-in datasets</h1>
<p>For illustration purposes, many R packages include data samples. Base R comes with a <code>datasets</code> package that offers a wide range of simple, sometimes very famous, datasets. Quite a detailed list of built-in datasets from various packages is <a href="https://vincentarelbundock.github.io/Rdatasets/datasets.html">maintained by Vincent Arel-Bundock</a>.</p>
<p>The nice feature of the datasets form <code>datasets</code> package is that they are “always there”. The unique names of the datasets may be referred as the objects from Global Environment. Let’s have a look at a beautiful small dataset calls <code>swiss</code> - Swiss Fertility and Socioeconomic Indicators (1888) Data. I am going to check visually the difference in fertility based of rurality and domination of Catholic population.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">swiss</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Agriculture</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Fertility</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Catholic</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">50</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html">stat_ellipse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-one/swiss.png" class="img-fluid"></p>
</section><section id="gapminder" class="level1"><h1>Gapminder</h1>
<p>Some packages are created specifically to disseminate datasets in a ready to use format. One of the nice examples is a package <code>gapminder</code> that contains a neat dataset widely used by Hans Rosling in his Gapminder project.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gapminder</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lifeExp</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">continent</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.2</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.75</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op" style="color: #5E5E5E;">(</span>geom <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"path"</span>, fun.y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mean</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-one/gapminder.png" class="img-fluid"></p>
</section><section id="grab-a-dataset-by-url" class="level1"><h1>Grab a dataset by URL</h1>
<p>If a dataset is hosted online and has a direct link to the file, it can be easily imported into the R session just specifying the URL. For illustration, I will access <code>Galton</code> dataset from <code>HistData</code> package using a direct link from <a href="https://vincentarelbundock.github.io/Rdatasets/datasets.html">Vincent Arel-Bundock’s list</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">galton</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/master/csv/HistData/Galton.csv"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">galton</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">father</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-one/galton.png" class="img-fluid"></p>
</section><section id="download-and-unzip-an-archive" class="level1"><h1>Download and unzip an archive</h1>
<p>Quite often datasets are stored in archived from. With R it is very simple to download and unzip the desired data archives. As an example, I will download <a href="https://catalog.data.gov/dataset/historical-new-york-city-crime-data-ad47e">Historical New York City Crime Data</a> provided by the Government of the Sate of New York and hosted at data.gov portal. The logic of the process is: first, we create a directory for the unzipped data; second, we download the archive; finally, unzip the archive and read the data.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a directory for the unzipped data</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"unzipped"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"unzipped"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"Directory already exists"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># specify the URL of the archive</span></span>
<span><span class="va" style="color: #111111;">url_zip</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"http://www.nyc.gov/html/nypd/downloads/zip/analysis_and_planning/citywide_historical_crime_data_archive.zip"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># storing the archive in a temporary file</span></span>
<span><span class="va" style="color: #111111;">f</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">url_zip</span>, destfile <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">f</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">f</span>, exdir <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"unzipped/."</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>If the zipped file is rather big and we don’t want to download it again the next time we run the code, it might be useful to keep the archived data.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># if we want to keep the .zip file</span></span>
<span><span class="va" style="color: #111111;">path_unzip</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"unzipped/data_archive.zip"</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_unzip</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>       <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">url_zip</span>, <span class="va" style="color: #111111;">path_unzip</span>, mode<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"wb"</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>       <span class="st" style="color: #20794D;">'file alredy exists'</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_unzip</span>, exdir <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"unzipped/."</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Finally, let’s read and plot some of the downloaded data.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">murder</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xls</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"unzipped/Web Data 2010-2011/Seven Major Felony Offenses 2000 - 2011.xls"</span>,</span>
<span>                   sheet <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, range <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"A5:M13"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">OFFENSE</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"MURDER"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year"</span>, <span class="st" style="color: #20794D;">"value"</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">13</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>year <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">murder</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Murders in New York"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-one/new-york.png" class="img-fluid"></p>
</section><section id="figshare" class="level1"><h1>Figshare</h1>
<p>In Academia it is becoming more and more popular to store the datasets accompanying papers in the specialized repositories. Figshare is one of the most popular free repositories. There is an R package <code>rfigshare</code> to access the datasets from this portal. As an example I will grab <a href="https://dx.doi.org/10.6084/m9.figshare.3394735.v2">the dataset on ice-hockey playes height</a> that I assembled manually for <a href="https://ikashnitsky.github.io/2017/ice-hockey-players-height/">my blog post</a>. Please note that at the first run the package will ask to enter your Figshare login details to access API - a web page will be opened in browser.</p>
<p>There is a search function <code>fs_search</code>, though my experience shows that it is easier to search for a dataset in a browser and then use the id of a file to download it. The function <code>fs_download</code> turns an id number into a direct URL to download the file.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/ropensci-archive/rfigshare">rfigshare</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">url</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">fs_download</span><span class="op" style="color: #5E5E5E;">(</span>article_id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"3394735"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">hockey</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">url</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">hockey</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"#35978f"</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.1</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year of competition"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/data-acquisition-one/ice-hockey.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
All the code chunks can be found in <a href="https://gist.github.com/ikashnitsky/e1d93a51fe5e2b5ba770096060bacd8a">this gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>tutorial</category>
  <category>data acquisition</category>
  <guid>https://ikashnitsky.github.io/2017/data-acquisition-one/index.html</guid>
  <pubDate>Mon, 16 Oct 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/data-acquisition-one/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Young people neither in employment nor in education and training in Europe, 2000-2016</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/neet-in-europe/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>As an example of Eurostat data usage I chose to show the dynamics of NEET (Young people neither in employment nor in education and training) in European countries. The example is using the brilliant <code>geofact</code> package.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://forcats.tidyverse.org">forcats</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://ropengov.github.io/eurostat/">eurostat</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/hafen/geofacet">geofacet</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># Find the needed dataset code </span></span>
<span><span class="co" style="color: #5E5E5E;"># http://ec.europa.eu/eurostat/web/regions/data/database</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download fertility rates for countries</span></span>
<span><span class="va" style="color: #111111;">neet</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ropengov.github.io/eurostat/reference/get_eurostat.html">get_eurostat</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"edat_lfse_22"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># if the automated download does not work, the data can be grabbed manually at</span></span>
<span><span class="co" style="color: #5E5E5E;"># http://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing</span></span>
<span></span>
<span><span class="va" style="color: #111111;">neet</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">geo</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">paste</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va" style="color: #111111;">nchar</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">2</span>,</span>
<span>               <span class="va" style="color: #111111;">sex</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T"</span>, <span class="va" style="color: #111111;">age</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Y18-24"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">geo</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>avg <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">values</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">time</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                   y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">values</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">values</span><span class="op" style="color: #5E5E5E;">)</span>, pch <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2000</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"2000"</span>, <span class="st" style="color: #20794D;">"'05"</span>, <span class="st" style="color: #20794D;">"'10"</span>, <span class="st" style="color: #20794D;">"'15"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>, limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">40</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"NEET, %"</span>, option <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/geofacet/man/facet_geo.html">facet_geo</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span> <span class="va" style="color: #111111;">geo</span>, grid <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"eu_grid1"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Year"</span>,</span>
<span>             y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"NEET, %"</span>,</span>
<span>             title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Young people neither in employment nor in education and training in Europe"</span>,</span>
<span>             subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Data: Eurostat Regional Database, 2000-2016"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"ikashnitsky.github.io"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span>  <span class="st" style="color: #20794D;">"Roboto Condensed"</span>, base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>axis.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              panel.spacing.x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"lines"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/neet-in-europe/neet-in-europe.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The whole code may be downloaded from <a href="https://gist.github.com/ikashnitsky/5e073ccebbf1617e79d7d3cc080aceed">the gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>eurostat</category>
  <category>neet</category>
  <category>geofacet</category>
  <guid>https://ikashnitsky.github.io/2017/neet-in-europe/index.html</guid>
  <pubDate>Mon, 17 Jul 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/neet-in-europe/teaser.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Global convergence in male life expectancy at birth</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/global-male-life-expectancy-convergence/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>In the modern history, the world has seen unprecedented decrease in human mortality – the result of the Demographic Transition. Initially, the improvements occurred only in the most developed societies, and by the mid XX century the world population was roughly divided in two parts according to mortality patterns (see the bi-modal distribution). After the 2nd World War, the developing countries started to catch up, and there was a clear convergence in life expectancy at birth, the most common summary measure of mortality.</p>
<p><img src="https://ikashnitsky.github.io/2017/global-male-life-expectancy-convergence/e0-convergence.png" class="img-fluid"></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
To reproduce the plot from the scratch please see <a href="https://gist.github.com/ikashnitsky/2f6e29acbb9cbeb1694630c5932b8ad5">the gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>life expectancy</category>
  <category>global</category>
  <category>convergence</category>
  <guid>https://ikashnitsky.github.io/2017/global-male-life-expectancy-convergence/index.html</guid>
  <pubDate>Sun, 16 Jul 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/global-male-life-expectancy-convergence/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Accelerating ggplot2: use a canvas to speed up plots creation</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Too wrong; don’t read
</div>
</div>
<div class="callout-body-container callout-body">
<p>Basically, this post turned out to be just a wrong, premature, and unnecessary attempt of code optimization. If you still want to have look, make sure that later you read <a href="https://www.data-imaginist.com/2017/beneath-the-canvas/">this post</a> by Thomas Lin Pedersen. You are warned</p>
</div>
</div>
<hr>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
This post is updated on 2017-07-15
</div>
</div>
<div class="callout-body-container callout-body">
<p>The earlier version had a terminology mistake <a href="https://twitter.com/hadleywickham/status/882217871769837569">pointed out by Hadley Wickham</a>. I wrongly called creation time of the plots as rendering time.</p>
</div>
</div>
<p>One of the nice features of the <code>gg</code>approach to plotting is that one can save plots as R objects at any step and use later to render and/or modify. I used that feature extensively while creating maps with <code>ggplot2</code> (see my previous posts: <a href="https://ikashnitsky.github.io/2017/denmark-nuts-reconstruction/">one</a>, <a href="https://ikashnitsky.github.io/2017/map-hacking/">two</a>, <a href="https://ikashnitsky.github.io/2017/align-six-maps/">three</a>, <a href="https://ikashnitsky.github.io/2017/subplots-in-maps/">four</a>, <a href="https://ikashnitsky.github.io/2017/colorcoded-map/">five</a>). It is just convenient to first create a canvas with all the theme parameters appropriate for a map, and then overlay the map layer. At some point I decided to check if that workflow was computationally efficient or not. To my surprise, the usage of canvas reduces the creation time of a ggplot quite a lot. To my further surprise, this finding holds for simple plots as well as maps.</p>
<p>Let’s start with a simple check.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span>      <span class="co" style="color: #5E5E5E;"># data manipulation and viz</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span>       <span class="co" style="color: #5E5E5E;"># themes for ggplot2</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span>        <span class="co" style="color: #5E5E5E;"># the best color palette</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op" style="color: #5E5E5E;">)</span>          <span class="co" style="color: #5E5E5E;"># deal with shapefiles</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># measure the speed of executing</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span>      <span class="co" style="color: #5E5E5E;"># nice font</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">RColorBrewer</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a canvas </span></span>
<span><span class="va" style="color: #111111;">canv_mt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mtcars</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">hp</span>, <span class="va" style="color: #111111;">mpg</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cyl</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># test speed with mocrobenchmark</span></span>
<span><span class="va" style="color: #111111;">test</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        without_canvas <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mtcars</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">hp</span>, <span class="va" style="color: #111111;">mpg</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cyl</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        ,</span>
<span>        </span>
<span>        with_canvas <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">canv_mt</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>       </span>
<span>        ,</span>
<span>        </span>
<span>        times <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">100</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">test</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">test</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">expr</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span>discrete <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span>              axis.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"The speed of creating a simple ggplot"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/fig-01-test-simple.png" class="img-fluid"><strong>Figure 1. Microbenchmark output for a simple plot</strong></p>
<p>The median time of execution is 3.24 milliseconds for the plot <strong>without</strong> canvas and 2.29 milliseconds for the plot <strong>with</strong> canvas.</p>
<p>Next, let’s do the same check for a map. For that, I will use the data prepared for <a href="https://ikashnitsky.github.io/2017/subplots-in-maps/">one of my earlier posts</a> and recreate the simple map that shows the division of European Union 27 into three subregions.</p>
<p><img src="https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/fig-02-sub.png" class="img-fluid"><strong>Figure 2. The map we use to test the plot creation speed</strong></p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load the already prepared data</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/doc/misc/map-subplots/df-27-261-urb-rur.RData"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/doc/misc/map-subplots/spatial-27-261.RData"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># fortify spatial objects</span></span>
<span><span class="va" style="color: #111111;">neib</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sneighbors</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">bord</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sborders</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fort</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sn2</span>, region <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># join spatial and statistical data</span></span>
<span><span class="va" style="color: #111111;">fort_map</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span>, <span class="va" style="color: #111111;">fort</span>, <span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># pal for the subregions</span></span>
<span><span class="va" style="color: #111111;">brbg3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>,<span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a blank map</span></span>
<span><span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">neib</span>,</span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>,color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1350000</span>,<span class="fl" style="color: #AD0000;">5450000</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2500000</span>, <span class="fl" style="color: #AD0000;">6600000</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>,size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>,fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.background <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># test speed with mocrobenchmark</span></span>
<span><span class="va" style="color: #111111;">test_map</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        without_canvas <span class="op" style="color: #5E5E5E;">=</span> </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">neib</span>,</span>
<span>                             <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                             fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>,color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1350000</span>,<span class="fl" style="color: #AD0000;">5450000</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                            xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2500000</span>, <span class="fl" style="color: #AD0000;">6600000</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                            expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>,</span>
<span>                                                  size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>,fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.background <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                      legend.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">fort_map</span>, </span>
<span>                             <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span>, </span>
<span>                                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">)</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">brbg3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        ,</span>
<span>        </span>
<span>        with_canvas <span class="op" style="color: #5E5E5E;">=</span> </span>
<span>                <span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">fort_map</span>, </span>
<span>                             <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span>, </span>
<span>                                 fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">)</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">brbg3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        ,</span>
<span>        </span>
<span>        times <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">100</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      </span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">test_map</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">expr</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span>discrete <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>,</span>
<span>              axis.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"The speed of creating a map with ggplot2"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/fig-03-test-map.png" class="img-fluid"><strong>Figure 3. Microbenchmark output for a map</strong></p>
<p>The median time of execution is 18.8 milliseconds for the map <strong>without</strong> canvas and 6.3 milliseconds for the map <strong>with</strong> canvas.</p>
<section id="conclusion-use-canvas-with-ggplot2" class="level2"><h2 class="anchored" data-anchor-id="conclusion-use-canvas-with-ggplot2">Conclusion: Use canvas with <code>ggplot2</code>
</h2>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
For the full script to reproduce the results check out this <a href="https://gist.github.com/ikashnitsky/b9c5d0b838daa2338066dbaa3e035dcc">gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <category>speed</category>
  <guid>https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/index.html</guid>
  <pubDate>Mon, 03 Jul 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/ggplot2-microbenchmark/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Colorcoded map: regional population structures at a glance</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/colorcoded-map/index.html</link>
  <description><![CDATA[ 




<script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>Data visualization is quite often a struggle to represent multiple relevant dimensions preserving the readability of the plot. In this post I will show my recent multidimensional dataviz prepared for <a href="https://twitter.com/RostockRetreat">Rostock Retreat Visualization</a>, an event that gathered demographers for an amazing “three days long coffebreak”.</p>
<p>European population is rapidly ageing. But the process is not happening uniformly in all parts of Europe (see <a href="https://doi.org/10.1186/s41118-017-0018-2">my recent paper</a> for more info). Regions differ quite a lot: Eastern Europe still undergoes demographic dividend; Southern European regions form a cluster of lowest-low fertility; Western Europe experiences the greying of the baby boomers; urban regions attract young professionals and force out young parents; peripheral rural regions lose their youths forever… How can we grasp all the differences at a glance?</p>
<p>Here I want to present a colorcoded map. For each NUTS-3 region the unique color is produced by mixing red, green, and blue color spectrums in the proportions that reflect,correspondingly, relative shares of elderly populating (aged 65+), population at working ages (15-64), and kids (0-14).</p>
<p><img src="https://ikashnitsky.github.io/2017/colorcoded-map/fig-01.png" class="img-fluid"></p>
<p>Each of the three variables mapped here is scaled between 0 and 1: otherwise, the map would be just green with slightly variations in tones because the share of working age population is ranged between 65-75% for modern European regions. Thus, it is important to note that this map is not meant to be able to inform the reader of the exact population structure in a specific region. Rather, it provides a snapshot of all the regional population structures, facilitating comparisons between them. So, by design, the colors are only meaningful in comparison only for the given set of regions in a given year, in this case 2015. If we want cross-year comparisons, the variables are to be scaled across the whole timeseries, meaning that each separate map would, most likely, become less contrast.</p>
<p>In the map we can easily spot the major differences between subregions of Europe. Turkey is still having relatively high fertility, especially in the south-eastern Kurdish part, thus it has higher share of kids and it’s colored in blueish tones. The high-fertility Ireland is also evidently blue in the map. East-European regions are green due to the still lasting demographic dividend. Southern Europe is ageing fastest, thus the colors are reddish.</p>
<p>We can also see most of the major capital regions that are bright-green as opposed to the depleted periphery. In some countries there are huge regional differences: Northern and Southern Italy, Eastern and Western Germany.</p>
<p>It is striking how clearly can we see the borders between European countries: Poland and Germany, Czech Republic and Slovakia, Portugal and Spain, France and all the neighbors. The slowly evolving population structures bare imprints of unique populations’ histories, that largely correspond with state borders.</p>
<p>The obvious drawback of the map is that it is not colorblind friendly, and there is no way to make it so because color is the main player in this dataviz.</p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
To reproduce the map from the scratch please see <a href="https://gist.github.com/ikashnitsky/c7bf13f6c716f65ddba3e52073793f3f">the gist</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <category>rspatial</category>
  <category>tricolore</category>
  <guid>https://ikashnitsky.github.io/2017/colorcoded-map/index.html</guid>
  <pubDate>Thu, 29 Jun 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/colorcoded-map/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Evolution of ice hockey players’ height: IIHF world championships 2001-2016</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/ice-hockey-players-height/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>The 2017 Ice Hockey World Championship has started. Thus I want to share a small research on the height of ice hockey players that I did almost a year ago and <a href="https://habrahabr.ru/post/301340/">published in Russian</a>.</p>
<p>When the TV camera shows the players returning to the changing rooms, it is difficult not to notice just how huge the players are compared to the surrounding people – fans, journalists, coaches, or the ice arena workers. For example, here are the rising stars of the Finnish hockey – Patrik Laine and Aleksander Barkov – with the two fans in between.</p>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-00-laine-barkov.jpg" class="img-fluid"><em><a href="https://www.instagram.com/p/BFjNdn7zORh">Source</a></em></p>
<p>So the questions arise. Are ice hockey players really taller than average people? How is the height of ice hockey players evolving over time? Are there any lasting differences between countries?</p>
<section id="data" class="level1"><h1>Data</h1>
<p>IIHF, the organization that is in charge for the ice hockey world championships, publishes detailed information on the squads, including the data on player’s height and weight. The raw data files are <a href="http://www.iihf.com/iihf-home/history/past-tournaments/">here</a>. I gathered the data of all players that participated in the 16 world championships between 2001 and 2016. The formatting of the data files changes from year to year complicating the data processing. So I did the data cleaning manually which took a bit more than 3 hours. The unifies dataset is <a href="https://dx.doi.org/10.6084/m9.figshare.3394735.v2">here</a>. Let’s load the data and prepare the R session.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># load required packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># data manipulation and viz</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># easy manipulations with dates</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># themes for ggplot2</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/leifeld/texreg/">texreg</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># easy export of regression tables</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://xtable.r-forge.r-project.org/">xtable</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># export a data frame into an html table</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/yixuan/sysfonts">sysfonts</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># change the font in figures</span></span>
<span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># download the IIHF data set; if there are some problems, you can download manually</span></span>
<span><span class="co" style="color: #5E5E5E;"># using the stable URL (https://dx.doi.org/10.6084/m9.figshare.3394735.v2)</span></span>
<span><span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ndownloader.figshare.com/files/5303173"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># color palette</span></span>
<span><span class="va" style="color: #111111;">brbg11</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">RColorBrewer</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>, <span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="do-the-players-become-taller-a-crude-comparison" class="level1"><h1>Do the players become taller? (a crude comparison)</h1>
<p>Let’s first have a look at the pulled average height of all the players that participated.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># mean height by championship</span></span>
<span><span class="va" style="color: #111111;">df_per</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>height <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period_mean</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_per</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year of competition"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period_jitter</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.75</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"year of competition"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2005</span>, <span class="fl" style="color: #AD0000;">2015</span>, <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_period</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">cowplot</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">gg_period_mean</span>, <span class="va" style="color: #111111;">gg_period_jitter</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-01-period-height.png" class="img-fluid"></p>
<p><strong>Figure 1. The dynamics of the average height of the ice hockey players at the world championships, 2001–2016</strong></p>
<p>The positive trend is evident. In the 15 years the average height of a player increased by almost 2 cm (left panel). Is that a lot? To have an idea, we will compare this growth to the dynamics in the population, later in the post.</p>
</section><section id="cohort-approach" class="level1"><h1>Cohort approach</h1>
<p>A more correct way to study the dynamics of players’ height is to do the comparison between birth cohorts. Here we face an interesting data preparation issue – some of the players participated in more that one championships. The question is: do we need to clean the duplicate records? If the goal is to see the average height of a player at the certain championship (as in Figure 1), it is reasonable to keep all the records. Alternatively, if the aim is to analyze the dynamics of players’ height itself, I argue, it would be wrong to assign bigger weight to those players that participated in more that one championship. Thus, for the further cohort analysis, I cleaned the dataset from the duplicates.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dfu_h</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">height</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">av.height</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">sum</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">dfu_w</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfu_w</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">av.weight</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu_h</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">av.height</span>, <span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 <span class="va" style="color: #111111;">dfu_w</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">position</span>, <span class="va" style="color: #111111;">birth</span>, <span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">av.weight</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 by <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"name"</span>, <span class="st" style="color: #20794D;">"country"</span>, <span class="st" style="color: #20794D;">"position"</span>, <span class="st" style="color: #20794D;">"birth"</span>, <span class="st" style="color: #20794D;">"cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>bmi <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.weight</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">av.height</span> <span class="op" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">^</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The total number of observations decreased from 6292 to 3333. For those who participated in more that one championship, I averaged the data on height and weight as they can change during the life-course. How many times, on average, are ice hockey players honored to represent their countries in the world championships? A bit less than 2.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># frequencies of participation in world championships</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">times_participated</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_times_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_part</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Freq</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Var1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"identity"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"times participated (out of 16 possible)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-02-times-part.png" class="img-fluid"></p>
<p><strong>Figure 2. Histogram of the players by the number of times they participated in world championships over the period 2001-2016.</strong></p>
<p>But there are unique players that participated in a considerable number of championships. Let’s have a look at those who participated at least 10 times out of 16 possible. There were just 14 such players.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># the leaders of participation in world championships</span></span>
<span><span class="va" style="color: #111111;">leaders</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">times_participated</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">leaders</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="co" style="color: #5E5E5E;"># save the table to html</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">leaders</span><span class="op" style="color: #5E5E5E;">)</span>, type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"html"</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"table_leaders.html"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table 1. The most frequently participated players</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
name
</th>
<th class="tg-lyle">
country
</th>
<th class="tg-lyle">
position
</th>
<th class="tg-lyle">
birth date
</th>
<th class="tg-lyle">
cohort
</th>
<th class="tg-lyle">
av.height
</th>
<th class="tg-lyle">
times _participated
</th>
<th class="tg-lyle">
av.weight
</th>
<th class="tg-lyle">
bmi
</th>
</tr>
<tr>
<td class="tg-ls8f">
ovechkin alexander
</td>
<td class="tg-jrsh">
RUS
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1985-09-17
</td>
<td class="tg-jrsh">
1985
</td>
<td class="tg-jrsh">
188.45
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
98.36
</td>
<td class="tg-jrsh">
27.70
</td>
</tr>
<tr>
<td class="tg-ls8f">
nielsen daniel
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1980-10-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
182.27
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
79.73
</td>
<td class="tg-jrsh">
24.00
</td>
</tr>
<tr>
<td class="tg-ls8f">
staal kim
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1978-03-10
</td>
<td class="tg-jrsh">
1978
</td>
<td class="tg-jrsh">
182.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
87.80
</td>
<td class="tg-jrsh">
26.51
</td>
</tr>
<tr>
<td class="tg-ls8f">
green morten
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1981-03-19
</td>
<td class="tg-jrsh">
1981
</td>
<td class="tg-jrsh">
183.00
</td>
<td class="tg-jrsh">
12
</td>
<td class="tg-jrsh">
85.83
</td>
<td class="tg-jrsh">
25.63
</td>
</tr>
<tr>
<td class="tg-ls8f">
masalskis edgars
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
G
</td>
<td class="tg-jrsh">
1980-03-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
176.00
</td>
<td class="tg-jrsh">
12
</td>
<td class="tg-jrsh">
79.17
</td>
<td class="tg-jrsh">
25.56
</td>
</tr>
<tr>
<td class="tg-ls8f">
ambuhl andres
</td>
<td class="tg-jrsh">
SUI
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1983-09-14
</td>
<td class="tg-jrsh">
1983
</td>
<td class="tg-jrsh">
176.80
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
83.70
</td>
<td class="tg-jrsh">
26.78
</td>
</tr>
<tr>
<td class="tg-ls8f">
granak dominik
</td>
<td class="tg-jrsh">
SVK
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1983-06-11
</td>
<td class="tg-jrsh">
1983
</td>
<td class="tg-jrsh">
182.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
79.50
</td>
<td class="tg-jrsh">
24.00
</td>
</tr>
<tr>
<td class="tg-ls8f">
madsen morten
</td>
<td class="tg-jrsh">
DEN
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1987-01-16
</td>
<td class="tg-jrsh">
1987
</td>
<td class="tg-jrsh">
189.82
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
86.00
</td>
<td class="tg-jrsh">
23.87
</td>
</tr>
<tr>
<td class="tg-ls8f">
redlihs mikelis
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1984-07-01
</td>
<td class="tg-jrsh">
1984
</td>
<td class="tg-jrsh">
180.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
80.40
</td>
<td class="tg-jrsh">
24.81
</td>
</tr>
<tr>
<td class="tg-ls8f">
cipulis martins
</td>
<td class="tg-jrsh">
LAT
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-11-29
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
180.70
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
82.10
</td>
<td class="tg-jrsh">
25.14
</td>
</tr>
<tr>
<td class="tg-ls8f">
holos jonas
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
D
</td>
<td class="tg-jrsh">
1987-08-27
</td>
<td class="tg-jrsh">
1987
</td>
<td class="tg-jrsh">
180.18
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
91.36
</td>
<td class="tg-jrsh">
28.14
</td>
</tr>
<tr>
<td class="tg-ls8f">
bastiansen anders
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-10-31
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
190.00
</td>
<td class="tg-jrsh">
11
</td>
<td class="tg-jrsh">
93.64
</td>
<td class="tg-jrsh">
25.94
</td>
</tr>
<tr>
<td class="tg-ls8f">
ask morten
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1980-05-14
</td>
<td class="tg-jrsh">
1980
</td>
<td class="tg-jrsh">
185.00
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
88.30
</td>
<td class="tg-jrsh">
25.80
</td>
</tr>
<tr>
<td class="tg-ls8f">
forsberg kristian
</td>
<td class="tg-jrsh">
NOR
</td>
<td class="tg-jrsh">
F
</td>
<td class="tg-jrsh">
1986-05-05
</td>
<td class="tg-jrsh">
1986
</td>
<td class="tg-jrsh">
184.50
</td>
<td class="tg-jrsh">
10
</td>
<td class="tg-jrsh">
87.50
</td>
<td class="tg-jrsh">
25.70
</td>
</tr>
</tbody></table>
<p>Alexander Ovechkin – 11 times! But it has to be noted that not every player had a possibility to participate in all the 16 championships between 2001 and 2016. That depends on a numder of factors:<br>
- the birth cohort of the player; - whether his national team regularly qualified for the championship (Figure 3); - whether the player was good enough for the national team; - whether he was free from the NHL play-offs that often keep the best players off the world championships.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># countries times participated</span></span>
<span><span class="va" style="color: #111111;">df_cnt_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">no</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">no</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>value <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, levels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>               year <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">year</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">d_cnt_n</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_cnt_part</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_cnt_part</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_cnt_part</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">d_cnt_n</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">17.5</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">d_cnt_n</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18.5</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">" "</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span><span class="op" style="color: #5E5E5E;">(</span>colours <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">25</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              axis.text.x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>angle <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">90</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-03-countries-part.png" class="img-fluid"></p>
<p><strong>Figure 3. Stats of the national teams participation in the world championships</strong></p>
</section><section id="do-the-ice-hochey-players-become-taller-regression-analysis" class="level1"><h1>Do the ice hochey players become taller? (regression analysis)</h1>
<p>The regression analysis allows to address the research question – the association between player’s height and birth cohort – accounting for the cross-national differences and player’s position. I use OLS regressions, that are quite sensitive to outliers. I removed the birth cohorts for which there are less than 10 players – 1963, 1997, and 1998.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># remove small cohorts</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfu</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span> <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="fl" style="color: #AD0000;">1997</span>, <span class="va" style="color: #111111;">cohort</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">1963</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>So, the results. I add the variables one by one.</p>
<p><strong>Dependent variable</strong>: player’s height.<br><strong>Explaining variables</strong>: 1) birth cohort; 2) position (compared to defenders); 3) country (compared to Russia).</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># relevel counrty variable to compare with Russia</span></span>
<span><span class="va" style="color: #111111;">dfuc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span>, ref <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"RUS"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># regression models</span></span>
<span><span class="va" style="color: #111111;">m1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># export the models to html</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/texreg/man/htmlreg.html">htmlreg</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">m1</span>, <span class="va" style="color: #111111;">m2</span>, <span class="va" style="color: #111111;">m3</span><span class="op" style="color: #5E5E5E;">)</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"models_height.html"</span>, single.row <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table2. The models</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-t6te{font-style:italic;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-mmdc{font-style:italic;font-family:Georgia, serif !important;}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
</th>
<th class="tg-lyle">
Model 1
</th>
<th class="tg-lyle">
Model 2
</th>
<th class="tg-lyle">
Model 3
</th>
</tr>
<tr>
<td class="tg-ls8f">
(Intercept)
</td>
<td class="tg-jrsh">
-10.17 (27.67)
</td>
<td class="tg-jrsh">
-18.64 (27.01)
</td>
<td class="tg-jrsh">
32.59 (27.00)
</td>
</tr>
<tr>
<td class="tg-ls8f">
cohort
</td>
<td class="tg-jrsh">
0.10 (0.01)***
</td>
<td class="tg-jrsh">
0.10 (0.01)***
</td>
<td class="tg-jrsh">
0.08 (0.01)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
positionF
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-2.59 (0.20)***
</td>
<td class="tg-jrsh">
-2.59 (0.20)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
positionG
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.96 (0.31)***
</td>
<td class="tg-jrsh">
-1.93 (0.30)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryAUT
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.94 (0.55)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryBLR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.95 (0.53)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCAN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.13 (0.46)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCZE
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.56 (0.49)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryDEN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.10 (0.56)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFIN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.20 (0.50)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFRA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-2.19 (0.69)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryGER
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.61 (0.51)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryHUN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-0.61 (0.86)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryITA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-3.58 (0.61)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryJPN
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-5.24 (0.71)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryKAZ
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.16 (0.57)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryLAT
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.38 (0.55)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryNOR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.61 (0.62)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryPOL
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.06 (1.12)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySLO
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.55 (0.58)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySUI
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.80 (0.53)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySVK
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.44 (0.50)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySWE
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
1.18 (0.48)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUKR
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
-1.82 (0.59)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUSA
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
</td>
<td class="tg-jrsh">
0.54 (0.45)
</td>
</tr>
<tr>
<td class="tg-mmdc">
R2
</td>
<td class="tg-t6te">
0.01
</td>
<td class="tg-t6te">
0.06
</td>
<td class="tg-t6te">
0.13
</td>
</tr>
<tr>
<td class="tg-mmdc">
Adj. R2
</td>
<td class="tg-t6te">
0.01
</td>
<td class="tg-t6te">
0.06
</td>
<td class="tg-t6te">
0.12
</td>
</tr>
<tr>
<td class="tg-mmdc">
Num. obs.
</td>
<td class="tg-t6te">
3319
</td>
<td class="tg-t6te">
3319
</td>
<td class="tg-t6te">
3319
</td>
</tr>
<tr>
<td class="tg-mmdc">
RMSE
</td>
<td class="tg-t6te">
5.40
</td>
<td class="tg-t6te">
5.27
</td>
<td class="tg-t6te">
5.10
</td>
</tr>
</tbody></table>
<p><strong>Model 1</strong>. One year change in the birth cohort year is associated with an increase of 0.1 cm in height. The coefficient is statistically significant, yet the variable explains only 1% of the variance. That’s not a big problem since the aim of the modeling is to document the differences, rather than predict based on the model. Nevertheless, the low coefficient of determination means that there are other variables that explain the differences in players’ height better than just the birth cohort.</p>
<p><strong>Model 2.</strong> Defenders are the tallest ice hockey players: goalkeepers are 2 cm shorter, forwards are 2.6 cm shorter. All the coefficients are significant; R squared rose to 6%. It is worth noting that the coefficient for the birth cohort did not change when we added the new variable.</p>
<p><strong>Model 3</strong>. It is interesting to control for countries for two reasons. First, some of the differences are significant themselves. For example, Swedes, Slovaks, and Canadians are higher than Russians. In contrast, Japanese are 5.2 cm shorter, Italians – 3.6 cm, French – 2.2 cm (figure 4). Second, once the country controls are introduced, the coefficient for birth cohort decreased slightly meaning that some of the differences in height are explained by persisting cross-country differences. R squared rose to 13%.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># players' height by country</span></span>
<span><span class="va" style="color: #111111;">gg_av.h_country</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc</span> , <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span>, geom <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"line"</span>, fun.y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">mean</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey50"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span>, geom <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"line"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">170</span>, <span class="fl" style="color: #AD0000;">195</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"birth cohort"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-04-height-by-country.png" class="img-fluid"></p>
<p><strong>Figure 4. The height of ice hockey players by nations</strong></p>
<p>The last model indicates that from one birth cohort cohort to the other the height of ice hockey players increases 0.08 cm. That means an increase of 0.8 cm in a decade or a growth of 2.56 cm in the 32 years between 1964 and 1996. It is worth mentioning that once we run the analysis in cohorts and controlling for positions and nations, the speed of the player’s height increase becomes much humbler than in the crude pulled analysis (Figure 1): 0.8 cm per decade compared to 1.2 cm per decade.</p>
<p>Before we go further and compare the growth in player’s height to that of the population, let’s do the modeling separately for defenders, goalkeepers, and forwards. The exploratory plot (Figure 5) suggests that the correlation is stronger for goalkeepers and weaker for defenders.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dfuc_pos</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfuc</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc_pos</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Defenders"</span>, <span class="st" style="color: #20794D;">"Forwards"</span>, <span class="st" style="color: #20794D;">"Goalkeeprs"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_pos</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dfuc_pos</span> , <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">position</span><span class="op" style="color: #5E5E5E;">)</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1970</span>, <span class="fl" style="color: #AD0000;">1990</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>, <span class="fl" style="color: #AD0000;">9</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">position</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"birth cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"height, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-05-corr-by-pos.png" class="img-fluid"></p>
<p><strong>Figure 5. Correlation between height and birth cohort by position</strong></p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># separate models for positions</span></span>
<span><span class="va" style="color: #111111;">m3d</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"D"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3f</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"F"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">m3g</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dfuc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">position</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"G"</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">+</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/texreg/man/htmlreg.html">htmlreg</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">m3d</span>, <span class="va" style="color: #111111;">m3f</span>, <span class="va" style="color: #111111;">m3g</span><span class="op" style="color: #5E5E5E;">)</span>, file <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"models_height_pos.html"</span>, single.row <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, </span>
<span>        custom.model.names <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Model 3 D"</span>, <span class="st" style="color: #20794D;">"Model 3 F"</span>, <span class="st" style="color: #20794D;">"Model 3 G"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<strong>Table 3. Model 3 – separately for defenders, forwards, and goalkeepers</strong><br><style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:3px 3px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-ls8f{font-family:Georgia, serif !important;}
.tg .tg-t6te{font-style:italic;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-oa1s{font-weight:bold;font-family:Georgia, serif !important;}
.tg .tg-jrsh{font-family:Georgia, serif !important;;text-align:center}
.tg .tg-lyle{font-weight:bold;font-family:Georgia, serif !important;;text-align:center}
.tg .tg-mmdc{font-style:italic;font-family:Georgia, serif !important;}
</style>
<table class="tg">
<tbody><tr>
<th class="tg-oa1s">
</th>
<th class="tg-lyle">
Model 3 D
</th>
<th class="tg-lyle">
Model 3 F
</th>
<th class="tg-lyle">
Model 3 G
</th>
</tr>
<tr>
<td class="tg-ls8f">
(Intercept)
</td>
<td class="tg-jrsh">
108.45 (46.46)*
</td>
<td class="tg-jrsh">
49.32 (36.73)
</td>
<td class="tg-jrsh">
-295.76 (74.61)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
cohort
</td>
<td class="tg-jrsh">
0.04 (0.02)
</td>
<td class="tg-jrsh">
0.07 (0.02)***
</td>
<td class="tg-jrsh">
0.24 (0.04)***
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryAUT
</td>
<td class="tg-jrsh">
0.14 (0.96)
</td>
<td class="tg-jrsh">
-2.01 (0.75)**
</td>
<td class="tg-jrsh">
0.47 (1.47)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryBLR
</td>
<td class="tg-jrsh">
0.30 (0.87)
</td>
<td class="tg-jrsh">
-1.53 (0.73)*
</td>
<td class="tg-jrsh">
-2.73 (1.55)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCAN
</td>
<td class="tg-jrsh">
1.55 (0.78)*
</td>
<td class="tg-jrsh">
0.39 (0.62)
</td>
<td class="tg-jrsh">
3.45 (1.26)**
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryCZE
</td>
<td class="tg-jrsh">
0.87 (0.84)
</td>
<td class="tg-jrsh">
0.30 (0.67)
</td>
<td class="tg-jrsh">
0.63 (1.36)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryDEN
</td>
<td class="tg-jrsh">
-0.60 (0.95)
</td>
<td class="tg-jrsh">
0.10 (0.75)
</td>
<td class="tg-jrsh">
-0.19 (1.62)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFIN
</td>
<td class="tg-jrsh">
-0.55 (0.89)
</td>
<td class="tg-jrsh">
-0.04 (0.67)
</td>
<td class="tg-jrsh">
2.40 (1.32)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryFRA
</td>
<td class="tg-jrsh">
-3.34 (1.15)**
</td>
<td class="tg-jrsh">
-2.06 (0.93)*
</td>
<td class="tg-jrsh">
1.39 (2.07)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryGER
</td>
<td class="tg-jrsh">
0.48 (0.85)
</td>
<td class="tg-jrsh">
-1.40 (0.72)
</td>
<td class="tg-jrsh">
-0.65 (1.33)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryHUN
</td>
<td class="tg-jrsh">
-1.32 (1.47)
</td>
<td class="tg-jrsh">
-0.70 (1.16)
</td>
<td class="tg-jrsh">
0.65 (2.39)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryITA
</td>
<td class="tg-jrsh">
-2.08 (1.08)
</td>
<td class="tg-jrsh">
-4.78 (0.82)***
</td>
<td class="tg-jrsh">
-2.02 (1.62)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryJPN
</td>
<td class="tg-jrsh">
-4.13 (1.26)**
</td>
<td class="tg-jrsh">
-6.52 (0.94)***
</td>
<td class="tg-jrsh">
-2.27 (1.98)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryKAZ
</td>
<td class="tg-jrsh">
-1.23 (0.95)
</td>
<td class="tg-jrsh">
-1.82 (0.79)*
</td>
<td class="tg-jrsh">
1.79 (1.58)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryLAT
</td>
<td class="tg-jrsh">
-0.73 (0.95)
</td>
<td class="tg-jrsh">
-1.39 (0.75)
</td>
<td class="tg-jrsh">
-3.42 (1.49)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryNOR
</td>
<td class="tg-jrsh">
-3.25 (1.07)**
</td>
<td class="tg-jrsh">
-1.06 (0.85)
</td>
<td class="tg-jrsh">
-0.10 (1.66)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryPOL
</td>
<td class="tg-jrsh">
0.82 (1.89)
</td>
<td class="tg-jrsh">
-0.58 (1.55)
</td>
<td class="tg-jrsh">
0.37 (2.97)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySLO
</td>
<td class="tg-jrsh">
-1.57 (0.99)
</td>
<td class="tg-jrsh">
-1.54 (0.79)
</td>
<td class="tg-jrsh">
-2.25 (1.66)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySUI
</td>
<td class="tg-jrsh">
-1.98 (0.91)*
</td>
<td class="tg-jrsh">
-2.36 (0.71)***
</td>
<td class="tg-jrsh">
1.12 (1.47)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySVK
</td>
<td class="tg-jrsh">
2.94 (0.87)***
</td>
<td class="tg-jrsh">
0.81 (0.67)
</td>
<td class="tg-jrsh">
-0.70 (1.50)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countrySWE
</td>
<td class="tg-jrsh">
0.75 (0.81)
</td>
<td class="tg-jrsh">
1.24 (0.65)
</td>
<td class="tg-jrsh">
1.37 (1.33)
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUKR
</td>
<td class="tg-jrsh">
-1.37 (1.01)
</td>
<td class="tg-jrsh">
-1.77 (0.80)*
</td>
<td class="tg-jrsh">
-3.71 (1.66)*
</td>
</tr>
<tr>
<td class="tg-ls8f">
countryUSA
</td>
<td class="tg-jrsh">
0.76 (0.78)
</td>
<td class="tg-jrsh">
-0.08 (0.62)
</td>
<td class="tg-jrsh">
2.58 (1.26)*
</td>
</tr>
<tr>
<td class="tg-mmdc">
R2
</td>
<td class="tg-t6te">
0.09
</td>
<td class="tg-t6te">
0.10
</td>
<td class="tg-t6te">
0.24
</td>
</tr>
<tr>
<td class="tg-mmdc">
Adj. R2
</td>
<td class="tg-t6te">
0.07
</td>
<td class="tg-t6te">
0.09
</td>
<td class="tg-t6te">
0.20
</td>
</tr>
<tr>
<td class="tg-mmdc">
Num. obs.
</td>
<td class="tg-t6te">
1094
</td>
<td class="tg-t6te">
1824
</td>
<td class="tg-t6te">
401
</td>
</tr>
<tr>
<td class="tg-mmdc">
RMSE
</td>
<td class="tg-t6te">
5.08
</td>
<td class="tg-t6te">
5.08
</td>
<td class="tg-t6te">
4.87
</td>
</tr>
</tbody></table>
<p>The separate modeling shows that the average height of ice hockey players, that were born in 1964-1996 and participated in the world championships in 2001–2016, increased with the speed of 0.4 cm per decade for defenders, 0.7 cm – for forwards, and (!) 2.4 cm – for goalies. In three decades the average height of the goalkeepers increased by 7 cm!</p>
<p>Finally, let’s compare these dynamics with those in the population.</p>
</section><section id="compare-to-population" class="level1"><h1>Compare to population</h1>
<p>Our previous results expose significant height differences between players of various nations. Thus, it is reasonable to compare ice hockey players’ height to the corresponding male population of their countries.</p>
<p>For the data on the height of males in population in the corresponding nations I used the <a href="https://dx.doi.org/10.1016/j.ehb.2010.03.001">relevant scientific paper</a>. I grabbed the data from the paper PDF using a nice little tool – <a href="http://tabula.technology/">tabula</a> – and also <a href="https://dx.doi.org/10.6084/m9.figshare.3394795.v1">deposited on figshare</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># download the data from Hatton, T. J., &amp; Bray, B. E. (2010).</span></span>
<span><span class="co" style="color: #5E5E5E;"># Long run trends in the heights of European men, 19th–20th centuries.</span></span>
<span><span class="co" style="color: #5E5E5E;"># Economics &amp; Human Biology, 8(3), 405–413.</span></span>
<span><span class="co" style="color: #5E5E5E;"># http://doi.org/10.1016/j.ehb.2010.03.001</span></span>
<span><span class="co" style="color: #5E5E5E;"># stable URL, copied data (https://dx.doi.org/10.6084/m9.figshare.3394795.v1)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ndownloader.figshare.com/files/5303878"</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"country"</span>, <span class="st" style="color: #20794D;">"h_pop"</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">16</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>period <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"t1"</span>, <span class="st" style="color: #20794D;">"t2"</span><span class="op" style="color: #5E5E5E;">)</span>, sep <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"/"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span>cohort <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">t1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">t2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">/</span><span class="fl" style="color: #AD0000;">2</span>, <span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># calculate hockey players' cohort height averages for each country</span></span>
<span><span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dfu</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, <span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>h_hp <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">av.height</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Unfortunately, our dataset on ice hockey players intersects with the data on population only for 8 countries: Austria, Denmark, Finland, France, Germany, Italy, Norway, and Sweden.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># countries in both data sets</span></span>
<span><span class="va" style="color: #111111;">both_cnt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hoc</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span><span class="va" style="color: #111111;">both_cnt</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">gg_hoc_vs_pop</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                  color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"white"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_hp</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, pch <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df_hoc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cohort</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">h_hp</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                    method <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lm"</span>, se <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"height, cm"</span>, x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"birth cohort"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-06-players-vs-population.png" class="img-fluid"></p>
<p><strong>Figure 6. The comparison of height dynamics in ice hockey players (brown) and the corresponding male populations (green)</strong></p>
<p>In all the analyzed countries, ice hockey players are 2-5 cm higher that the nation’s average. This is not very surprising since we expect some selection in sport. What is more interesting, in the developed countries the rapid increase in the height of males mostly leveled off in the birth cohorts of 1960s. Unlike the population trend, the height of ice hockey players continued to increase with roughly the same pace in all the analyzed countries except for Denmark.</p>
<p>For the cohorts of Europeans that were born in first half of 20-th century, the height of males increased by 1.18–1.74 cm per decade (Figure 7, middle panel). Starting from the birth cohorts of 1960s, the pace decreased to 0.15–0.80 per decade.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># growth in population</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb_w</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span>, <span class="va" style="color: #111111;">h_pop</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"y"</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">diffs</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">26</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">-</span><span class="va" style="color: #111111;">df_hb_w</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">25</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="va" style="color: #111111;">df_hb_gr</span><span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_hb_w</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, </span>
<span>                  gr_1961_1980 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">22</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">24</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span>, </span>
<span>                  gr_1901_1960 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span>, </span>
<span>                  gr_1856_1900 <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">diffs</span><span class="op" style="color: #5E5E5E;">[</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">mean</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"period"</span>, <span class="st" style="color: #20794D;">"average_growth"</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">both_cnt</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span>, levels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>               period <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">period</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"1856-1900"</span>, <span class="st" style="color: #20794D;">"1901-1960"</span>, <span class="st" style="color: #20794D;">"1961-1980"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_hb_growth</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_hb_gr</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">average_growth</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>, <span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">2.15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">period</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"average growth in men's height over 10 years, cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-07-av-growth-pop.png" class="img-fluid"></p>
<p><strong>Figure 7. Average changes in male population</strong></p>
<p>The height increase for ice hockey players seems quite impressive if we compare it to the stagnating dynamics in the corresponding male populations. And the acceleration of goalkeepers’ height is outright amazing.</p>
<p>The diverging trends in the height of ice hockey players and normal population is likely to be driven by the strengthening selection in sport.</p>
</section><section id="selection-in-ice-hockey" class="level1"><h1>Selection in ice hockey</h1>
<p>Looking through the literature on the selection in sport, I saw <a href="https://dx.doi.org/10.1080/02640410600908001">the finding</a> that showed a notable disproportion of professional sportsmen by the month of birth. There are much more sportsmen that were born in the first half of the year. They have a lasting advantage since the kids teams are usually formed by birth cohorts. Thus, those born earlier in the year always have a bit more time lived compared to their later born team mates, which means that they are physically more mature. It is easy to test the finding on our ice hockey players dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># check if there are more players born in earlier months</span></span>
<span><span class="va" style="color: #111111;">df_month</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>month <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>month <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_month</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_month</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"count"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">12</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">month.abb</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"month of birth"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-08-month-selectivity.png" class="img-fluid"></p>
<p><strong>Figure 8. The distribution of ice hockey players by month of birth</strong></p>
<p>True, the distribution is notably skewed – there are much more players born in earlier months. When I further split the dataset by the decades of birth, it becomes clear that the effect becomes more evident with time (Figure 9). Indirectly, that means that the selection in ice hockey becomes tougher.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># facet by decades</span></span>
<span><span class="va" style="color: #111111;">df_month_dec</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">df_month</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>dec <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cohort</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">3</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                       <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"born in"</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"1960s"</span>, <span class="st" style="color: #20794D;">"1970s"</span>, <span class="st" style="color: #20794D;">"1980s"</span>, <span class="st" style="color: #20794D;">"1990s"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">gg_month_dec</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_month_dec</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">month</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op" style="color: #5E5E5E;">(</span>stat <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"count"</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">brbg11</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op" style="color: #5E5E5E;">(</span>breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">12</span>, labels <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">month.abb</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"month of birth"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"# of players"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">dec</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, scales <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"free"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_few.html">theme_few</a></span><span class="op" style="color: #5E5E5E;">(</span>base_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span>, base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"mono"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, </span>
<span>              panel.grid <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey75"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.25</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/ice-hockey-players-height/fig-09-month-selectivity-decades.png" class="img-fluid"></p>
<p><strong>Figure 9. The distribution of ice hockey players by month of birth – separately by decades of birth</strong></p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The full R script can be downloaded <a href="https://dx.doi.org/10.6084/m9.figshare.3395983.v2">here</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->

</section> ]]></description>
  <category>r</category>
  <category>hockey</category>
  <category>sport</category>
  <category>height</category>
  <guid>https://ikashnitsky.github.io/2017/ice-hockey-players-height/index.html</guid>
  <pubDate>Fri, 26 May 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/ice-hockey-players-height/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Subplots in maps with ggplot2</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/subplots-in-maps/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>Following the <a href="https://ikashnitsky.github.io/images/170525/prev-post-success.png">surprising success</a> of <a href="https://ikashnitsky.github.io/2017/align-six-maps/">my latest post</a>, I decided to show yet another use case of the handy annotation custom function. Here I will show how to add small graphical information to maps – just like putting a stamp on an envelope.</p>
<p>The example comes from my current work on a paper, in which I study the effect of urban/rural differences on the relative differences in population ageing (I plan to tell a bit more in one of the next posts). Let’s have a look at the map we are going to reproduce in this post:</p>
<p><img src="https://ikashnitsky.github.io/2017/subplots-in-maps/map.png" class="img-fluid"></p>
<p>So, with this map I want to show the location of more and less urbanized NUTS-2 regions of Europe. But I also want to show – with subplots – how I defined the three subregions of Europe (Eastern, Southern, and Western) and what is the relative frequency of the three categories of regions (Predominantly Rural, Intermediate, and Predominantly Rural) within each of the subregions. The logic of actions is simple: first prepare all the components, then assemble them in a composite plot. Let’s go!</p>
<p>The code to prepare R session and load the data.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># additional packages</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">RColorBrewer</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">myfont</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Roboto Condensed"</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># load the already prepared data</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1705-map-subplots/df-27-261-urb-rur.RData"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://ikashnitsky.github.io/share/1705-map-subplots/spatial-27-261.RData"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Now, I prepare the spatial objects to be plotted with ggplot2 and create a blank map of Europe – our canvas.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># fortify spatial objects</span></span>
<span><span class="va" style="color: #111111;">bord</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sborders</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fort</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sn2</span>, region <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># join spatial and statistical data</span></span>
<span><span class="va" style="color: #111111;">fort_map</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df</span>,<span class="va" style="color: #111111;">fort</span>,<span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a blank map</span></span>
<span><span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sneighbors</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span>,color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey90"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1350000</span>,<span class="fl" style="color: #AD0000;">5450000</span><span class="op" style="color: #5E5E5E;">)</span>, xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2500000</span>, <span class="fl" style="color: #AD0000;">6600000</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span>base_family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>,size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span>,fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.justification <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.background <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>colour <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              legend.text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">15</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/subplots-in-maps/basemap.png" class="img-fluid"></p>
<p>Okay, now the envelope is ready. It’s time to prepare the stamps. Let’s create a nice mosaic plot showing the distribution of NUTS-2 regions by subregions and the urb/rur categories. I found the simplest way to create a nice mosaic plot on <a href="http://stackoverflow.com/a/19252389/4638884">Stack Overflow</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># create a nice mosaic plot; solution from SO:</span></span>
<span><span class="co" style="color: #5E5E5E;"># http://stackoverflow.com/a/19252389/4638884</span></span>
<span><span class="va" style="color: #111111;">makeplot_mosaic</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span>, <span class="va" style="color: #111111;">x</span>, <span class="va" style="color: #111111;">y</span>, <span class="va" style="color: #111111;">...</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="va" style="color: #111111;">xvar</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/deparse.html">deparse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="va" style="color: #111111;">yvar</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/deparse.html">deparse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">y</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="va" style="color: #111111;">mydata</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">xvar</span>, <span class="va" style="color: #111111;">yvar</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span>;</span>
<span>        <span class="va" style="color: #111111;">mytable</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mydata</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        <span class="va" style="color: #111111;">widths</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">sum</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        <span class="va" style="color: #111111;">heights</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        </span>
<span>        <span class="va" style="color: #111111;">alldata</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        <span class="va" style="color: #111111;">allnames</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        <span class="kw" style="color: #003B4F;">for</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>                <span class="kw" style="color: #003B4F;">for</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">j</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>                        <span class="va" style="color: #111111;">alldata</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">alldata</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">widths</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                                                    <span class="va" style="color: #111111;">widths</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">+</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                                                    <span class="va" style="color: #111111;">heights</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">j</span>, <span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                                                    <span class="va" style="color: #111111;">heights</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">j</span><span class="op" style="color: #5E5E5E;">+</span><span class="fl" style="color: #AD0000;">1</span>, <span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>                <span class="op" style="color: #5E5E5E;">}</span></span>
<span>        <span class="op" style="color: #5E5E5E;">}</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">alldata</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"xmin"</span>, <span class="st" style="color: #20794D;">"xmax"</span>, <span class="st" style="color: #20794D;">"ymin"</span>, <span class="st" style="color: #20794D;">"ymax"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        </span>
<span>        <span class="va" style="color: #111111;">alldata</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">xvar</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                               <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        <span class="va" style="color: #111111;">alldata</span><span class="op" style="color: #5E5E5E;">[[</span><span class="va" style="color: #111111;">yvar</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mytable</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">alldata</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>xmin<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xmin</span>, xmax<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xmax</span>, ymin<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">ymin</span>, ymax<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">ymax</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"white"</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op" style="color: #5E5E5E;">(</span>fill<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yvar</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">xvar</span>, <span class="st" style="color: #20794D;">"(count)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">yvar</span>, <span class="st" style="color: #20794D;">"(proportion)"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>;</span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="va" style="color: #111111;">typ_mosaic</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">makeplot_mosaic</span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>type <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                              x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">subregion</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span>option <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B"</span>, discrete <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, end <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">1.4</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"text"</span>,x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">27</span>, <span class="fl" style="color: #AD0000;">82.5</span>, <span class="fl" style="color: #AD0000;">186</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1.05</span>, </span>
<span>                 label<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"EAST"</span>, <span class="st" style="color: #20794D;">"SOUTH"</span>, <span class="st" style="color: #20794D;">"WEST"</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                 size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4</span>, fontface <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>, </span>
<span>                 vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>,</span>
<span>                 family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">myfont</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/subplots-in-maps/mosaic.png" class="img-fluid"></p>
<p>Just what we needed. The next step is to build a small map showing the three subregions of Europe. But before we proceed to the maps, one thing has to be fixed. <code>ggplot2</code> <a href="https://stackoverflow.com/questions/21748852">fails rendering nested polygons</a>. With our regional dataset, London, for example, will not be shown if we do not account for this unpleasant feature. Luckily, there is quite a simple <a href="https://stackoverflow.com/a/32186989/4638884">solution to fix that problem</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># a nice small function to overcome some mapping problems with nested polygons</span></span>
<span><span class="co" style="color: #5E5E5E;"># see more at SO</span></span>
<span><span class="co" style="color: #5E5E5E;"># https://stackoverflow.com/questions/21748852</span></span>
<span><span class="va" style="color: #111111;">gghole</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>        <span class="va" style="color: #111111;">poly</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">id</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">hole</span>, <span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">id</span>, <span class="op" style="color: #5E5E5E;">]</span></span>
<span>        <span class="va" style="color: #111111;">hole</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">[</span><span class="op" style="color: #5E5E5E;">!</span><span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">id</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">fort</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">hole</span>, <span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">id</span>, <span class="op" style="color: #5E5E5E;">]</span></span>
<span>        <span class="va" style="color: #111111;">out</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">poly</span>, <span class="va" style="color: #111111;">hole</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">out</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"poly"</span>, <span class="st" style="color: #20794D;">"hole"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">out</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>Now I build the small map of subregions.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># pal for the subregions</span></span>
<span><span class="va" style="color: #111111;">brbg3</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">11</span>,<span class="st" style="color: #20794D;">"BrBG"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">11</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># annotate a small map of the subregions of Europe</span></span>
<span><span class="va" style="color: #111111;">an_sub</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">gghole</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fort_map</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data  <span class="op" style="color: #5E5E5E;">=</span>  <span class="fu" style="color: #4758AB;">gghole</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fort_map</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">subregion</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">brbg3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/subplots-in-maps/sub.png" class="img-fluid"></p>
<p>Finally, everything is ready to build the main map and stick the two subplots on top of it.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># finally the map of Urb/Rur typology</span></span>
<span></span>
<span><span class="va" style="color: #111111;">caption</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"Classification: De Beer, J., Van Der Gaag, N., &amp; Van Der Erf, R. (2014). New classification of urban and rural NUTS 2 regions in Europe. NIDI Working Papers, 2014/3. Retrieved from http://www.nidi.nl/shared/content/output/papers/nidi-wp-2014-03.pdf</span></span>
<span><span class="st" style="color: #20794D;">\nIlya Kashnitsky (ikashnitsky.github.io)"</span></span>
<span></span>
<span><span class="va" style="color: #111111;">typ</span> <span class="op" style="color: #5E5E5E;">&lt;-</span>  <span class="va" style="color: #111111;">basemap</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">gghole</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fort_map</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">long</span>, y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">lat</span>, group<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">group</span>, fill<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     color<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"grey30"</span>,size<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">.1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">gghole</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fort_map</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                     <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">long</span>, y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">lat</span>, group<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">group</span>, fill<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">type</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                     color<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"grey30"</span>,size<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">.1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"NEUJOBS\nclassification of\nNUTS-2 regions"</span>, </span>
<span>                           option <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"B"</span>, discrete <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span>, end <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">bord</span>, <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">long</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">lat</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">group</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                  color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"grey20"</span>,size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">.5</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>        </span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span>grob <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">typ_mosaic</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                          xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2500000</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4000000</span>, </span>
<span>                          ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4450000</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5450000</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span>grob <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">an_sub</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                          xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5400000</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">6600000</span>, </span>
<span>                          ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2950000</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">4150000</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Urban / Rural classification of NUTS-2 regions of Europe\n"</span>,</span>
<span>             caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">caption</span>, width <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">95</span><span class="op" style="color: #5E5E5E;">)</span>, collapse <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'\n'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>plot.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>              plot.caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">12</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/subplots-in-maps/map.png" class="img-fluid"></p>
<p>Done!</p>
<p>Of course, it takes several iterations to position each element in its proper place. Then, one also needs to play with export parameters to finally get the desired output.</p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The full R script for this post is <a href="https://ikashnitsky.github.io/share/1705-map-subplots/code.R">here</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <category>rspatial</category>
  <guid>https://ikashnitsky.github.io/2017/subplots-in-maps/index.html</guid>
  <pubDate>Wed, 24 May 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/subplots-in-maps/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
<item>
  <title>Arranging subplots with ggplot2</title>
  <dc:creator>Ilya Kashnitsky</dc:creator>
  <link>https://ikashnitsky.github.io/2017/align-six-maps/index.html</link>
  <description><![CDATA[ <script src="https://cdn.counter.dev/script.js" data-id="daa70324-89c3-4b1c-8ea0-3588f29f41f5" data-utcoffset="1"></script><hr>
<p>For <a href="https://doi.org/10.1186/s41118-017-0018-2">my recently published paper</a>, I produced not-so-standard figures that show the two step decomposition used in the analysis. Have a look:</p>
<p><img src="https://ikashnitsky.github.io/2017/align-six-maps/fig-01.png" class="img-fluid"><strong>Figure 3 from my paper (<a href="https://ikashnitsky.github.io/doc/pubs/1705-genus-ik.pdf">PDF</a>)</strong></p>
<p>Actually, <code>ggplot2</code> is a very powerful and flexible tool that allows to draw figures with quite a complex layout. Today I want to show the code that aligns six square plots (actually, maps) just as in the figure above. And it’s all about the handy function <code><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">ggplot2::annotation_custom()</a></code>. Since I used the layout more than once, I wrapped the code that produced it into a function that takes a list of 6 square plots as an input and yields the arranged figure with arrows as an output. Here is the commented code of the function.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">align_six_plots</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span>, </span>
<span>                                    <span class="va" style="color: #111111;">family</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span>,</span>
<span>                                    <span class="va" style="color: #111111;">labels</span><span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">LETTERS</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">]</span>, </span>
<span>                                    <span class="va" style="color: #111111;">labels.size</span><span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span></span>
<span>        <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">gridExtra</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>        <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op" style="color: #5E5E5E;">(</span>xlim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">21</span><span class="op" style="color: #5E5E5E;">)</span>, ylim <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">30</span><span class="op" style="color: #5E5E5E;">)</span>, expand <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">8.5</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">21</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">29</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">12.5</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20.5</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">19.5</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">27.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">12.5</span>,xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20.5</span>,ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10.5</span>,ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">8.5</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">9</span>,ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">17</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">8.5</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">list.plots</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                  xmin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">12.5</span>,xmax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20.5</span>, ymin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, ymax <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>        <span class="co" style="color: #5E5E5E;"># DF with the coordinates of the 5 arrows</span></span>
<span>        <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>id<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">5</span>,</span>
<span>                                x<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">8.5</span>,<span class="fl" style="color: #AD0000;">8.5</span>,<span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">12.5</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                y<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">21</span>,<span class="fl" style="color: #AD0000;">21</span>,<span class="fl" style="color: #AD0000;">10.5</span>,<span class="fl" style="color: #AD0000;">10.5</span>,<span class="fl" style="color: #AD0000;">10.5</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                xend<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">8.5</span>,<span class="fl" style="color: #AD0000;">8.5</span>,<span class="fl" style="color: #AD0000;">12.5</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                                yend<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">20.5</span>,<span class="fl" style="color: #AD0000;">17.5</span>,<span class="fl" style="color: #AD0000;">10</span>,<span class="fl" style="color: #AD0000;">7</span>,<span class="fl" style="color: #AD0000;">7</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>        <span class="co" style="color: #5E5E5E;"># add arrows</span></span>
<span>        <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">==</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>,y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">y</span>,xend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xend</span>,yend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yend</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           curvature <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span>                           arrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op" style="color: #5E5E5E;">(</span>type<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"closed"</span>,length <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.25</span>,<span class="st" style="color: #20794D;">"cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">==</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>,y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">y</span>,xend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xend</span>,yend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yend</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           curvature <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.1</span>,</span>
<span>                           arrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op" style="color: #5E5E5E;">(</span>type<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"closed"</span>,length <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.25</span>,<span class="st" style="color: #20794D;">"cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">==</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>,y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">y</span>,xend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xend</span>,yend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yend</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           curvature <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.15</span>,</span>
<span>                           arrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op" style="color: #5E5E5E;">(</span>type<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"closed"</span>,length <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.25</span>,<span class="st" style="color: #20794D;">"cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">==</span><span class="fl" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>,y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">y</span>,xend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xend</span>,yend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yend</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           curvature <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>,</span>
<span>                           arrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op" style="color: #5E5E5E;">(</span>type<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"closed"</span>,length <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.25</span>,<span class="st" style="color: #20794D;">"cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>                <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_curve</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">df.arrows</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">id</span><span class="op" style="color: #5E5E5E;">==</span><span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>,y<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">y</span>,xend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">xend</span>,yend<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">yend</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>                           curvature <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>,</span>
<span>                           arrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op" style="color: #5E5E5E;">(</span>type<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"closed"</span>,length <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.25</span>,<span class="st" style="color: #20794D;">"cm"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>        <span class="co" style="color: #5E5E5E;"># add labes</span></span>
<span>        <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">gg</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'text'</span>,label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">labels</span>,</span>
<span>                            x<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.5</span>,<span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">12.5</span>,<span class="fl" style="color: #AD0000;">.5</span>,<span class="fl" style="color: #AD0000;">.5</span>,<span class="fl" style="color: #AD0000;">12.5</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span><span class="fl" style="color: #AD0000;">.5</span>,</span>
<span>                            y<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">29</span>,<span class="fl" style="color: #AD0000;">27.5</span>,<span class="fl" style="color: #AD0000;">18.5</span>,<span class="fl" style="color: #AD0000;">17</span>,<span class="fl" style="color: #AD0000;">8</span>,<span class="fl" style="color: #AD0000;">8</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span><span class="fl" style="color: #AD0000;">.1</span>,</span>
<span>                            size<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">labels.size</span>,hjust<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">0</span>, vjust<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">0</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">family</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span>        <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">gg</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>Let’s check, if the function works. For that I create just a blank plot, clone it six times, store the six plots in a list, and finally feed it to the function.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># create a simple blank square plot</span></span>
<span><span class="va" style="color: #111111;">p</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_map.html">theme_map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>panel.border <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>        aspect.ratio <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># clone this plot six times and store as a list of six</span></span>
<span><span class="va" style="color: #111111;">plots</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/get.html">mget</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"p"</span>, <span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># use the function on the list</span></span>
<span><span class="va" style="color: #111111;">six</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">align_six_plots</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">plots</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># save the output</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"six_square_plots_aligned.png"</span>, <span class="va" style="color: #111111;">six</span>, width<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">12</span>, height<span class="op" style="color: #5E5E5E;">=</span><span class="fl" style="color: #AD0000;">18</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><img src="https://ikashnitsky.github.io/2017/align-six-maps/fig-02.png" class="img-fluid"></p>
<p>Just what we wanted to get.</p>
<hr>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
To reproduce all the actual results and figures from <a href="https://doi.org/10.1186/s41118-017-0018-2">my paper</a>, have a look at this github <a href="https://github.com/ikashnitsky/genus-2017">repo</a>
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>


<!-- -->


 ]]></description>
  <category>r</category>
  <category>ggplot2</category>
  <guid>https://ikashnitsky.github.io/2017/align-six-maps/index.html</guid>
  <pubDate>Sun, 21 May 2017 22:00:00 GMT</pubDate>
  <media:content url="https://ikashnitsky.github.io/2017/align-six-maps/teaser.png" medium="image" type="image/png" height="90" width="144"/>
</item>
</channel>
</rss>
